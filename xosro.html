<!DOCTYPE html>

<html lang="fa" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ø²Ù†Ø¯Ú¯ÛŒ Ø§ÛŒØ±Ø§Ù†ÛŒ - Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø² Ø²Ù†Ø¯Ú¯ÛŒ</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://v1.fontapi.ir/css/Vazir" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body {
      font-family: 'Vazir', sans-serif;
      background: linear-gradient(135deg, #121212 0%, #1a202c 100%);
      min-height: 100vh;
      overflow-x: hidden;
      display: flex;
      flex-direction: column;
      color: white; /* Default text color */
    }
    .glass-card {
      background: rgba(255, 255, 255, 0.08);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 12px;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }
    .btn-primary {
      background: #10b981;
      color: white;
      transition: transform 0.2s ease, background 0.2s ease;
    }
    .btn-primary:hover {
      background: #059669;
      transform: scale(1.05);
    }
    .btn-secondary {
      background: #4b5563;
      color: white;
      transition: transform 0.2s ease, background 0.2s ease;
    }
    .btn-secondary:hover {
      background: #374151;
      transform: scale(1.05);
    }
    .status-bar {
      height: 8px;
      border-radius: 4px;
      transition: width 0.3s ease;
      width: 100%; /* Make status bar fill its container */
    }
    .animate-slide-in {
      animation: slideIn 0.5s ease-out;
    }
    @keyframes slideIn {
      from { transform: translateY(20px); opacity: 0; }
      to { transform: translateY(0); opacity: 1; }
    }
    .money-display {
      font-size: 1.5rem;
      font-weight: bold;
    }
    /* Fixed height for status bar container to avoid overlap and calculate bottom offset */
    .status-bars-container {
      height: 152px; /* Approx. 5 lines * 24px + 2*16px padding */
      /* position: fixed; */ /* No longer fixed */
      /* bottom: 0; */ /* No longer fixed */
      width: 100%;
      /* z-index: 10; */ /* No longer fixed */
    }
    /* Adjust padding-bottom for main content to prevent overlap with fixed bottom elements */
    .main-content-padding {
      padding-bottom: calc(60px + 16px); /* Tab bar height + some extra padding */
      padding-top: calc(5rem + 1rem); /* Space for fixed header (5rem) + gap (1rem) for generic pages */
    }
    .dashboard-content-padding { /* New class for dashboard specific padding */
      padding-bottom: calc(60px + 16px); /* Tab bar height + some extra padding */
      padding-top: 352px; /* Corrected padding for fixed header, char info, status bars, and a gap */
    }
    .tab-bar {
      position: fixed;
      bottom: 0; /* Now at the very bottom */
      width: 100%;
      z-index: 20; /* Updated z-index */
    }
    .modal-overlay {
      position: fixed;
      inset: 0;
      background-color: rgba(0, 0, 0, 0.75);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 50;
    }
    .modal-content {
      background: rgba(255, 255, 255, 0.15);
      backdrop-filter: blur(15px);
      border: 1px solid rgba(255, 255, 255, 0.2);
      border-radius: 15px;
      padding: 1.5rem;
      width: 90%;
      max-width: 400px;
      text-align: center;
      box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.37);
    }
    .modal-button-container {
      display: flex;
      justify-content: space-around;
      margin-top: 1rem;
    }
    .modal-button {
      padding: 0.75rem 1.5rem;
      border-radius: 8px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s ease;
    }
    .modal-button.primary {
      background-color: #10b981;
      color: white;
    }
    .modal-button.primary:hover {
      background-color: #059669;
      transform: translateY(-2px);
    }
    .modal-button.secondary {
      background-color: #4b5563;
      color: white;
    }
    .modal-button.secondary:hover {
      background-color: #374151;
      transform: translateY(-2px);
    }
    /* Ensure scrollability for content within pages */
    .page-content-scroll {
      /* max-height: calc(100vh - (5rem + 152px + 1rem) - (60px + 16px)); */ /* 100vh - new padding-top - new padding-bottom */
      /* The above would be for the content *inside* the padded box. */
      /* If page-content-scroll is on the same element as main-content-padding, max-height should be for the element itself. */
      /* Given flex-1 on dashboard, this might be more for non-dashboard pages. */
      /* Let's adjust based on typical non-dashboard page fixed elements: header (5rem) and tab-bar (60px+16px) */
      /* This also means non-dashboard pages will have the large top padding from main-content-padding. */
      max-height: calc(100vh - 5rem - (60px + 16px)); /* Max height for content area on generic pages considering their specific top/bottom fixed elements */
      overflow-y: auto;
      -webkit-overflow-scrolling: touch; /* Smooth scrolling on iOS */
    }
  </style>
</head>
<body>
  <div id="start-screen" class="flex flex-col items-center justify-center min-h-screen p-4">
    <img src="https://placehold.co/150x120/10b981/ffffff?text=Ù„ÙˆÚ¯Ùˆ" alt="Ù„ÙˆÚ¯Ùˆ Ø¨Ø§Ø²ÛŒ" class="h-32 mb-5 animate-slide-in rounded-lg">
    <div class="glass-card p-6 w-11/12 max-w-md text-center">
      <h1 class="text-3xl font-bold mb-4">Ø²Ù†Ø¯Ú¯ÛŒ Ø§ÛŒØ±Ø§Ù†ÛŒ</h1>
      <input id="name-input" type="text" placeholder="Ù†Ø§Ù… Ø®ÙˆØ¯ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯" class="w-full p-3 mb-4 text-right bg-gray-800 rounded-lg focus:outline-none focus:ring-2 focus:ring-emerald-500" value="Ø¹Ø±ÙØ§Ù† Ø®Ø³Ø±ÙˆÛŒ">
      <select id="gender-select" class="w-full p-3 mb-4 text-right bg-gray-800 rounded-lg focus:outline-none focus:ring-2 focus:ring-emerald-500">
        <option value="male" selected>Ù…Ø±Ø¯ ğŸ‘¨</option>
        <option value="female">Ø²Ù† ğŸ‘©</option>
      </select>
      <select id="province-select" class="w-full p-3 mb-4 text-right bg-gray-800 rounded-lg focus:outline-none focus:ring-2 focus:ring-emerald-500">
        <option value="tehran" selected>ØªÙ‡Ø±Ø§Ù† - Ù¾Ø§ÛŒØªØ®ØªØŒ Ø§Ù…Ú©Ø§Ù†Ø§Øª Ø²ÛŒØ§Ø¯</option>
        <option value="isfahan">Ø§ØµÙÙ‡Ø§Ù† - ØªØ§Ø±ÛŒØ®ÛŒØŒ ÙØ±Ù‡Ù†Ú¯ÛŒ</option>
        <option value="shiraz">Ø´ÛŒØ±Ø§Ø² - Ø§Ø¯Ø¨ÛŒØŒ Ø®ÙˆØ´ Ø¢Ø¨â€ŒÙˆÙ‡ÙˆØ§</option>
        <option value="mashhad">Ù…Ø´Ù‡Ø¯ - Ù…Ø°Ù‡Ø¨ÛŒØŒ Ø²ÛŒØ§Ø±ØªÛŒ</option>
        <option value="tabriz">ØªØ¨Ø±ÛŒØ² - ØµÙ†Ø¹ØªÛŒØŒ ØªØ§Ø±ÛŒØ®ÛŒ</option>
      </select>
      <select id="family-status" class="w-full p-3 mb-4 text-right bg-gray-800 rounded-lg focus:outline-none focus:ring-2 focus:ring-emerald-500">
        <option value="normal" selected>Ø®Ø§Ù†ÙˆØ§Ø¯Ù‡ Ù…Ø¹Ù…ÙˆÙ„ÛŒ</option>
        <option value="wealthy">Ø®Ø§Ù†ÙˆØ§Ø¯Ù‡ Ø«Ø±ÙˆØªÙ…Ù†Ø¯</option>
        <option value="rural">Ø®Ø§Ù†ÙˆØ§Ø¯Ù‡ Ø±ÙˆØ³ØªØ§ÛŒÛŒ</option>
        <option value="poor">Ø®Ø§Ù†ÙˆØ§Ø¯Ù‡ Ø¨Ø§ Ù…Ø´Ú©Ù„Ø§Øª Ù…Ø§Ù„ÛŒ</option>
      </select>
      <button id="start-new-life" class="btn-primary w-4/5 py-3 rounded-full text-lg font-semibold mb-3 shadow-lg">Ø´Ø±ÙˆØ¹ Ø²Ù†Ø¯Ú¯ÛŒ Ø¬Ø¯ÛŒØ¯</button>
      <button id="continue-life" class="btn-secondary w-4/5 py-3 rounded-full text-md shadow-lg">Ø§Ø¯Ø§Ù…Ù‡ Ø²Ù†Ø¯Ú¯ÛŒ Ù‚Ø¨Ù„ÛŒ</button>
    </div>
    <div class="absolute bottom-5 left-5">
      <button id="settings-btn" class="text-gray-400 hover:text-white transition">âš™ï¸ ØªÙ†Ø¸ÛŒÙ…Ø§Øª</button>
    </div>
    <div class="absolute bottom-5 right-5">
      <select id="language-select" class="bg-gray-800 p-2 rounded-lg text-sm">
        <option value="fa" selected>ÙØ§Ø±Ø³ÛŒ</option>
      </select>
    </div>
  </div>

  <div id="dashboard" class="hidden flex-1 flex flex-col">
    <div class="fixed top-0 w-full glass-card p-4 flex justify-start items-center z-30 rounded-b-lg"> 
      <h1 class="text-xl font-bold text-white">Ø²Ù†Ø¯Ú¯ÛŒ Ø§ÛŒØ±Ø§Ù†ÛŒ</h1> 
      
    </div>

    <div id="character-info-block" class="glass-card p-4 fixed w-full z-20" style="top: 4rem;"> 
      <h2 id="dashboard-char-name" class="text-2xl font-bold">Ù†Ø§Ù… Ø´Ø®ØµÛŒØª</h2>
      <p id="dashboard-char-age" class="text-md text-gray-300">Ø³Ù†: 0 Ø³Ø§Ù„Ù‡ - 2025</p>
      <p id="dashboard-char-money" class="text-lg text-emerald-400">Ù¾ÙˆÙ„: 0 ØªÙˆÙ…Ø§Ù†</p>
      <p id="dashboard-char-job" class="text-md text-gray-300">Ø´ØºÙ„: Ø¨ÛŒÚ©Ø§Ø±</p>
    </div>

    <div id="status-bars-container" class="glass-card p-4 rounded-b-lg fixed w-full z-10" style="top: 11.5rem;"> 
      <div class="flex flex-col space-y-2 text-sm">
        <div class="flex items-center"><span class="ml-2 w-16">ğŸ˜Š Ø´Ø§Ø¯ÛŒ</span><div class="flex-1 bg-gray-700 rounded-full"><div id="happiness-bar" class="status-bar bg-blue-500"></div></div><span id="happiness-value" class="ml-2 w-10 text-left"></span></div>
        <div class="flex items-center"><span class="ml-2 w-16">ğŸ’ª Ø³Ù„Ø§Ù…Øª</span><div class="flex-1 bg-gray-700 rounded-full"><div id="health-bar" class="status-bar bg-red-500"></div></div><span id="health-value" class="ml-2 w-10 text-left"></span></div>
        <div class="flex items-center"><span class="ml-2 w-16">ğŸ§  Ù‡ÙˆØ´</span><div class="flex-1 bg-gray-700 rounded-full"><div id="smarts-bar" class="status-bar bg-purple-500"></div></div><span id="smarts-value" class="ml-2 w-10 text-left"></span></div>
        <div class="flex items-center"><span class="ml-2 w-16">ğŸ˜ Ø¸Ø§Ù‡Ø±</span><div class="flex-1 bg-gray-700 rounded-full"><div id="looks-bar" class="status-bar bg-yellow-500"></div></div><span id="looks-value" class="ml-2 w-10 text-left"></span></div>
        <div class="flex items-center"><span class="ml-2 w-16">ğŸ•Œ Ù…Ø¹Ù†ÙˆÛŒØª</span><div class="flex-1 bg-gray-700 rounded-full"><div id="spirituality-bar" class="status-bar bg-teal-500"></div></div><span id="spirituality-value" class="ml-2 w-10 text-left"></span></div>
      </div>
    </div>

    <div class="flex-1 p-4 dashboard-content-padding page-content-scroll"> 
      <div class="glass-card p-4">
        <ul id="life-log" class="space-y-4"></ul>
      </div>
    </div>

    <div class="tab-bar glass-card flex justify-around py-2 rounded-t-lg"> 
      <button id="home-tab" class="flex flex-col items-center text-sm p-2 rounded-lg hover:bg-gray-700 transition"><span>ğŸ </span>Ø®Ø§Ù†Ù‡</button>
      <button id="character-tab" class="flex flex-col items-center text-sm p-2 rounded-lg hover:bg-gray-700 transition"><span>ğŸ§</span>Ø´Ø®ØµÛŒØª</button>
      <button id="age-up-tab" class="flex flex-col items-center text-sm p-2 rounded-lg hover:bg-gray-700 transition"><span>â­ï¸</span>ÛŒÚ© Ø³Ø§Ù„ Ø¨Ú¯Ø°Ø±ÙˆÙ†</button>
      <button id="assets-tab" class="flex flex-col items-center text-sm p-2 rounded-lg hover:bg-gray-700 transition"><span>ğŸ’¼</span>Ø¯Ø§Ø±Ø§ÛŒÛŒâ€ŒÙ‡Ø§</button>
      <button id="more-tab" class="flex flex-col items-center text-sm p-2 rounded-lg hover:bg-gray-700 transition"><span>â‹¯</span>Ø¨ÛŒØ´ØªØ±</button>
    </div>

    <div id="more-menu" class="hidden modal-overlay">
      <div class="modal-content">
        <h2 class="text-xl font-bold mb-4">Ú¯Ø²ÛŒÙ†Ù‡â€ŒÙ‡Ø§ÛŒ Ø¨ÛŒØ´ØªØ±</h2>
        <div class="grid grid-cols-2 gap-4">
          <button id="education-btn" class="glass-card p-4 flex flex-col items-center justify-center hover:bg-gray-700 transition">
            <span class="text-2xl">ğŸ“</span>
            <span>ØªØ­ØµÛŒÙ„Ø§Øª</span>
          </button>
          <button id="job-btn" class="glass-card p-4 flex flex-col items-center justify-center hover:bg-gray-700 transition">
            <span class="text-2xl">ğŸ’¼</span>
            <span>Ø´ØºÙ„</span>
          </button>
          <button id="relationships-btn" class="glass-card p-4 flex flex-col items-center justify-center hover:bg-gray-700 transition">
            <span class="text-2xl">â¤ï¸</span>
            <span>Ø±ÙˆØ§Ø¨Ø·</span>
          </button>
          <button id="health-btn" class="glass-card p-4 flex flex-col items-center justify-center hover:bg-gray-700 transition">
            <span class="text-2xl">ğŸ¥</span>
            <span>Ø³Ù„Ø§Ù…Øª</span>
          </button>
          <button id="finance-btn" class="glass-card p-4 flex flex-col items-center justify-center hover:bg-gray-700 transition">
            <span class="text-2xl">ğŸ“Š</span>
            <span>Ù…Ø§Ù„ÛŒ</span>
          </button>
          <button id="log-menu-btn" class="glass-card p-4 flex flex-col items-center justify-center hover:bg-gray-700 transition">
            <span class="text-2xl">ğŸ“œ</span>
            <span>ØªØ§Ø±ÛŒØ®Ú†Ù‡</span>
          </button>
          <button id="settings-page-btn" class="glass-card p-4 flex flex-col items-center justify-center hover:bg-gray-700 transition">
            <span class="text-2xl">âš™ï¸</span>
            <span>ØªÙ†Ø¸ÛŒÙ…Ø§Øª</span>
          </button>
        </div>
        <button id="close-more-menu" class="btn-secondary w-full py-2 mt-4 rounded-lg">Ø¨Ø³ØªÙ†</button>
      </div>
    </div>
  </div>

  <div id="character-page" class="hidden min-h-screen p-4 main-content-padding page-content-scroll">
    <h2 class="text-2xl font-bold mb-4">Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø´Ø®ØµÛŒØª</h2>
    <div class="glass-card p-4 mb-4">
      <p><strong>Ù†Ø§Ù…:</strong> <span id="char-name"></span></p>
      <p><strong>Ø¬Ù†Ø³ÛŒØª:</strong> <span id="char-gender"></span></p>
      <p><strong>Ù…Ø­Ù„ ØªÙˆÙ„Ø¯:</strong> <span id="char-province"></span></p>
      <p><strong>ÙˆØ¶Ø¹ÛŒØª Ø®Ø§Ù†ÙˆØ§Ø¯Ú¯ÛŒ:</strong> <span id="char-family"></span></p>
      <p><strong>Ø³Ù†:</strong> <span id="char-age"></span></p>
      <p><strong>Ø´Ù†Ø§Ø³Ù‡ Ú©Ø§Ø±Ø¨Ø±ÛŒ:</strong> <span id="user-id-display" class="text-xs text-gray-400 break-all"></span></p>
    </div>
    <div class="glass-card p-4 mb-4">
      <h3 class="text-lg font-semibold mb-2">Ø®Ø§Ù†ÙˆØ§Ø¯Ù‡</h3>
      <ul id="family-list" class="space-y-2"></ul>
    </div>
    <div class="glass-card p-4">
      <h3 class="text-lg font-semibold mb-2">ÙˆÛŒÚ˜Ú¯ÛŒâ€ŒÙ‡Ø§</h3>
      <p>Ù‡ÙˆØ´: <span id="char-smarts"></span></p>
      <p>Ø¸Ø§Ù‡Ø±: <span id="char-looks"></span></p>
      <p>Ù…Ø¹Ù†ÙˆÛŒØª: <span id="char-spirituality"></span></p>
    </div>
  </div>

  <div id="log-page" class="hidden min-h-screen p-4 main-content-padding page-content-scroll">
    <h2 class="text-2xl font-bold mb-4">ØªØ§Ø±ÛŒØ®Ú†Ù‡ Ø²Ù†Ø¯Ú¯ÛŒ</h2>
    <div class="glass-card p-4">
      <div class="flex space-x-2 mb-4 overflow-x-auto pb-2">
        <button id="log-filter-all" class="btn-primary px-4 py-2 rounded-lg flex-shrink-0">Ù‡Ù…Ù‡</button>
        <button id="log-filter-career" class="btn-secondary px-4 py-2 rounded-lg flex-shrink-0">Ø´ØºÙ„</button>
        <button id="log-filter-family" class="btn-secondary px-4 py-2 rounded-lg flex-shrink-0">Ø®Ø§Ù†ÙˆØ§Ø¯Ù‡</button>
        <button id="log-filter-health" class="btn-secondary px-4 py-2 rounded-lg flex-shrink-0">Ø³Ù„Ø§Ù…Øª</button>
        <button id="log-filter-education" class="btn-secondary px-4 py-2 rounded-lg flex-shrink-0">ØªØ­ØµÛŒÙ„Ø§Øª</button>
        <button id="log-filter-finance" class="btn-secondary px-4 py-2 rounded-lg flex-shrink-0">Ù…Ø§Ù„ÛŒ</button>
      </div>
      <ul id="life-log-full" class="space-y-4"></ul>
    </div>
  </div>

  <div id="education-page" class="hidden min-h-screen p-4 main-content-padding page-content-scroll">
    <h2 class="text-2xl font-bold mb-4">ØªØ­ØµÛŒÙ„Ø§Øª</h2>
    <div class="glass-card p-4">
      <div class="flex space-x-2 mb-4">
        <button id="school-tab" class="btn-primary px-4 py-2 rounded-lg">Ù…Ø¯Ø±Ø³Ù‡</button>
        <button id="university-tab" class="btn-secondary px-4 py-2 rounded-lg">Ø¯Ø§Ù†Ø´Ú¯Ø§Ù‡</button>
      </div>
      <div id="education-content"></div>
    </div>
  </div>

  <div id="job-page" class="hidden min-h-screen p-4 main-content-padding page-content-scroll">
    <h2 class="text-2xl font-bold mb-4">Ø´ØºÙ„</h2>
    <div class="glass-card p-4">
      <div class="flex space-x-2 mb-4">
        <button id="job-list-tab" class="btn-primary px-4 py-2 rounded-lg">Ù…Ø´Ø§ØºÙ„</button>
        <button id="career-progress-tab" class="btn-secondary px-4 py-2 rounded-lg">Ù¾ÛŒØ´Ø±ÙØª Ø´ØºÙ„ÛŒ</button>
      </div>
      <div id="job-content"></div>
    </div>
  </div>

  <div id="relationships-page" class="hidden min-h-screen p-4 main-content-padding page-content-scroll">
    <h2 class="text-2xl font-bold mb-4">Ø±ÙˆØ§Ø¨Ø·</h2>
    <div id="relationships-list" class="grid grid-cols-1 md:grid-cols-2 gap-4"></div>
  </div>

  <div id="health-page" class="hidden min-h-screen p-4 main-content-padding page-content-scroll">
    <h2 class="text-2xl font-bold mb-4">Ø³Ù„Ø§Ù…Øª</h2>
    <div class="glass-card p-4">
      <p><strong>ÙˆØ¶Ø¹ÛŒØª Ø³Ù„Ø§Ù…Øª:</strong> <span id="health-status"></span></p>
      <p><strong>Ø¨ÛŒÙ…Ø§Ø±ÛŒâ€ŒÙ‡Ø§:</strong> <span id="illnesses"></span></p>
      <div class="flex space-x-2 mt-4 flex-wrap gap-2">
        <button id="visit-doctor" class="btn-primary px-4 py-2 rounded-lg">Ù…Ø±Ø§Ø¬Ø¹Ù‡ Ø¨Ù‡ Ù¾Ø²Ø´Ú©</button>
        <button id="go-gym" class="btn-primary px-4 py-2 rounded-lg">ÙˆØ±Ø²Ø´</button>
        <button id="meditate" class="btn-primary px-4 py-2 rounded-lg">Ù…Ø±Ø§Ù‚Ø¨Ù‡</button>
      </div>
    </div>
    <div class="glass-card p-4 mt-4">
      <h3 class="text-lg font-semibold mb-2">Ø¨ÛŒÙ…Ø§Ø±ÛŒâ€ŒÙ‡Ø§ Ùˆ Ø¯Ø±Ù…Ø§Ù†â€ŒÙ‡Ø§</h3>
      <ul id="illness-list" class="space-y-2"></ul>
    </div>
  </div>

  <div id="finance-page" class="hidden min-h-screen p-4 main-content-padding page-content-scroll">
    <h2 class="text-2xl font-bold mb-4">Ù…Ø§Ù„ÛŒ</h2>
    <div class="glass-card p-4">
      <p><strong>Ø¯Ø§Ø±Ø§ÛŒÛŒ Ø®Ø§Ù„Øµ:</strong> <span id="net-worth"></span></p>
      <canvas id="finance-chart" class="my-4 w-full h-64"></canvas>
      <div class="flex space-x-2 flex-wrap gap-2">
        <button id="invest-btn" class="btn-primary px-4 py-2 rounded-lg">Ø³Ø±Ù…Ø§ÛŒÙ‡â€ŒÚ¯Ø°Ø§Ø±ÛŒ</button>
        <button id="loan-btn" class="btn-primary px-4 py-2 rounded-lg">Ø¯Ø±ÛŒØ§ÙØª ÙˆØ§Ù…</button>
      </div>
    </div>
    <div id="investment-section" class="glass-card p-4 mt-4 hidden">
      <h3 class="text-lg font-semibold mb-2">Ø³Ø±Ù…Ø§ÛŒÙ‡â€ŒÚ¯Ø°Ø§Ø±ÛŒ</h3>
      <p class="mb-2">Ù…Ø¨Ù„Øº Ø³Ø±Ù…Ø§ÛŒÙ‡â€ŒÚ¯Ø°Ø§Ø±ÛŒ (ØªÙˆÙ…Ø§Ù†):</p>
      <input type="number" id="investment-amount" class="w-full p-2 mb-4 text-right bg-gray-800 rounded-lg focus:outline-none focus:ring-2 focus:ring-emerald-500" min="100000" value="100000">
      <button id="confirm-invest-btn" class="btn-primary px-4 py-2 rounded-lg">ØªØ§ÛŒÛŒØ¯ Ø³Ø±Ù…Ø§ÛŒÙ‡â€ŒÚ¯Ø°Ø§Ø±ÛŒ</button>
      <ul id="current-investments" class="mt-4 space-y-2"></ul>
    </div>
    <div id="loan-section" class="glass-card p-4 mt-4 hidden">
      <h3 class="text-lg font-semibold mb-2">Ø¯Ø±ÛŒØ§ÙØª ÙˆØ§Ù…</h3>
      <p class="mb-2">Ù…Ø¨Ù„Øº ÙˆØ§Ù… (ØªÙˆÙ…Ø§Ù†):</p>
      <input type="number" id="loan-amount" class="w-full p-2 mb-4 text-right bg-gray-800 rounded-lg focus:outline-none focus:ring-2 focus:ring-emerald-500" min="100000" value="100000">
      <button id="confirm-loan-btn" class="btn-primary px-4 py-2 rounded-lg">ØªØ§ÛŒÛŒØ¯ ÙˆØ§Ù…</button>
      <ul id="current-loans" class="mt-4 space-y-2"></ul>
    </div>
  </div>

  <div id="assets-page" class="hidden min-h-screen p-4 main-content-padding page-content-scroll">
    <h2 class="text-2xl font-bold mb-4">Ø¯Ø§Ø±Ø§ÛŒÛŒâ€ŒÙ‡Ø§</h2>
    <div class="glass-card p-4">
      <div class="flex space-x-2 mb-4 overflow-x-auto pb-2">
        <button id="properties-tab" class="btn-primary px-4 py-2 rounded-lg flex-shrink-0">Ø§Ù…Ù„Ø§Ú©</button>
        <button id="vehicles-tab" class="btn-secondary px-4 py-2 rounded-lg flex-shrink-0">Ø®ÙˆØ¯Ø±Ùˆ</button>
        <button id="other-assets-tab" class="btn-secondary px-4 py-2 rounded-lg flex-shrink-0">Ø³Ø§ÛŒØ± Ø¯Ø§Ø±Ø§ÛŒÛŒâ€ŒÙ‡Ø§</button>
      </div>
      <div id="assets-content"></div>
    </div>
  </div>

  <div id="settings-page" class="hidden min-h-screen p-4 main-content-padding page-content-scroll">
    <h2 class="text-2xl font-bold mb-4">ØªÙ†Ø¸ÛŒÙ…Ø§Øª</h2>
    <div class="glass-card p-4">
      <div class="mb-4">
        <label class="block mb-2">ØªÙ…</label>
        <select id="theme-select" class="w-full p-2 bg-gray-800 rounded-lg">
          <option value="dark" selected>ØªÛŒØ±Ù‡</option>
          <option value="light">Ø±ÙˆØ´Ù†</option>
        </select>
      </div>
      <div class="flex space-x-2 flex-wrap gap-2">
        <button id="save-game" class="btn-primary px-4 py-2 rounded-lg">Ø°Ø®ÛŒØ±Ù‡</button>
        <button id="load-game" class="btn-primary px-4 py-2 rounded-lg">Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ</button>
        <button id="reset-game" class="btn-secondary px-4 py-2 rounded-lg">Ø±ÛŒØ³Øª</button>
      </div>
    </div>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
    import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
    import { getFirestore, doc, getDoc, setDoc, onSnapshot, collection, query, where, addDoc, getDocs } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

    // Global Firebase instances (Ù†Ù…ÙˆÙ†Ù‡â€ŒÙ‡Ø§ÛŒ Ø³Ø±Ø§Ø³Ø±ÛŒ Firebase)
    let app;
    let db;
    let auth;
    let userId;
    let financeChartInstance; // To store the Chart.js instance (Ø¨Ø±Ø§ÛŒ Ø°Ø®ÛŒØ±Ù‡ Ù†Ù…ÙˆÙ†Ù‡ Chart.js)

    // Game State (ÙˆØ¶Ø¹ÛŒØª Ø¨Ø§Ø²ÛŒ)
    let gameState = {
      name: '',
      gender: '',
      province: '',
      familyStatus: '',
      age: 0,
      year: 2025,
      money: 0,
      happiness: 50,
      health: 80,
      smarts: 50,
      looks: 50,
      spirituality: 50,
      education: { level: 'Ù‡ÛŒÚ†', major: '' },
      job: { title: 'Ø¨ÛŒÚ©Ø§Ø±', salary: 0, level: 0 },
      relationships: [],
      illnesses: [],
      assets: [],
      loans: [],
      investments: [],
      log: [],
      financeHistory: [{ year: 2025, money: 0 }] // To track money over time for chart (Ø¨Ø±Ø§ÛŒ Ø±Ø¯ÛŒØ§Ø¨ÛŒ Ù¾ÙˆÙ„ Ø¯Ø± Ø·ÙˆÙ„ Ø²Ù…Ø§Ù† Ø¨Ø±Ø§ÛŒ Ù†Ù…ÙˆØ¯Ø§Ø±)
    };

    // Firebase Initialization (Ù…Ù‚Ø¯Ø§Ø±Ø¯Ù‡ÛŒ Ø§ÙˆÙ„ÛŒÙ‡ Firebase)
    async function initializeFirebase() {
      try {
        // __app_id and __firebase_config are provided by the Canvas environment (__app_id Ùˆ __firebase_config ØªÙˆØ³Ø· Ù…Ø­ÛŒØ· Canvas Ø§Ø±Ø§Ø¦Ù‡ Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯)
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
        const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : {};

        console.log("Firebase Init: Received appId:", appId); // Added log
        console.log("Firebase Init: Received firebaseConfig:", firebaseConfig); // Added log

        if (Object.keys(firebaseConfig).length === 0) {
          console.error("Firebase config is missing. Cannot initialize Firebase.");
          // showMessageModal("Ø®Ø·Ø§: ØªÙ†Ø¸ÛŒÙ…Ø§Øª Firebase ÛŒØ§ÙØª Ù†Ø´Ø¯. Ø¨Ø§Ø²ÛŒ Ø¨Ø¯ÙˆÙ† Ø°Ø®ÛŒØ±Ù‡â€ŒØ³Ø§Ø²ÛŒ Ø§Ø¨Ø±ÛŒ Ø§Ø¬Ø±Ø§ Ù…ÛŒâ€ŒØ´ÙˆØ¯.");
          return;
        }

        app = initializeApp(firebaseConfig);
        db = getFirestore(app);
        auth = getAuth(app);

        // Authenticate user (Ø§Ø­Ø±Ø§Ø² Ù‡ÙˆÛŒØª Ú©Ø§Ø±Ø¨Ø±)
        if (typeof __initial_auth_token !== 'undefined') {
          console.log("Firebase Init: Attempting sign-in with custom token..."); // Added log
          await signInWithCustomToken(auth, __initial_auth_token);
        } else {
          console.log("Firebase Init: Attempting anonymous sign-in..."); // Added log
          await signInAnonymously(auth);
        }

        onAuthStateChanged(auth, (user) => {
          if (user) {
            userId = user.uid;
            console.log("Firebase Init: Initialized and user authenticated:", userId);
            document.getElementById('user-id-display').textContent = userId; // Display user ID (Ù†Ù…Ø§ÛŒØ´ Ø´Ù†Ø§Ø³Ù‡ Ú©Ø§Ø±Ø¨Ø±ÛŒ)
            loadGame(); // Load game state after authentication (Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ ÙˆØ¶Ø¹ÛŒØª Ø¨Ø§Ø²ÛŒ Ù¾Ø³ Ø§Ø² Ø§Ø­Ø±Ø§Ø² Ù‡ÙˆÛŒØª)
          } else {
            console.log("Firebase Init: No user signed in. Using random UUID for guest user."); // Modified log
            userId = crypto.randomUUID(); // Use a random ID if not authenticated (Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² ÛŒÚ© ID ØªØµØ§Ø¯ÙÛŒ Ø¯Ø± ØµÙˆØ±Øª Ø¹Ø¯Ù… Ø§Ø­Ø±Ø§Ø² Ù‡ÙˆÛŒØª)
            document.getElementById('user-id-display').textContent = `Ú©Ø§Ø±Ø¨Ø± Ù…Ù‡Ù…Ø§Ù†: ${userId}`;
          }
        });

      } catch (error) {
        console.error("Error initializing Firebase:", error);
        // showMessageModal(`Ø®Ø·Ø§ Ø¯Ø± Ù…Ù‚Ø¯Ø§Ø±Ø¯Ù‡ÛŒ Ø§ÙˆÙ„ÛŒÙ‡ Firebase: ${error.message}. Ù„Ø·ÙØ§Ù‹ Ø§ØªØµØ§Ù„ Ø§ÛŒÙ†ØªØ±Ù†Øª Ø®ÙˆØ¯ Ø±Ø§ Ø¨Ø±Ø±Ø³ÛŒ Ú©Ù†ÛŒØ¯ Ùˆ Ø§Ø² ÙØ¹Ø§Ù„ Ø¨ÙˆØ¯Ù† Ø³Ø±ÙˆÛŒØ³ Ø§Ø­Ø±Ø§Ø² Ù‡ÙˆÛŒØª Ø¯Ø± Ù¾Ø±ÙˆÚ˜Ù‡ Firebase Ø®ÙˆØ¯ Ø§Ø·Ù…ÛŒÙ†Ø§Ù† Ø­Ø§ØµÙ„ Ú©Ù†ÛŒØ¯. Ø¨Ø§Ø²ÛŒ Ø¨Ø¯ÙˆÙ† Ø°Ø®ÛŒØ±Ù‡â€ŒØ³Ø§Ø²ÛŒ Ø§Ø¨Ø±ÛŒ Ø§Ø¬Ø±Ø§ Ù…ÛŒâ€ŒØ´ÙˆØ¯.`); // More specific error message
      }
    }

    // Custom Message Modal (Ù…ÙˆØ¯Ø§Ù„ Ù¾ÛŒØ§Ù… Ø³ÙØ§Ø±Ø´ÛŒ)
    function showMessageModal(message) {
      const modalOverlay = document.createElement('div');
      modalOverlay.className = 'modal-overlay';
      
      const modalContent = document.createElement('div');
      modalContent.className = 'modal-content';
      
      const messageText = document.createElement('p');
      messageText.className = 'text-lg mb-4';
      messageText.textContent = message;
      
      const closeButton = document.createElement('button');
      closeButton.className = 'modal-button primary';
      closeButton.textContent = 'Ø¨Ø§Ø´Ù‡';
      closeButton.onclick = () => {
        document.body.removeChild(modalOverlay);
      };

      modalContent.appendChild(messageText);
      modalContent.appendChild(closeButton);
      modalOverlay.appendChild(modalContent);
      document.body.appendChild(modalOverlay);
    }

    // Override default confirm for custom modal (Ø¬Ø§ÛŒÚ¯Ø²ÛŒÙ†ÛŒ confirm Ù¾ÛŒØ´â€ŒÙØ±Ø¶ Ø¨Ø§ Ù…ÙˆØ¯Ø§Ù„ Ø³ÙØ§Ø±Ø´ÛŒ)
    window.confirm = function(message) {
      return new Promise((resolve) => {
        const modalOverlay = document.createElement('div');
        modalOverlay.className = 'modal-overlay';
        
        const modalContent = document.createElement('div');
        modalContent.className = 'modal-content';
        
        const messageText = document.createElement('p');
        messageText.className = 'text-lg mb-4';
        messageText.textContent = message;
        
        const buttonContainer = document.createElement('div');
        buttonContainer.className = 'modal-button-container';

        const confirmButton = document.createElement('button');
        confirmButton.className = 'modal-button primary';
        confirmButton.textContent = 'Ø¨Ù„Ù‡';
        confirmButton.onclick = () => {
          document.body.removeChild(modalOverlay);
          resolve(true);
        };

        const cancelButton = document.createElement('button');
        cancelButton.className = 'modal-button secondary';
        cancelButton.textContent = 'Ø®ÛŒØ±';
        cancelButton.onclick = () => {
          document.body.removeChild(modalOverlay);
          resolve(false);
        };

        buttonContainer.appendChild(confirmButton);
        buttonContainer.appendChild(cancelButton);
        modalContent.appendChild(messageText);
        modalContent.appendChild(buttonContainer);
        modalOverlay.appendChild(modalContent);
        document.body.appendChild(modalOverlay);
      });
    };

    // Initialize Game (Ù…Ù‚Ø¯Ø§Ø±Ø¯Ù‡ÛŒ Ø§ÙˆÙ„ÛŒÙ‡ Ø¨Ø§Ø²ÛŒ)
    async function initGame() {
      console.log('Initializing game...');
      await initializeFirebase(); // Initialize Firebase first (Ø§Ø¨ØªØ¯Ø§ Firebase Ø±Ø§ Ù…Ù‚Ø¯Ø§Ø±Ø¯Ù‡ÛŒ Ø§ÙˆÙ„ÛŒÙ‡ Ú©Ù†ÛŒØ¯)

      // Event Listeners for Start Screen (Ø´Ù†ÙˆÙ†Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ø±ÙˆÛŒØ¯Ø§Ø¯ Ø¨Ø±Ø§ÛŒ ØµÙØ­Ù‡ Ø´Ø±ÙˆØ¹)
      document.getElementById('start-new-life').addEventListener('click', startNewLife);
      document.getElementById('continue-life').addEventListener('click', continueLife);
      document.getElementById('settings-btn').addEventListener('click', () => showPage('settings-page'));

      // Event Listeners for Bottom Tab Bar (Ø´Ù†ÙˆÙ†Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ø±ÙˆÛŒØ¯Ø§Ø¯ Ø¨Ø±Ø§ÛŒ Ù†ÙˆØ§Ø± ØªØ¨ Ù¾Ø§ÛŒÛŒÙ†)
      document.getElementById('home-tab').addEventListener('click', () => showPage('dashboard'));
      document.getElementById('character-tab').addEventListener('click', () => showPage('character-page'));
      document.getElementById('age-up-tab').addEventListener('click', ageUp);
      document.getElementById('assets-tab').addEventListener('click', () => showPage('assets-page'));
      document.getElementById('more-tab').addEventListener('click', () => showMoreMenu());

      // Event Listeners for More Menu (Ø´Ù†ÙˆÙ†Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ø±ÙˆÛŒØ¯Ø§Ø¯ Ø¨Ø±Ø§ÛŒ Ù…Ù†ÙˆÛŒ Ø¨ÛŒØ´ØªØ±)
      document.getElementById('education-btn').addEventListener('click', () => { showPage('education-page'); hideMoreMenu(); });
      document.getElementById('job-btn').addEventListener('click', () => { showPage('job-page'); hideMoreMenu(); });
      document.getElementById('relationships-btn').addEventListener('click', () => { showPage('relationships-page'); hideMoreMenu(); });
      document.getElementById('health-btn').addEventListener('click', () => { showPage('health-page'); hideMoreMenu(); });
      document.getElementById('finance-btn').addEventListener('click', () => { showPage('finance-page'); hideMoreMenu(); });
      document.getElementById('log-menu-btn').addEventListener('click', () => { showPage('log-page'); hideMoreMenu(); });
      document.getElementById('settings-page-btn').addEventListener('click', () => { showPage('settings-page'); hideMoreMenu(); });
      document.getElementById('close-more-menu').addEventListener('click', hideMoreMenu);

      // Event Listeners for Settings Page (Ø´Ù†ÙˆÙ†Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ø±ÙˆÛŒØ¯Ø§Ø¯ Ø¨Ø±Ø§ÛŒ ØµÙØ­Ù‡ ØªÙ†Ø¸ÛŒÙ…Ø§Øª)
      document.getElementById('save-game').addEventListener('click', saveGame);
      document.getElementById('load-game').addEventListener('click', loadGame);
      document.getElementById('reset-game').addEventListener('click', resetGame);

      // Event Listeners for Health Page (Ø´Ù†ÙˆÙ†Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ø±ÙˆÛŒØ¯Ø§Ø¯ Ø¨Ø±Ø§ÛŒ ØµÙØ­Ù‡ Ø³Ù„Ø§Ù…Øª)
      document.getElementById('visit-doctor').addEventListener('click', visitDoctor);
      document.getElementById('go-gym').addEventListener('click', goGym);
      document.getElementById('meditate').addEventListener('click', meditate);

      // Event Listeners for Finance Page (Ø´Ù†ÙˆÙ†Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ø±ÙˆÛŒØ¯Ø§Ø¯ Ø¨Ø±Ø§ÛŒ ØµÙØ­Ù‡ Ù…Ø§Ù„ÛŒ)
      document.getElementById('invest-btn').addEventListener('click', () => {
        document.getElementById('investment-section').classList.toggle('hidden');
        document.getElementById('loan-section').classList.add('hidden'); // Hide loan section (Ø¨Ø®Ø´ ÙˆØ§Ù… Ø±Ø§ Ù¾Ù†Ù‡Ø§Ù† Ú©Ù†ÛŒØ¯)
      });
      document.getElementById('confirm-invest-btn').addEventListener('click', invest);
      document.getElementById('loan-btn').addEventListener('click', () => {
        document.getElementById('loan-section').classList.toggle('hidden');
        document.getElementById('investment-section').classList.add('hidden'); // Hide investment section (Ø¨Ø®Ø´ Ø³Ø±Ù…Ø§ÛŒÙ‡â€ŒÚ¯Ø°Ø§Ø±ÛŒ Ø±Ø§ Ù¾Ù†Ù‡Ø§Ù† Ú©Ù†ÛŒØ¯)
      });
      document.getElementById('confirm-loan-btn').addEventListener('click', takeLoan);

      // Event Listeners for Education Page (Ø´Ù†ÙˆÙ†Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ø±ÙˆÛŒØ¯Ø§Ø¯ Ø¨Ø±Ø§ÛŒ ØµÙØ­Ù‡ ØªØ­ØµÛŒÙ„Ø§Øª)
      document.getElementById('school-tab').addEventListener('click', showSchool);
      document.getElementById('university-tab').addEventListener('click', showUniversity);

      // Event Listeners for Job Page (Ø´Ù†ÙˆÙ†Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ø±ÙˆÛŒØ¯Ø§Ø¯ Ø¨Ø±Ø§ÛŒ ØµÙØ­Ù‡ Ø´ØºÙ„)
      document.getElementById('job-list-tab').addEventListener('click', showJobList);
      document.getElementById('career-progress-tab').addEventListener('click', showCareerProgress);

      // Event Listeners for Assets Page (Ø´Ù†ÙˆÙ†Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ø±ÙˆÛŒØ¯Ø§Ø¯ Ø¨Ø±Ø§ÛŒ ØµÙØ­Ù‡ Ø¯Ø§Ø±Ø§ÛŒÛŒâ€ŒÙ‡Ø§)
      document.getElementById('properties-tab').addEventListener('click', () => showAssets('properties'));
      document.getElementById('vehicles-tab').addEventListener('click', () => showAssets('vehicles'));
      document.getElementById('other-assets-tab').addEventListener('click', () => showAssets('other'));

      // Event Listeners for Log Filters (Ø´Ù†ÙˆÙ†Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ø±ÙˆÛŒØ¯Ø§Ø¯ Ø¨Ø±Ø§ÛŒ ÙÛŒÙ„ØªØ±Ù‡Ø§ÛŒ ØªØ§Ø±ÛŒØ®Ú†Ù‡)
      document.getElementById('log-filter-all').addEventListener('click', () => filterLog('all'));
      document.getElementById('log-filter-career').addEventListener('click', () => filterLog('career'));
      document.getElementById('log-filter-family').addEventListener('click', () => filterLog('family'));
      document.getElementById('log-filter-health').addEventListener('click', () => filterLog('health'));
      document.getElementById('log-filter-education').addEventListener('click', () => filterLog('education'));
      document.getElementById('log-filter-finance').addEventListener('click', () => filterLog('finance'));

      // Initial UI update (Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø§ÙˆÙ„ÛŒÙ‡ Ø±Ø§Ø¨Ø· Ú©Ø§Ø±Ø¨Ø±ÛŒ)
      updateUI();
    }

    // Start New Life (Ø´Ø±ÙˆØ¹ Ø²Ù†Ø¯Ú¯ÛŒ Ø¬Ø¯ÛŒØ¯)
    function startNewLife() {
      const nameInput = document.getElementById('name-input');
      const name = nameInput.value.trim();
      if (!name || name.length < 2) {
        showMessageModal('Ù„Ø·ÙØ§Ù‹ Ù†Ø§Ù… Ù…Ø¹ØªØ¨Ø± (Ø­Ø¯Ø§Ù‚Ù„ Û² Ø­Ø±Ù) Ø®ÙˆØ¯ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯.');
        nameInput.focus();
        return;
      }
      
      gameState = {
        name: name,
        gender: document.getElementById('gender-select').value,
        province: document.getElementById('province-select').value,
        familyStatus: document.getElementById('family-status').value,
        age: 0,
        year: 2025,
        money: 0,
        happiness: 50,
        health: 80,
        smarts: 50,
        looks: 50,
        spirituality: 50,
        education: { level: 'Ù‡ÛŒÚ†', major: '' },
        job: { title: 'Ø¨ÛŒÚ©Ø§Ø±', salary: 0, level: 0 },
        relationships: [
          { id: 'parent1', name: 'Ù¾Ø¯Ø±', role: 'Ù¾Ø¯Ø±', relationship: 80, respect: 70, happiness: 60 },
          { id: 'parent2', name: 'Ù…Ø§Ø¯Ø±', role: 'Ù…Ø§Ø¯Ø±', relationship: 85, respect: 75, happiness: 65 }
        ],
        illnesses: [],
        assets: [],
        loans: [],
        investments: [],
        log: [],
        financeHistory: [{ year: 2025, money: 0 }]
      };

      // Initial money based on family status (Ù¾ÙˆÙ„ Ø§ÙˆÙ„ÛŒÙ‡ Ø¨Ø± Ø§Ø³Ø§Ø³ ÙˆØ¶Ø¹ÛŒØª Ø®Ø§Ù†ÙˆØ§Ø¯Ú¯ÛŒ)
      switch (gameState.familyStatus) {
        case 'wealthy': gameState.money = 10000000; break;
        case 'poor': gameState.money = 100000; break;
        case 'rural': gameState.money = 200000; break;
        default: gameState.money = 500000; break;
      }

      gameState.log.push({ year: gameState.year, event: `Ø´Ù…Ø§ Ø¯Ø± ${document.querySelector(`#province-select option[value="${gameState.province}"]`).textContent} Ù…ØªÙˆÙ„Ø¯ Ø´Ø¯ÛŒØ¯!`, type: 'family' });
      
      updateUI();
      showPage('dashboard');
      saveGame();
    }

    // Continue Life (Ø§Ø¯Ø§Ù…Ù‡ Ø²Ù†Ø¯Ú¯ÛŒ)
    async function continueLife() {
      if (!db || !userId) {
        // showMessageModal('Firebase Ù‡Ù†ÙˆØ² Ø¢Ù…Ø§Ø¯Ù‡ Ù†ÛŒØ³Øª. Ù„Ø·ÙØ§ ØµØ¨Ø± Ú©Ù†ÛŒØ¯ ÛŒØ§ Ø¨Ø§Ø²ÛŒ Ø¬Ø¯ÛŒØ¯ÛŒ Ø´Ø±ÙˆØ¹ Ú©Ù†ÛŒØ¯.');
        return;
      }
      const docRef = doc(db, `artifacts/${__app_id}/users/${userId}/gameState`, 'current');
      const docSnap = await getDoc(docRef);

      if (docSnap.exists()) {
        gameState = docSnap.data();
        updateUI();
        showPage('dashboard');
        showMessageModal('Ø¨Ø§Ø²ÛŒ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø´Ø¯!');
      } else {
        showMessageModal('Ù‡ÛŒÚ† Ø²Ù†Ø¯Ú¯ÛŒ Ø°Ø®ÛŒØ±Ù‡â€ŒØ´Ø¯Ù‡â€ŒØ§ÛŒ ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯!');
      }
    }

    // Show Page (Ù†Ù…Ø§ÛŒØ´ ØµÙØ­Ù‡)
    function showPage(pageId) {
      const pages = [
        'start-screen', 'dashboard', 'character-page', 'log-page', 
        'education-page', 'job-page', 'relationships-page', 
        'health-page', 'finance-page', 'assets-page', 'settings-page', 'more-menu'
      ];
      pages.forEach(page => {
        const element = document.getElementById(page);
        if (element) {
          element.classList.add('hidden');
        }
      });
      const targetPage = document.getElementById(pageId);
      if (targetPage) {
        targetPage.classList.remove('hidden');
      }
      updateUI();
    }

    // Show More Menu (Ù†Ù…Ø§ÛŒØ´ Ù…Ù†ÙˆÛŒ Ø¨ÛŒØ´ØªØ±)
    function showMoreMenu() {
      document.getElementById('more-menu').classList.remove('hidden');
    }

    // Hide More Menu (Ù¾Ù†Ù‡Ø§Ù† Ú©Ø±Ø¯Ù† Ù…Ù†ÙˆÛŒ Ø¨ÛŒØ´ØªØ±)
    function hideMoreMenu() {
      document.getElementById('more-menu').classList.add('hidden');
    }

    // Update UI (Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø±Ø§Ø¨Ø· Ú©Ø§Ø±Ø¨Ø±ÛŒ)
    function updateUI() {
      // New Dashboard Character Info Block
      document.getElementById('dashboard-char-name').textContent = gameState.name;
      document.getElementById('dashboard-char-age').textContent = `Ø³Ù†: ${gameState.age} Ø³Ø§Ù„Ù‡ - ${gameState.year}`;
      document.getElementById('dashboard-char-money').textContent = `Ù¾ÙˆÙ„: ${gameState.money.toLocaleString('fa-IR')} ØªÙˆÙ…Ø§Ù†`;
      document.getElementById('dashboard-char-job').textContent = `Ø´ØºÙ„: ${gameState.job.title === 'Ø¨ÛŒÚ©Ø§Ø±' && gameState.age < 18 ? 'Ù…Ø­ØµÙ„' : gameState.job.title}`;
      
      // Status Bars (Ù†ÙˆØ§Ø±Ù‡Ø§ÛŒ ÙˆØ¶Ø¹ÛŒØª)
      const updateStatusBar = (id, value) => {
        document.getElementById(`${id}-value`).textContent = `${value}%`;
        document.getElementById(`${id}-bar`).style.width = `${value}%`;
      };
      updateStatusBar('happiness', gameState.happiness);
      updateStatusBar('health', gameState.health);
      updateStatusBar('smarts', gameState.smarts);
      updateStatusBar('looks', gameState.looks);
      updateStatusBar('spirituality', gameState.spirituality);

      // Character Page (ØµÙØ­Ù‡ Ø´Ø®ØµÛŒØª)
      document.getElementById('char-name').textContent = gameState.name;
      document.getElementById('char-gender').textContent = gameState.gender === 'male' ? 'Ù…Ø±Ø¯' : 'Ø²Ù†';
      document.getElementById('char-province').textContent = document.querySelector(`#province-select option[value="${gameState.province}"]`)?.textContent || 'Ù†Ø§Ù…Ø´Ø®Øµ';
      document.getElementById('char-family').textContent = document.querySelector(`#family-status option[value="${gameState.familyStatus}"]`)?.textContent || 'Ù†Ø§Ù…Ø´Ø®Øµ';
      document.getElementById('char-age').textContent = gameState.age;
      document.getElementById('char-smarts').textContent = gameState.smarts;
      document.getElementById('char-looks').textContent = gameState.looks;
      document.getElementById('char-spirituality').textContent = gameState.spirituality;
      
      const familyList = document.getElementById('family-list');
      familyList.innerHTML = gameState.relationships.map(r => `<li>${r.name} (${r.role}) - Ø±Ø§Ø¨Ø·Ù‡: ${r.relationship}%</li>`).join('');

      // Log Pages (ØµÙØ­Ø§Øª ØªØ§Ø±ÛŒØ®Ú†Ù‡)
      filterLog('all'); // Always show all logs by default on update (Ù‡Ù…ÛŒØ´Ù‡ Ù‡Ù…Ù‡ Ú¯Ø²Ø§Ø±Ø´â€ŒÙ‡Ø§ Ø±Ø§ Ø¨Ù‡â€ŒØ·ÙˆØ± Ù¾ÛŒØ´â€ŒÙØ±Ø¶ Ø¯Ø± Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ù†Ù…Ø§ÛŒØ´ Ø¯Ù‡ÛŒØ¯)

      // Education Page (ØµÙØ­Ù‡ ØªØ­ØµÛŒÙ„Ø§Øª)
      const currentEducationTab = document.querySelector('#education-page .btn-primary')?.id;
      if (currentEducationTab === 'university-tab') {
        showUniversity();
      } else {
        showSchool(); // Default to school (Ù¾ÛŒØ´â€ŒÙØ±Ø¶ Ø¨Ù‡ Ù…Ø¯Ø±Ø³Ù‡)
      }

      // Job Page (ØµÙØ­Ù‡ Ø´ØºÙ„)
      const currentJobTab = document.querySelector('#job-page .btn-primary')?.id;
      if (currentJobTab === 'career-progress-tab') {
        showCareerProgress();
      } else {
        showJobList(); // Default to job list (Ù¾ÛŒØ´â€ŒÙØ±Ø¶ Ø¨Ù‡ Ù„ÛŒØ³Øª Ù…Ø´Ø§ØºÙ„)
      }

      // Relationships Page (ØµÙØ­Ù‡ Ø±ÙˆØ§Ø¨Ø·)
      const relList = document.getElementById('relationships-list');
      relList.innerHTML = gameState.relationships.map(r => `
        <div class="glass-card p-4">
          <p><strong>${r.name}</strong> (${r.role})</p>
          <p>Ø±Ø§Ø¨Ø·Ù‡: ${r.relationship}%</p>
          <div class="flex space-x-2 mt-2 flex-wrap gap-2">
            <button class="btn-primary px-2 py-1 rounded-lg" onclick="interact('${r.id}', 'talk')">ØµØ­Ø¨Øª</button>
            <button class="btn-primary px-2 py-1 rounded-lg" onclick="interact('${r.id}', 'gift')">Ù‡Ø¯ÛŒÙ‡</button>
            <button class="btn-secondary px-2 py-1 rounded-lg" onclick="interact('${r.id}', 'argue')">Ø¯Ø¹ÙˆØ§</button>
          </div>
        </div>
      `).join('');

      // Health Page (ØµÙØ­Ù‡ Ø³Ù„Ø§Ù…Øª)
      document.getElementById('health-status').textContent = gameState.health + '%';
      const illnessList = document.getElementById('illness-list');
      illnessList.innerHTML = gameState.illnesses.length ? 
        gameState.illnesses.map(ill => `<li>${ill.name} (Ø´Ø¯Øª: ${ill.severity})</li>`).join('') : 
        '<li>Ø³Ø§Ù„Ù… Ù‡Ø³ØªÛŒØ¯.</li>';
      document.getElementById('illnesses').textContent = gameState.illnesses.length ? gameState.illnesses.map(ill => ill.name).join(', ') : 'Ø³Ø§Ù„Ù…';


      // Finance Page (ØµÙØ­Ù‡ Ù…Ø§Ù„ÛŒ)
      document.getElementById('net-worth').textContent = `${gameState.money.toLocaleString('fa-IR')} ØªÙˆÙ…Ø§Ù†`;
      updateFinanceChart();
      document.getElementById('current-investments').innerHTML = gameState.investments.map(inv => `
        <li>${inv.name} - ${inv.value.toLocaleString('fa-IR')} ØªÙˆÙ…Ø§Ù† (Ø¨Ø§Ø²Ø¯Ù‡: ${(inv.growth * 100).toFixed(1)}%)</li>
      `).join('');
      document.getElementById('current-loans').innerHTML = gameState.loans.map(loan => `
        <li>ÙˆØ§Ù… ${loan.amount.toLocaleString('fa-IR')} ØªÙˆÙ…Ø§Ù† (Ø¨Ø§Ù‚ÛŒâ€ŒÙ…Ø§Ù†Ø¯Ù‡: ${loan.remaining.toLocaleString('fa-IR')} ØªÙˆÙ…Ø§Ù†)</li>
      `).join('');


      // Assets Page (ØµÙØ­Ù‡ Ø¯Ø§Ø±Ø§ÛŒÛŒâ€ŒÙ‡Ø§)
      const currentAssetTab = document.querySelector('#assets-page .btn-primary')?.id;
      if (currentAssetTab === 'vehicles-tab') {
        showAssets('vehicles');
      } else if (currentAssetTab === 'other-assets-tab') {
        showAssets('other');
      } else {
        showAssets('properties'); // Default to properties (Ù¾ÛŒØ´â€ŒÙØ±Ø¶ Ø¨Ù‡ Ø§Ù…Ù„Ø§Ú©)
      }
    }

    // Age Up (ÛŒÚ© Ø³Ø§Ù„ Ø¨Ø²Ø±Ú¯â€ŒØªØ± Ø´Ø¯Ù†)
    async function ageUp() {
      gameState.age++;
      gameState.year++;

      // Base stat changes (ØªØºÛŒÛŒØ±Ø§Øª Ù¾Ø§ÛŒÙ‡ Ø¢Ù…Ø§Ø±)
      gameState.happiness = Math.max(0, Math.min(100, gameState.happiness - 5 + Math.floor(Math.random() * 10)));
      gameState.health = Math.max(0, Math.min(100, gameState.health - 3 + Math.floor(Math.random() * 6)));
      gameState.smarts = Math.min(100, gameState.smarts + (gameState.education.level !== 'Ù‡ÛŒÚ†' ? 2 : 0));
      gameState.looks = Math.max(0, Math.min(100, gameState.looks - 2 + Math.floor(Math.random() * 4)));
      gameState.spirituality = Math.min(100, gameState.spirituality + Math.floor(Math.random() * 5));
      
      // Health decay based on age (Ú©Ø§Ù‡Ø´ Ø³Ù„Ø§Ù…Øª Ø¨Ø± Ø§Ø³Ø§Ø³ Ø³Ù†)
      if (gameState.age > 40) gameState.health = Math.max(0, gameState.health - 2);
      if (gameState.age > 60) gameState.health = Math.max(0, gameState.health - 5);

      // Job salary (Ø­Ù‚ÙˆÙ‚ Ø´ØºÙ„)
      if (gameState.job.title !== 'Ø¨ÛŒÚ©Ø§Ø±') {
        gameState.money += gameState.job.salary;
        gameState.log.push({ year: gameState.year, event: `Ø­Ù‚ÙˆÙ‚ Ù…Ø§Ù‡Ø§Ù†Ù‡ Ø®ÙˆØ¯ Ø±Ø§ Ø§Ø² Ø´ØºÙ„ ${gameState.job.title} Ø¯Ø±ÛŒØ§ÙØª Ú©Ø±Ø¯ÛŒØ¯. (${gameState.job.salary.toLocaleString('fa-IR')} ØªÙˆÙ…Ø§Ù†)`, type: 'finance' });
      }

      // Investment growth (Ø±Ø´Ø¯ Ø³Ø±Ù…Ø§ÛŒÙ‡â€ŒÚ¯Ø°Ø§Ø±ÛŒ)
      gameState.investments.forEach(inv => {
        const growthAmount = inv.value * inv.growth;
        inv.value += growthAmount;
        gameState.money += growthAmount; // Add growth to actual money (Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ø±Ø´Ø¯ Ø¨Ù‡ Ù¾ÙˆÙ„ ÙˆØ§Ù‚Ø¹ÛŒ)
        gameState.log.push({ year: gameState.year, event: `Ø³Ø±Ù…Ø§ÛŒÙ‡â€ŒÚ¯Ø°Ø§Ø±ÛŒ Ø´Ù…Ø§ Ø¯Ø± ${inv.name} ${growthAmount.toLocaleString('fa-IR')} ØªÙˆÙ…Ø§Ù† Ø³ÙˆØ¯ Ú©Ø±Ø¯.`, type: 'finance' });
      });

      // Loan payments (Ù¾Ø±Ø¯Ø§Ø®Øª ÙˆØ§Ù…)
      gameState.loans = gameState.loans.filter(loan => {
        const payment = Math.min(loan.remaining, loan.amount * 0.1); // Pay 10% of original amount or remaining (Ù¾Ø±Ø¯Ø§Ø®Øª Û±Û°Ùª Ø§Ø² Ù…Ø¨Ù„Øº Ø§ØµÙ„ÛŒ ÛŒØ§ Ø¨Ø§Ù‚ÛŒâ€ŒÙ…Ø§Ù†Ø¯Ù‡)
        if (gameState.money < payment) {
          gameState.health = Math.max(0, gameState.health - 5); // Penalty for not affording loan (Ø¬Ø±ÛŒÙ…Ù‡ Ø¹Ø¯Ù… ØªÙˆØ§Ù†Ø§ÛŒÛŒ Ù¾Ø±Ø¯Ø§Ø®Øª ÙˆØ§Ù…)
          gameState.log.push({ year: gameState.year, event: `Ù†ØªÙˆØ§Ù†Ø³ØªÛŒØ¯ Ù‚Ø³Ø· ÙˆØ§Ù… Ø®ÙˆØ¯ Ø±Ø§ Ù¾Ø±Ø¯Ø§Ø®Øª Ú©Ù†ÛŒØ¯! Ø³Ù„Ø§Ù…Øª Ø´Ù…Ø§ Ú©Ø§Ù‡Ø´ ÛŒØ§ÙØª.`, type: 'finance' });
          return true; // Keep loan (ÙˆØ§Ù… Ø±Ø§ Ù†Ú¯Ù‡ Ø¯Ø§Ø±ÛŒØ¯)
        }
        gameState.money -= payment;
        loan.remaining -= payment;
        gameState.log.push({ year: gameState.year, event: `Ù‚Ø³Ø· ÙˆØ§Ù… Ø®ÙˆØ¯ Ø±Ø§ Ø¨Ù‡ Ù…Ø¨Ù„Øº ${payment.toLocaleString('fa-IR')} ØªÙˆÙ…Ø§Ù† Ù¾Ø±Ø¯Ø§Ø®Øª Ú©Ø±Ø¯ÛŒØ¯.`, type: 'finance' });
        return loan.remaining > 0; // Remove if fully paid (Ø§Ú¯Ø± Ú©Ø§Ù…Ù„ Ù¾Ø±Ø¯Ø§Ø®Øª Ø´Ø¯ØŒ Ø­Ø°Ù Ú©Ù†ÛŒØ¯)
      });

      // Random events (Ø±ÙˆÛŒØ¯Ø§Ø¯Ù‡Ø§ÛŒ ØªØµØ§Ø¯ÙÛŒ)
      const events = [
        { event: 'Ø´Ù…Ø§ ÛŒÚ© Ø³Ø§Ù„ Ø¨Ø²Ø±Ú¯â€ŒØªØ± Ø´Ø¯ÛŒØ¯!', type: 'general' },
        { event: 'Ø¨Ù‡ ÛŒÚ© Ø¹Ø±ÙˆØ³ÛŒ Ø¯Ø¹ÙˆØª Ø´Ø¯ÛŒØ¯!', type: 'family', effect: () => gameState.happiness = Math.min(100, gameState.happiness + 10) },
        { event: 'ÛŒÚ© Ø¨ÛŒÙ…Ø§Ø±ÛŒ Ø®ÙÛŒÙ Ú¯Ø±ÙØªÛŒØ¯.', type: 'health', effect: () => { gameState.health = Math.max(0, gameState.health - 10); gameState.illnesses.push({ name: 'Ø³Ø±Ù…Ø§Ø®ÙˆØ±Ø¯Ú¯ÛŒ', severity: 'Ø®ÙÛŒÙ' }); } },
        { event: 'ÛŒÚ© Ø¯ÙˆØ³Øª Ø¬Ø¯ÛŒØ¯ Ù¾ÛŒØ¯Ø§ Ú©Ø±Ø¯ÛŒØ¯!', type: 'family', effect: () => gameState.relationships.push({ id: crypto.randomUUID(), name: 'Ø¯ÙˆØ³Øª Ø¬Ø¯ÛŒØ¯', role: 'Ø¯ÙˆØ³Øª', relationship: 50, respect: 50, happiness: 50 }) },
        { event: 'ÛŒÚ© Ø¬Ø§ÛŒØ²Ù‡ Ú©ÙˆÚ†Ú© Ø¨Ø±Ø¯ÛŒØ¯!', type: 'finance', effect: () => gameState.money += 100000 },
        { event: 'Ø¯Ø± ØªØ±Ø§ÙÛŒÚ© Ú¯ÛŒØ± Ú©Ø±Ø¯ÛŒØ¯ Ùˆ Ø¯ÛŒØ±ØªØ§Ù† Ø´Ø¯.', type: 'general', effect: () => gameState.happiness = Math.max(0, gameState.happiness - 5) },
        { event: 'ÛŒÚ© Ú©ØªØ§Ø¨ Ø¬Ø¯ÛŒØ¯ Ø®ÙˆØ§Ù†Ø¯ÛŒØ¯ Ùˆ Ù‡ÙˆØ´ Ø´Ù…Ø§ Ø§ÙØ²Ø§ÛŒØ´ ÛŒØ§ÙØª.', type: 'education', effect: () => gameState.smarts = Math.min(100, gameState.smarts + 3) },
        { event: 'Ù…Ø¯ØªÛŒ Ø±Ø§ Ø¯Ø± Ø·Ø¨ÛŒØ¹Øª Ú¯Ø°Ø±Ø§Ù†Ø¯ÛŒØ¯ Ùˆ Ù…Ø¹Ù†ÙˆÛŒØª Ø´Ù…Ø§ Ø§ÙØ²Ø§ÛŒØ´ ÛŒØ§ÙØª.', type: 'spirituality', effect: () => gameState.spirituality = Math.min(100, gameState.spirituality + 5) },
        { event: 'ÛŒÚ© ÙˆØ³ÛŒÙ„Ù‡ Ø§Ù„Ú©ØªØ±ÙˆÙ†ÛŒÚ©ÛŒ Ø´Ù…Ø§ Ø®Ø±Ø§Ø¨ Ø´Ø¯ Ùˆ Ù‡Ø²ÛŒÙ†Ù‡ ØªØ¹Ù…ÛŒØ± Ø¯Ø§Ø´ØªÛŒØ¯.', type: 'finance', effect: () => gameState.money = Math.max(0, gameState.money - 50000) }
      ];
      const randomEvent = events[Math.floor(Math.random() * events.length)];
      gameState.log.push({ year: gameState.year, event: randomEvent.event, type: randomEvent.type });
      if (randomEvent.effect) randomEvent.effect();

      // Add current money to finance history (Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ù¾ÙˆÙ„ ÙØ¹Ù„ÛŒ Ø¨Ù‡ ØªØ§Ø±ÛŒØ®Ú†Ù‡ Ù…Ø§Ù„ÛŒ)
      gameState.financeHistory.push({ year: gameState.year, money: gameState.money });

      updateUI();
      saveGame();
    }

    // Education (ØªØ­ØµÛŒÙ„Ø§Øª)
    function showSchool() {
      const content = document.getElementById('education-content');
      let schoolOptions = '';
      if (gameState.age < 6) {
        schoolOptions = '<p>Ø´Ù…Ø§ Ø¨Ø±Ø§ÛŒ Ø´Ø±ÙˆØ¹ ØªØ­ØµÛŒÙ„ Ø®ÛŒÙ„ÛŒ Ú©ÙˆÚ†Ú© Ù‡Ø³ØªÛŒØ¯.</p>';
      } else if (gameState.age < 12) {
        schoolOptions = `
          <p>ÙˆØ¶Ø¹ÛŒØª ØªØ­ØµÛŒÙ„ÛŒ: Ø¯Ø¨Ø³ØªØ§Ù† (${gameState.education.level === 'Ø¯Ø¨Ø³ØªØ§Ù†' ? 'Ø¯Ø± Ø­Ø§Ù„ ØªØ­ØµÛŒÙ„' : 'ÙØ§Ø±Øºâ€ŒØ§Ù„ØªØ­ØµÛŒÙ„'})</p>
          <button class="btn-primary px-4 py-2 rounded-lg mt-2" onclick="study('primary')">Ø¯Ø±Ø³ Ø¨Ø®ÙˆØ§Ù†ÛŒØ¯</button>
        `;
      } else if (gameState.age < 15) {
        schoolOptions = `
          <p>ÙˆØ¶Ø¹ÛŒØª ØªØ­ØµÛŒÙ„ÛŒ: Ø±Ø§Ù‡Ù†Ù…Ø§ÛŒÛŒ (${gameState.education.level === 'Ø±Ø§Ù‡Ù†Ù…Ø§ÛŒÛŒ' ? 'Ø¯Ø± Ø­Ø§Ù„ ØªØ­ØµÛŒÙ„' : 'ÙØ§Ø±Øºâ€ŒØ§Ù„ØªØ­ØµÛŒÙ„'})</p>
          <button class="btn-primary px-4 py-2 rounded-lg mt-2" onclick="study('middle')">Ø¯Ø±Ø³ Ø¨Ø®ÙˆØ§Ù†ÛŒØ¯</button>
        `;
      } else if (gameState.age < 18) {
        schoolOptions = `
          <p>ÙˆØ¶Ø¹ÛŒØª ØªØ­ØµÛŒÙ„ÛŒ: Ø¯Ø¨ÛŒØ±Ø³ØªØ§Ù† (${gameState.education.level === 'Ø¯Ø¨ÛŒØ±Ø³ØªØ§Ù†' ? 'Ø¯Ø± Ø­Ø§Ù„ ØªØ­ØµÛŒÙ„' : 'ÙØ§Ø±Øºâ€ŒØ§Ù„ØªØ­ØµÛŒÙ„'})</p>
          <button class="btn-primary px-4 py-2 rounded-lg mt-2" onclick="study('high')">Ø¯Ø±Ø³ Ø¨Ø®ÙˆØ§Ù†ÛŒØ¯</button>
        `;
      } else {
        schoolOptions = `
          <p>Ø´Ù…Ø§ ØªØ­ØµÛŒÙ„Ø§Øª Ù…Ø¯Ø±Ø³Ù‡ Ø±Ø§ Ø¨Ù‡ Ù¾Ø§ÛŒØ§Ù† Ø±Ø³Ø§Ù†Ø¯Ù‡â€ŒØ§ÛŒØ¯.</p>
          <button class="btn-primary px-4 py-2 rounded-lg mt-2" onclick="study('general')">Ù…Ø·Ø§Ù„Ø¹Ù‡ Ø¢Ø²Ø§Ø¯</button>
        `;
      }
      content.innerHTML = schoolOptions;

      document.getElementById('school-tab').classList.add('btn-primary');
      document.getElementById('school-tab').classList.remove('btn-secondary');
      document.getElementById('university-tab').classList.add('btn-secondary');
      document.getElementById('university-tab').classList.remove('btn-primary');
    }

    function showUniversity() {
      const content = document.getElementById('education-content');
      if (gameState.age < 18 || gameState.education.level !== 'Ø¯Ø¨ÛŒØ±Ø³ØªØ§Ù†') {
        content.innerHTML = '<p>Ø¨Ø±Ø§ÛŒ ÙˆØ±ÙˆØ¯ Ø¨Ù‡ Ø¯Ø§Ù†Ø´Ú¯Ø§Ù‡ Ø¨Ø§ÛŒØ¯ Ø­Ø¯Ø§Ù‚Ù„ Û±Û¸ Ø³Ø§Ù„ Ø¯Ø§Ø´ØªÙ‡ Ø¨Ø§Ø´ÛŒØ¯ Ùˆ Ø¯Ø¨ÛŒØ±Ø³ØªØ§Ù† Ø±Ø§ ØªÙ…Ø§Ù… Ú©Ø±Ø¯Ù‡ Ø¨Ø§Ø´ÛŒØ¯.</p>';
      } else {
        content.innerHTML = `
          <p>ÙˆØ¶Ø¹ÛŒØª ØªØ­ØµÛŒÙ„ÛŒ: ${gameState.education.major ? `Ø¯Ø§Ù†Ø´Ø¬Ùˆ (${gameState.education.major})` : 'Ø¢Ù…Ø§Ø¯Ù‡ Ø¨Ø±Ø§ÛŒ Ø§Ù†ØªØ®Ø§Ø¨ Ø±Ø´ØªÙ‡'}</p>
          <p>Ø§Ù†ØªØ®Ø§Ø¨ Ø±Ø´ØªÙ‡:</p>
          <select id="major-select" class="w-full p-2 bg-gray-800 rounded-lg mb-4">
            <option value="Ù¾Ø²Ø´Ú©ÛŒ">Ù¾Ø²Ø´Ú©ÛŒ (Ù†ÛŒØ§Ø² Ø¨Ù‡ Ù‡ÙˆØ´ Ø¨Ø§Ù„Ø§)</option>
            <option value="Ù…Ù‡Ù†Ø¯Ø³ÛŒ">Ù…Ù‡Ù†Ø¯Ø³ÛŒ (Ù†ÛŒØ§Ø² Ø¨Ù‡ Ù‡ÙˆØ´ Ù…ØªÙˆØ³Ø·)</option>
            <option value="Ø­Ù‚ÙˆÙ‚">Ø­Ù‚ÙˆÙ‚ (Ù†ÛŒØ§Ø² Ø¨Ù‡ Ù‡ÙˆØ´ Ù…ØªÙˆØ³Ø·)</option>
            <option value="Ù‡Ù†Ø±">Ù‡Ù†Ø± (Ù†ÛŒØ§Ø² Ø¨Ù‡ Ø¸Ø§Ù‡Ø± Ùˆ Ø´Ø§Ø¯ÛŒ)</option>
            <option value="Ù…Ø¯ÛŒØ±ÛŒØª">Ù…Ø¯ÛŒØ±ÛŒØª</option>
          </select>
          <button class="btn-primary px-4 py-2 rounded-lg" onclick="applyUniversity()">Ø«Ø¨Øªâ€ŒÙ†Ø§Ù…/Ø§Ø¯Ø§Ù…Ù‡ ØªØ­ØµÛŒÙ„</button>
        `;
      }
      document.getElementById('university-tab').classList.add('btn-primary');
      document.getElementById('university-tab').classList.remove('btn-secondary');
      document.getElementById('school-tab').classList.add('btn-secondary');
      document.getElementById('school-tab').classList.remove('btn-primary');
    }

    function study(level) {
      gameState.smarts = Math.min(100, gameState.smarts + 5);
      let logMessage = '';
      if (level === 'primary') {
        gameState.education.level = 'Ø¯Ø¨Ø³ØªØ§Ù†';
        logMessage = 'Ø´Ù…Ø§ Ø¯Ø± Ø¯Ø¨Ø³ØªØ§Ù† Ø¯Ø±Ø³ Ø®ÙˆØ§Ù†Ø¯ÛŒØ¯.';
      } else if (level === 'middle') {
        gameState.education.level = 'Ø±Ø§Ù‡Ù†Ù…Ø§ÛŒÛŒ';
        logMessage = 'Ø´Ù…Ø§ Ø¯Ø± Ø±Ø§Ù‡Ù†Ù…Ø§ÛŒÛŒ Ø¯Ø±Ø³ Ø®ÙˆØ§Ù†Ø¯ÛŒØ¯.';
      } else if (level === 'high') {
        gameState.education.level = 'Ø¯Ø¨ÛŒØ±Ø³ØªØ§Ù†';
        logMessage = 'Ø´Ù…Ø§ Ø¯Ø± Ø¯Ø¨ÛŒØ±Ø³ØªØ§Ù† Ø¯Ø±Ø³ Ø®ÙˆØ§Ù†Ø¯ÛŒØ¯.';
      } else if (level === 'general') {
        logMessage = 'Ø´Ù…Ø§ Ù…Ø·Ø§Ù„Ø¹Ù‡ Ø¢Ø²Ø§Ø¯ Ø¯Ø§Ø´ØªÛŒØ¯ Ùˆ Ù‡ÙˆØ´ Ø´Ù…Ø§ Ø§ÙØ²Ø§ÛŒØ´ ÛŒØ§ÙØª.';
      }
      gameState.log.push({ year: gameState.year, event: logMessage, type: 'education' });
      updateUI();
      saveGame();
    }

    function applyUniversity() {
      if (gameState.age < 18 || gameState.education.level !== 'Ø¯Ø¨ÛŒØ±Ø³ØªØ§Ù†') {
        showMessageModal('Ø¨Ø±Ø§ÛŒ ÙˆØ±ÙˆØ¯ Ø¨Ù‡ Ø¯Ø§Ù†Ø´Ú¯Ø§Ù‡ Ø¨Ø§ÛŒØ¯ Ø­Ø¯Ø§Ù‚Ù„ Û±Û¸ Ø³Ø§Ù„ Ø¯Ø§Ø´ØªÙ‡ Ø¨Ø§Ø´ÛŒØ¯ Ùˆ Ø¯Ø¨ÛŒØ±Ø³ØªØ§Ù† Ø±Ø§ ØªÙ…Ø§Ù… Ú©Ø±Ø¯Ù‡ Ø¨Ø§Ø´ÛŒØ¯.');
        return;
      }
      const selectedMajor = document.getElementById('major-select').value;
      
      // Check requirements for majors (Ø¨Ø±Ø±Ø³ÛŒ Ø§Ù„Ø²Ø§Ù…Ø§Øª Ø¨Ø±Ø§ÛŒ Ø±Ø´ØªÙ‡â€ŒÙ‡Ø§)
      if (selectedMajor === 'Ù¾Ø²Ø´Ú©ÛŒ' && gameState.smarts < 70) {
        showMessageModal('Ù‡ÙˆØ´ Ø´Ù…Ø§ Ø¨Ø±Ø§ÛŒ Ø±Ø´ØªÙ‡ Ù¾Ø²Ø´Ú©ÛŒ Ú©Ø§ÙÛŒ Ù†ÛŒØ³Øª. (Ù†ÛŒØ§Ø² Ø¨Ù‡ Ù‡ÙˆØ´ Û·Û°)');
        return;
      }
      if ((selectedMajor === 'Ù…Ù‡Ù†Ø¯Ø³ÛŒ' || selectedMajor === 'Ø­Ù‚ÙˆÙ‚') && gameState.smarts < 60) {
        showMessageModal('Ù‡ÙˆØ´ Ø´Ù…Ø§ Ø¨Ø±Ø§ÛŒ Ø§ÛŒÙ† Ø±Ø´ØªÙ‡ Ú©Ø§ÙÛŒ Ù†ÛŒØ³Øª. (Ù†ÛŒØ§Ø² Ø¨Ù‡ Ù‡ÙˆØ´ Û¶Û°)');
        return;
      }
      if (selectedMajor === 'Ù‡Ù†Ø±' && (gameState.looks < 50 || gameState.happiness < 50)) {
        showMessageModal('Ø¨Ø±Ø§ÛŒ Ø±Ø´ØªÙ‡ Ù‡Ù†Ø± Ù†ÛŒØ§Ø² Ø¨Ù‡ Ø¸Ø§Ù‡Ø± Ùˆ Ø´Ø§Ø¯ÛŒ Ø¨ÛŒØ´ØªØ±ÛŒ Ø¯Ø§Ø±ÛŒØ¯. (Ù†ÛŒØ§Ø² Ø¨Ù‡ Ø¸Ø§Ù‡Ø± ÛµÛ° Ùˆ Ø´Ø§Ø¯ÛŒ ÛµÛ°)');
        return;
      }

      gameState.education.level = 'Ø¯Ø§Ù†Ø´Ú¯Ø§Ù‡';
      gameState.education.major = selectedMajor;
      gameState.log.push({ year: gameState.year, event: `Ø´Ù…Ø§ Ø¯Ø± Ø±Ø´ØªÙ‡ ${selectedMajor} Ø¯Ø± Ø¯Ø§Ù†Ø´Ú¯Ø§Ù‡ Ø«Ø¨Øªâ€ŒÙ†Ø§Ù… Ú©Ø±Ø¯ÛŒØ¯.`, type: 'education' });
      updateUI();
      saveGame();
    }

    // Jobs (Ø´ØºÙ„â€ŒÙ‡Ø§)
    const availableJobs = [
      { name: 'Ú©Ø§Ø±Ú¯Ø± Ø³Ø§Ø¯Ù‡', salary: 3000000, req: 'none', minAge: 18 },
      { name: 'ÙØ±ÙˆØ´Ù†Ø¯Ù‡', salary: 4000000, req: 'none', minAge: 18 },
      { name: 'Ù…Ø¹Ù„Ù…', salary: 7000000, req: 'Ø¯Ø§Ù†Ø´Ú¯Ø§Ù‡', minAge: 22 },
      { name: 'Ú©Ø§Ø±Ù…Ù†Ø¯ Ø¯ÙˆÙ„Øª', salary: 6000000, req: 'Ø¯Ø§Ù†Ø´Ú¯Ø§Ù‡', minAge: 20 },
      { name: 'Ø±Ø§Ù†Ù†Ø¯Ù‡ ØªØ§Ú©Ø³ÛŒ', salary: 5000000, req: 'none', minAge: 20 },
      { name: 'Ù¾Ø²Ø´Ú© Ø¹Ù…ÙˆÙ…ÛŒ', salary: 25000000, req: 'Ù¾Ø²Ø´Ú©ÛŒ', minAge: 26 },
      { name: 'Ù…Ù‡Ù†Ø¯Ø³ Ù†Ø±Ù…â€ŒØ§ÙØ²Ø§Ø±', salary: 20000000, req: 'Ù…Ù‡Ù†Ø¯Ø³ÛŒ', minAge: 24 },
      { name: 'ÙˆÚ©ÛŒÙ„ Ù¾Ø§ÛŒÙ‡ ÛŒÚ©', salary: 18000000, req: 'Ø­Ù‚ÙˆÙ‚', minAge: 25 },
      { name: 'Ù‡Ù†Ø±Ù…Ù†Ø¯ Ù†Ù‚Ø§Ø´', salary: 5000000, req: 'Ù‡Ù†Ø±', minAge: 20 },
      { name: 'Ù…Ø¯ÛŒØ± Ù¾Ø±ÙˆÚ˜Ù‡', salary: 15000000, req: 'Ù…Ø¯ÛŒØ±ÛŒØª', minAge: 28 },
    ];

    function showJobList() {
      const content = document.getElementById('job-content');
      content.innerHTML = `
        <p class="mb-4">Ø´ØºÙ„ ÙØ¹Ù„ÛŒ: ${gameState.job.title === 'Ø¨ÛŒÚ©Ø§Ø±' ? 'Ø¨ÛŒÚ©Ø§Ø±' : `${gameState.job.title} (Ø¯Ø±Ø¢Ù…Ø¯ Ù…Ø§Ù‡Ø§Ù†Ù‡: ${gameState.job.salary.toLocaleString('fa-IR')} ØªÙˆÙ…Ø§Ù†)`}</p>
        <div class="space-y-2">
          ${availableJobs.map(job => `
            <div class="glass-card p-4 flex flex-col sm:flex-row justify-between items-center">
              <div>
                <p class="font-semibold">${job.name}</p>
                <p class="text-sm text-gray-400">${job.salary.toLocaleString('fa-IR')} ØªÙˆÙ…Ø§Ù†/Ù…Ø§Ù‡</p>
                ${job.req !== 'none' ? `<p class="text-xs text-gray-500">Ù†ÛŒØ§Ø²: ${job.req} (Ø³Ù†: ${job.minAge}+)</p>` : `<p class="text-xs text-gray-500">Ù†ÛŒØ§Ø²: Ù†Ø¯Ø§Ø±Ø¯ (Ø³Ù†: ${job.minAge}+)</p>`}
              </div>
              <button class="btn-primary px-4 py-2 rounded-lg mt-2 sm:mt-0" onclick="applyJob('${job.name}', ${job.salary}, '${job.req}', ${job.minAge})">Ø¯Ø±Ø®ÙˆØ§Ø³Øª</button>
            </div>
          `).join('')}
        </div>
      `;
      document.getElementById('job-list-tab').classList.add('btn-primary');
      document.getElementById('job-list-tab').classList.remove('btn-secondary');
      document.getElementById('career-progress-tab').classList.add('btn-secondary');
      document.getElementById('career-progress-tab').classList.remove('btn-primary');
    }

    function showCareerProgress() {
      const content = document.getElementById('job-content');
      content.innerHTML = `
        <p>Ø´ØºÙ„ ÙØ¹Ù„ÛŒ: ${gameState.job.title}</p>
        <p>Ø¯Ø±Ø¢Ù…Ø¯ Ù…Ø§Ù‡Ø§Ù†Ù‡: ${gameState.job.salary.toLocaleString('fa-IR')} ØªÙˆÙ…Ø§Ù†</p>
        <p>Ø³Ø·Ø­ Ø´ØºÙ„ÛŒ: ${gameState.job.level}</p>
        ${gameState.job.title !== 'Ø¨ÛŒÚ©Ø§Ø±' ? `
          <button class="btn-primary px-4 py-2 rounded-lg mt-4" onclick="promoteJob()">Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ø§Ø±ØªÙ‚Ø§</button>
          <button class="btn-secondary px-4 py-2 rounded-lg mt-4 ml-2" onclick="resignJob()">Ø§Ø³ØªØ¹ÙØ§</button>
        ` : '<p class="text-gray-400 mt-2">Ø´Ù…Ø§ Ø¯Ø± Ø­Ø§Ù„ Ø­Ø§Ø¶Ø± Ø´ØºÙ„ÛŒ Ù†Ø¯Ø§Ø±ÛŒØ¯.</p>'}
      `;
      document.getElementById('career-progress-tab').classList.add('btn-primary');
      document.getElementById('career-progress-tab').classList.remove('btn-secondary');
      document.getElementById('job-list-tab').classList.add('btn-secondary');
      document.getElementById('job-list-tab').classList.remove('btn-primary');
    }

    function applyJob(name, salary, req, minAge) {
      if (gameState.age < minAge) {
        showMessageModal(`Ø¨Ø±Ø§ÛŒ Ø§ÛŒÙ† Ø´ØºÙ„ Ø¨Ø§ÛŒØ¯ Ø­Ø¯Ø§Ù‚Ù„ ${minAge} Ø³Ø§Ù„ Ø¯Ø§Ø´ØªÙ‡ Ø¨Ø§Ø´ÛŒØ¯.`);
        return;
      }
      if (req !== 'none' && gameState.education.major !== req && gameState.education.level !== req) {
        showMessageModal(`Ù†ÛŒØ§Ø² Ø¨Ù‡ ØªØ­ØµÛŒÙ„Ø§Øª ${req} Ø¯Ø§Ø±ÛŒØ¯!`);
        return;
      }
      
      gameState.job = { title: name, salary: salary, level: 1 };
      gameState.log.push({ year: gameState.year, event: `Ø´Ù…Ø§ Ø¨Ù‡ Ø¹Ù†ÙˆØ§Ù† ${name} Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø´Ø¯ÛŒØ¯.`, type: 'career' });
      updateUI();
      saveGame();
    }

    function promoteJob() {
      if (gameState.job.title === 'Ø¨ÛŒÚ©Ø§Ø±') {
        showMessageModal('Ø´Ù…Ø§ Ø´ØºÙ„ÛŒ Ù†Ø¯Ø§Ø±ÛŒØ¯ Ú©Ù‡ Ø§Ø±ØªÙ‚Ø§ Ø¨Ú¯ÛŒØ±ÛŒØ¯.');
        return;
      }
      // Simple promotion logic (Ù…Ù†Ø·Ù‚ Ø§Ø±ØªÙ‚Ø§Ø¡ Ø³Ø§Ø¯Ù‡)
      const success = Math.random() < (gameState.smarts / 100) + (gameState.job.level * 0.1); // Smarts and current level affect success (Ù‡ÙˆØ´ Ùˆ Ø³Ø·Ø­ ÙØ¹Ù„ÛŒ Ø¨Ø± Ù…ÙˆÙÙ‚ÛŒØª ØªØ£Ø«ÛŒØ± Ù…ÛŒâ€ŒÚ¯Ø°Ø§Ø±Ø¯)
      if (success) {
        gameState.job.level++;
        gameState.job.salary = Math.floor(gameState.job.salary * 1.2); // 20% salary increase (Ø§ÙØ²Ø§ÛŒØ´ Û²Û°Ùª Ø­Ù‚ÙˆÙ‚)
        gameState.log.push({ year: gameState.year, event: `Ø´Ù…Ø§ Ø¯Ø± Ø´ØºÙ„ ${gameState.job.title} Ø§Ø±ØªÙ‚Ø§ ÛŒØ§ÙØªÛŒØ¯! Ø³Ø·Ø­ ${gameState.job.level} Ø¨Ø§ Ø­Ù‚ÙˆÙ‚ ${gameState.job.salary.toLocaleString('fa-IR')} ØªÙˆÙ…Ø§Ù†.`, type: 'career' });
        showMessageModal('ØªØ¨Ø±ÛŒÚ©! Ø´Ù…Ø§ Ø§Ø±ØªÙ‚Ø§ ÛŒØ§ÙØªÛŒØ¯.');
      } else {
        gameState.log.push({ year: gameState.year, event: `ØªÙ„Ø§Ø´ Ø¨Ø±Ø§ÛŒ Ø§Ø±ØªÙ‚Ø§ Ø¯Ø± Ø´ØºÙ„ ${gameState.job.title} Ù†Ø§Ù…ÙˆÙÙ‚ Ø¨ÙˆØ¯.`, type: 'career' });
        showMessageModal('ØªÙ„Ø§Ø´ Ø´Ù…Ø§ Ø¨Ø±Ø§ÛŒ Ø§Ø±ØªÙ‚Ø§ Ù…ÙˆÙÙ‚ Ù†Ø¨ÙˆØ¯.');
      }
      updateUI();
      saveGame();
    }

    function resignJob() {
      if (gameState.job.title === 'Ø¨ÛŒÚ©Ø§Ø±') {
        showMessageModal('Ø´Ù…Ø§ Ø¯Ø± Ø­Ø§Ù„ Ø­Ø§Ø¶Ø± Ø´ØºÙ„ÛŒ Ù†Ø¯Ø§Ø±ÛŒØ¯ Ú©Ù‡ Ø§Ø³ØªØ¹ÙØ§ Ø¯Ù‡ÛŒØ¯.');
        return;
      }
      gameState.job = { title: 'Ø¨ÛŒÚ©Ø§Ø±', salary: 0, level: 0 };
      gameState.log.push({ year: gameState.year, event: 'Ø´Ù…Ø§ Ø§Ø² Ø´ØºÙ„ Ø®ÙˆØ¯ Ø§Ø³ØªØ¹ÙØ§ Ø¯Ø§Ø¯ÛŒØ¯.', type: 'career' });
      updateUI();
      saveGame();
    }

    // Relationships (Ø±ÙˆØ§Ø¨Ø·)
    function interact(personId, action) {
      const person = gameState.relationships.find(r => r.id === personId);
      if (!person) return;

      if (action === 'talk') {
        person.relationship = Math.min(100, person.relationship + 5);
        gameState.happiness = Math.min(100, gameState.happiness + 3);
        gameState.log.push({ year: gameState.year, event: `Ø´Ù…Ø§ Ø¨Ø§ ${person.name} ØµØ­Ø¨Øª Ú©Ø±Ø¯ÛŒØ¯.`, type: 'family' });
      } else if (action === 'gift') {
        if (gameState.money < 100000) {
          showMessageModal('Ù¾ÙˆÙ„ Ú©Ø§ÙÛŒ Ø¨Ø±Ø§ÛŒ Ø®Ø±ÛŒØ¯ Ù‡Ø¯ÛŒÙ‡ Ù†Ø¯Ø§Ø±ÛŒØ¯! (Ø­Ø¯Ø§Ù‚Ù„ Û±Û°Û°,Û°Û°Û° ØªÙˆÙ…Ø§Ù†)');
          return;
        }
        person.relationship = Math.min(100, person.relationship + 10);
        gameState.money -= 100000;
        gameState.log.push({ year: gameState.year, event: `Ø´Ù…Ø§ Ø¨Ù‡ ${person.name} Ù‡Ø¯ÛŒÙ‡ Ø¯Ø§Ø¯ÛŒØ¯.`, type: 'family' });
      } else if (action === 'argue') {
        person.relationship = Math.max(0, person.relationship - 15);
        gameState.happiness = Math.max(0, gameState.happiness - 5);
        gameState.log.push({ year: gameState.year, event: `Ø´Ù…Ø§ Ø¨Ø§ ${person.name} Ø¯Ø¹ÙˆØ§ Ú©Ø±Ø¯ÛŒØ¯.`, type: 'family' });
      }
      updateUI();
      saveGame();
    }

    // Health (Ø³Ù„Ø§Ù…Øª)
    function visitDoctor() {
      const cost = 50000;
      if (gameState.money < cost) {
        showMessageModal(`Ù¾ÙˆÙ„ Ú©Ø§ÙÛŒ Ø¨Ø±Ø§ÛŒ Ù…Ø±Ø§Ø¬Ø¹Ù‡ Ø¨Ù‡ Ù¾Ø²Ø´Ú© Ù†Ø¯Ø§Ø±ÛŒØ¯! (Ù‡Ø²ÛŒÙ†Ù‡: ${cost.toLocaleString('fa-IR')} ØªÙˆÙ…Ø§Ù†)`);
        return;
      }
      gameState.money -= cost;
      gameState.health = Math.min(100, gameState.health + 20);
      gameState.illnesses = []; // Clear illnesses (Ø¨ÛŒÙ…Ø§Ø±ÛŒâ€ŒÙ‡Ø§ Ø±Ø§ Ù¾Ø§Ú© Ù…ÛŒâ€ŒÚ©Ù†Ø¯)
      gameState.log.push({ year: gameState.year, event: 'Ø´Ù…Ø§ Ø¨Ù‡ Ù¾Ø²Ø´Ú© Ù…Ø±Ø§Ø¬Ø¹Ù‡ Ú©Ø±Ø¯ÛŒØ¯ Ùˆ Ø­Ø§Ù„ØªØ§Ù† Ø¨Ù‡ØªØ± Ø´Ø¯.', type: 'health' });
      updateUI();
      saveGame();
    }

    function goGym() {
      const cost = 20000;
      if (gameState.money < cost) {
        showMessageModal(`Ù¾ÙˆÙ„ Ú©Ø§ÙÛŒ Ø¨Ø±Ø§ÛŒ Ø±ÙØªÙ† Ø¨Ù‡ Ø¨Ø§Ø´Ú¯Ø§Ù‡ Ù†Ø¯Ø§Ø±ÛŒØ¯! (Ù‡Ø²ÛŒÙ†Ù‡: ${cost.toLocaleString('fa-IR')} ØªÙˆÙ…Ø§Ù†)`);
        return;
      }
      gameState.money -= cost;
      gameState.health = Math.min(100, gameState.health + 10);
      gameState.looks = Math.min(100, gameState.looks + 5);
      gameState.log.push({ year: gameState.year, event: 'Ø´Ù…Ø§ ÙˆØ±Ø²Ø´ Ú©Ø±Ø¯ÛŒØ¯ Ùˆ Ø³Ø§Ù„Ù…â€ŒØªØ± Ø´Ø¯ÛŒØ¯.', type: 'health' });
      updateUI();
      saveGame();
    }

    function meditate() {
      gameState.spirituality = Math.min(100, gameState.spirituality + 10);
      gameState.happiness = Math.min(100, gameState.happiness + 5);
      gameState.log.push({ year: gameState.year, event: 'Ø´Ù…Ø§ Ù…Ø±Ø§Ù‚Ø¨Ù‡ Ú©Ø±Ø¯ÛŒØ¯ Ùˆ Ø¢Ø±Ø§Ù…Ø´ Ø¨ÛŒØ´ØªØ±ÛŒ ÛŒØ§ÙØªÛŒØ¯.', type: 'spirituality' });
      updateUI();
      saveGame();
    }

    // Finance (Ù…Ø§Ù„ÛŒ)
    function invest() {
      const amountInput = document.getElementById('investment-amount');
      const amount = parseInt(amountInput.value);

      if (isNaN(amount) || amount < 100000) {
        showMessageModal('Ù…Ø¨Ù„Øº Ø³Ø±Ù…Ø§ÛŒÙ‡â€ŒÚ¯Ø°Ø§Ø±ÛŒ Ø¨Ø§ÛŒØ¯ Ø­Ø¯Ø§Ù‚Ù„ Û±Û°Û°,Û°Û°Û° ØªÙˆÙ…Ø§Ù† Ø¨Ø§Ø´Ø¯.');
        return;
      }
      if (gameState.money < amount) {
        showMessageModal('Ù¾ÙˆÙ„ Ú©Ø§ÙÛŒ Ø¨Ø±Ø§ÛŒ Ø§ÛŒÙ† Ø³Ø±Ù…Ø§ÛŒÙ‡â€ŒÚ¯Ø°Ø§Ø±ÛŒ Ù†Ø¯Ø§Ø±ÛŒØ¯!');
        return;
      }

      gameState.money -= amount;
      const investmentName = `Ø³Ø±Ù…Ø§ÛŒÙ‡â€ŒÚ¯Ø°Ø§Ø±ÛŒ ${gameState.investments.length + 1}`;
      gameState.investments.push({ name: investmentName, value: amount, growth: 0.05 + (Math.random() * 0.05) }); // 5-10% annual growth (Ûµ-Û±Û°Ùª Ø±Ø´Ø¯ Ø³Ø§Ù„Ø§Ù†Ù‡)
      gameState.log.push({ year: gameState.year, event: `Ø´Ù…Ø§ ${amount.toLocaleString('fa-IR')} ØªÙˆÙ…Ø§Ù† Ø¯Ø± ${investmentName} Ø³Ø±Ù…Ø§ÛŒÙ‡â€ŒÚ¯Ø°Ø§Ø±ÛŒ Ú©Ø±Ø¯ÛŒØ¯.`, type: 'finance' });
      showMessageModal(`Ø´Ù…Ø§ ${amount.toLocaleString('fa-IR')} ØªÙˆÙ…Ø§Ù† Ø³Ø±Ù…Ø§ÛŒÙ‡â€ŒÚ¯Ø°Ø§Ø±ÛŒ Ú©Ø±Ø¯ÛŒØ¯.`);
      amountInput.value = 100000; // Reset input (Ø¨Ø§Ø²Ù†Ø´Ø§Ù†ÛŒ ÙˆØ±ÙˆØ¯ÛŒ)
      document.getElementById('investment-section').classList.add('hidden'); // Hide section (Ù¾Ù†Ù‡Ø§Ù† Ú©Ø±Ø¯Ù† Ø¨Ø®Ø´)
      updateUI();
      saveGame();
    }

    function takeLoan() {
      const amountInput = document.getElementById('loan-amount');
      const amount = parseInt(amountInput.value);

      if (isNaN(amount) || amount < 100000) {
        showMessageModal('Ù…Ø¨Ù„Øº ÙˆØ§Ù… Ø¨Ø§ÛŒØ¯ Ø­Ø¯Ø§Ù‚Ù„ Û±Û°Û°,Û°Û°Û° ØªÙˆÙ…Ø§Ù† Ø¨Ø§Ø´Ø¯.');
        return;
      }
      if (gameState.job.title === 'Ø¨ÛŒÚ©Ø§Ø±') {
        showMessageModal('Ø¨Ø±Ø§ÛŒ Ø¯Ø±ÛŒØ§ÙØª ÙˆØ§Ù… Ø¨Ø§ÛŒØ¯ Ø´ØºÙ„ Ø¯Ø§Ø´ØªÙ‡ Ø¨Ø§Ø´ÛŒØ¯.');
        return;
      }

      gameState.money += amount;
      gameState.loans.push({ amount: amount, remaining: amount * 1.1, interestRate: 0.1 }); // 10% interest (Û±Û°Ùª Ø³ÙˆØ¯)
      gameState.log.push({ year: gameState.year, event: `Ø´Ù…Ø§ ÙˆØ§Ù…ÛŒ Ø¨Ù‡ Ù…Ø¨Ù„Øº ${amount.toLocaleString('fa-IR')} ØªÙˆÙ…Ø§Ù† Ø¯Ø±ÛŒØ§ÙØª Ú©Ø±Ø¯ÛŒØ¯.`, type: 'finance' });
      showMessageModal(`Ø´Ù…Ø§ ÙˆØ§Ù…ÛŒ Ø¨Ù‡ Ù…Ø¨Ù„Øº ${amount.toLocaleString('fa-IR')} ØªÙˆÙ…Ø§Ù† Ø¯Ø±ÛŒØ§ÙØª Ú©Ø±Ø¯ÛŒØ¯.`);
      amountInput.value = 100000; // Reset input (Ø¨Ø§Ø²Ù†Ø´Ø§Ù†ÛŒ ÙˆØ±ÙˆØ¯ÛŒ)
      document.getElementById('loan-section').classList.add('hidden'); // Hide section (Ù¾Ù†Ù‡Ø§Ù† Ú©Ø±Ø¯Ù† Ø¨Ø®Ø´)
      updateUI();
      saveGame();
    }

    // Assets (Ø¯Ø§Ø±Ø§ÛŒÛŒâ€ŒÙ‡Ø§)
    function showAssets(type) {
      const content = document.getElementById('assets-content');
      let assetsHtml = '';
      let buyOptions = '';

      // Reset tab styles (Ø¨Ø§Ø²Ù†Ø´Ø§Ù†ÛŒ Ø§Ø³ØªØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ ØªØ¨)
      document.querySelectorAll('#assets-page button[id$="-tab"]').forEach(btn => {
        btn.classList.remove('btn-primary');
        btn.classList.add('btn-secondary');
      });
      document.getElementById(`${type}-tab`).classList.remove('btn-secondary');
      document.getElementById(`${type}-tab`).classList.add('btn-primary');

      if (type === 'properties') {
        const properties = [
          { name: 'Ø¢Ù¾Ø§Ø±ØªÙ…Ø§Ù† Ú©ÙˆÚ†Ú©', price: 500000000 },
          { name: 'Ø®Ø§Ù†Ù‡ ÙˆÛŒÙ„Ø§ÛŒÛŒ', price: 2000000000 },
          { name: 'Ù…ØºØ§Ø²Ù‡', price: 1000000000 }
        ];
        assetsHtml = gameState.assets.filter(a => a.type === 'property').map(asset => `
          <div class="glass-card p-3 mb-2 flex justify-between items-center">
            <span>${asset.name} - ${asset.value.toLocaleString('fa-IR')} ØªÙˆÙ…Ø§Ù†</span>
            <button class="btn-secondary px-3 py-1 rounded-lg" onclick="sellAsset('${asset.id}')">ÙØ±ÙˆØ´</button>
          </div>
        `).join('');
        buyOptions = `
          <h3 class="text-lg font-semibold mb-2 mt-4">Ø®Ø±ÛŒØ¯ Ù…Ù„Ú©</h3>
          <select id="buy-property-select" class="w-full p-2 bg-gray-800 rounded-lg mb-4">
            ${properties.map(p => `<option value="${p.name}" data-price="${p.price}">${p.name} (${p.price.toLocaleString('fa-IR')} ØªÙˆÙ…Ø§Ù†)</option>`).join('')}
          </select>
          <button class="btn-primary px-4 py-2 rounded-lg" onclick="buyAsset('property')">Ø®Ø±ÛŒØ¯</button>
        `;
      } else if (type === 'vehicles') {
        const vehicles = [
          { name: 'Ù¾Ø±Ø§ÛŒØ¯', price: 300000000 },
          { name: 'Ù¾Ú˜Ùˆ Ù¾Ø§Ø±Ø³', price: 600000000 },
          { name: 'Ù…Ø§Ø´ÛŒÙ† Ø®Ø§Ø±Ø¬ÛŒ', price: 5000000000 }
        ];
        assetsHtml = gameState.assets.filter(a => a.type === 'vehicle').map(asset => `
          <div class="glass-card p-3 mb-2 flex justify-between items-center">
            <span>${asset.name} - ${asset.value.toLocaleString('fa-IR')} ØªÙˆÙ…Ø§Ù†</span>
            <button class="btn-secondary px-3 py-1 rounded-lg" onclick="sellAsset('${asset.id}')">ÙØ±ÙˆØ´</button>
          </div>
        `).join('');
        buyOptions = `
          <h3 class="text-lg font-semibold mb-2 mt-4">Ø®Ø±ÛŒØ¯ Ø®ÙˆØ¯Ø±Ùˆ</h3>
          <select id="buy-vehicle-select" class="w-full p-2 bg-gray-800 rounded-lg mb-4">
            ${vehicles.map(v => `<option value="${v.name}" data-price="${v.price}">${v.name} (${v.price.toLocaleString('fa-IR')} ØªÙˆÙ…Ø§Ù†)</option>`).join('')}
          </select>
          <button class="btn-primary px-4 py-2 rounded-lg" onclick="buyAsset('vehicle')">Ø®Ø±ÛŒØ¯</button>
        `;
      } else if (type === 'other') {
        // Example other assets (Ù…Ø«Ø§Ù„ Ø³Ø§ÛŒØ± Ø¯Ø§Ø±Ø§ÛŒÛŒâ€ŒÙ‡Ø§)
        assetsHtml = gameState.assets.filter(a => a.type === 'other').map(asset => `
          <div class="glass-card p-3 mb-2 flex justify-between items-center">
            <span>${asset.name} - ${asset.value.toLocaleString('fa-IR')} ØªÙˆÙ…Ø§Ù†</span>
            <button class="btn-secondary px-3 py-1 rounded-lg" onclick="sellAsset('${asset.id}')">ÙØ±ÙˆØ´</button>
          </div>
        `).join('');
        buyOptions = `
          <h3 class="text-lg font-semibold mb-2 mt-4">Ø®Ø±ÛŒØ¯ Ø³Ø§ÛŒØ± Ø¯Ø§Ø±Ø§ÛŒÛŒâ€ŒÙ‡Ø§</h3>
          <p class="text-gray-400">Ø§ÛŒÙ† Ø¨Ø®Ø´ Ù‡Ù†ÙˆØ² Ø¯Ø± Ø¯Ø³Øª ØªÙˆØ³Ø¹Ù‡ Ø§Ø³Øª.</p>
        `;
      }

      content.innerHTML = `
        <h3 class="text-lg font-semibold mb-2">Ø¯Ø§Ø±Ø§ÛŒÛŒâ€ŒÙ‡Ø§ÛŒ ÙØ¹Ù„ÛŒ Ø´Ù…Ø§:</h3>
        <div class="space-y-2">
          ${assetsHtml || '<p>Ù‡ÛŒÚ† Ø¯Ø§Ø±Ø§ÛŒÛŒ Ø¯Ø± Ø§ÛŒÙ† Ø¯Ø³ØªÙ‡ Ù†Ø¯Ø§Ø±ÛŒØ¯.</p>'}
        </div>
        ${buyOptions}
      `;
    }

    function buyAsset(assetType) {
      let selectElement, assetName, assetPrice;
      if (assetType === 'property') {
        selectElement = document.getElementById('buy-property-select');
      } else if (assetType === 'vehicle') {
        selectElement = document.getElementById('buy-vehicle-select');
      } else {
        showMessageModal('Ù†ÙˆØ¹ Ø¯Ø§Ø±Ø§ÛŒÛŒ Ù†Ø§Ù…Ø¹ØªØ¨Ø± Ø§Ø³Øª.');
        return;
      }
      
      assetName = selectElement.value;
      assetPrice = parseInt(selectElement.options[selectElement.selectedIndex].dataset.price);

      if (gameState.money < assetPrice) {
        showMessageModal(`Ù¾ÙˆÙ„ Ú©Ø§ÙÛŒ Ø¨Ø±Ø§ÛŒ Ø®Ø±ÛŒØ¯ ${assetName} Ù†Ø¯Ø§Ø±ÛŒØ¯! (Ù†ÛŒØ§Ø² Ø¨Ù‡ ${assetPrice.toLocaleString('fa-IR')} ØªÙˆÙ…Ø§Ù†)`);
        return;
      }

      gameState.money -= assetPrice;
      gameState.assets.push({ id: crypto.randomUUID(), type: assetType, name: assetName, value: assetPrice });
      gameState.log.push({ year: gameState.year, event: `Ø´Ù…Ø§ ${assetName} Ø±Ø§ Ø¨Ù‡ Ù…Ø¨Ù„Øº ${assetPrice.toLocaleString('fa-IR')} ØªÙˆÙ…Ø§Ù† Ø®Ø±ÛŒØ¯ÛŒØ¯.`, type: 'finance' });
      showMessageModal(`Ø´Ù…Ø§ ${assetName} Ø±Ø§ Ø®Ø±ÛŒØ¯ÛŒØ¯.`);
      updateUI();
      saveGame();
    }

    function sellAsset(assetId) {
      const assetIndex = gameState.assets.findIndex(a => a.id === assetId);
      if (assetIndex === -1) {
        showMessageModal('Ø¯Ø§Ø±Ø§ÛŒÛŒ ÛŒØ§ÙØª Ù†Ø´Ø¯.');
        return;
      }

      const asset = gameState.assets[assetIndex];
      const sellPrice = Math.floor(asset.value * 0.9); // Sell for 90% of value (ÙØ±ÙˆØ´ Ø¨Ø§ Û¹Û°Ùª Ø§Ø±Ø²Ø´)
      gameState.money += sellPrice;
      gameState.assets.splice(assetIndex, 1); // Remove asset (Ø­Ø°Ù Ø¯Ø§Ø±Ø§ÛŒÛŒ)
      gameState.log.push({ year: gameState.year, event: `Ø´Ù…Ø§ ${asset.name} Ø±Ø§ Ø¨Ù‡ Ù…Ø¨Ù„Øº ${sellPrice.toLocaleString('fa-IR')} ØªÙˆÙ…Ø§Ù† ÙØ±ÙˆØ®ØªÛŒØ¯.`, type: 'finance' });
      showMessageModal(`Ø´Ù…Ø§ ${asset.name} Ø±Ø§ ÙØ±ÙˆØ®ØªÛŒØ¯ Ùˆ ${sellPrice.toLocaleString('fa-IR')} ØªÙˆÙ…Ø§Ù† Ø¯Ø±ÛŒØ§ÙØª Ú©Ø±Ø¯ÛŒØ¯.`);
      updateUI();
      saveGame();
    }

    // Finance Chart (Ù†Ù…ÙˆØ¯Ø§Ø± Ù…Ø§Ù„ÛŒ)
    function updateFinanceChart() {
      const ctx = document.getElementById('finance-chart').getContext('2d');
      const labels = gameState.financeHistory.map(entry => entry.year);
      const data = gameState.financeHistory.map(entry => entry.money);

      if (financeChartInstance) {
        financeChartInstance.destroy(); // Destroy previous chart instance (Ù†Ù…ÙˆÙ†Ù‡ Ù†Ù…ÙˆØ¯Ø§Ø± Ù‚Ø¨Ù„ÛŒ Ø±Ø§ Ø§Ø² Ø¨ÛŒÙ† Ø¨Ø¨Ø±ÛŒØ¯)
      }

      financeChartInstance = new Chart(ctx, {
        type: 'line',
        data: {
          labels: labels,
          datasets: [{
            label: 'Ù¾ÙˆÙ„ (ØªÙˆÙ…Ø§Ù†)',
            data: data,
            borderColor: '#10b981',
            backgroundColor: 'rgba(16, 185, 129, 0.2)',
            tension: 0.3,
            fill: true
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: {
              labels: {
                color: 'white' // Legend text color (Ø±Ù†Ú¯ Ù…ØªÙ† Ø§ÙØ³Ø§Ù†Ù‡)
              }
            }
          },
          scales: {
            x: {
              grid: {
                color: 'rgba(255, 255, 255, 0.1)' // X-axis grid color (Ø±Ù†Ú¯ Ø´Ø¨Ú©Ù‡ Ù…Ø­ÙˆØ± X)
              },
              ticks: {
                color: 'white' // X-axis tick color (Ø±Ù†Ú¯ ØªÛŒÚ© Ù…Ø­ÙˆØ± X)
              }
            },
            y: {
              beginAtZero: true,
              grid: {
                color: 'rgba(255, 255, 255, 0.1)' // Y-axis grid color (Ø±Ù†Ú¯ Ø´Ø¨Ú©Ù‡ Ù…Ø­ÙˆØ± Y)
              },
              ticks: {
                color: 'white', // Y-axis tick color (Ø±Ù†Ú¯ ØªÛŒÚ© Ù…Ø­ÙˆØ± Y)
                callback: function(value) {
                  return value.toLocaleString('fa-IR') + ' Øª'; // Format Y-axis labels (Ù‚Ø§Ù„Ø¨â€ŒØ¨Ù†Ø¯ÛŒ Ø¨Ø±Ú†Ø³Ø¨â€ŒÙ‡Ø§ÛŒ Ù…Ø­ÙˆØ± Y)
                }
              }
            }
          }
        }
      });
    }

    // Save Game (Ø°Ø®ÛŒØ±Ù‡ Ø¨Ø§Ø²ÛŒ)
    async function saveGame() {
      if (!db || !userId) {
        console.error("Firebase not initialized or user ID not available. Cannot save game.");
        // showMessageModal("Ø®Ø·Ø§: Firebase Ø¢Ù…Ø§Ø¯Ù‡ Ù†ÛŒØ³Øª. Ø¨Ø§Ø²ÛŒ Ø°Ø®ÛŒØ±Ù‡ Ù†Ø´Ø¯.");
        return;
      }
      try {
        const docRef = doc(db, `artifacts/${__app_id}/users/${userId}/gameState`, 'current');
        await setDoc(docRef, gameState);
        console.log('Game saved to Firestore:', gameState);
      } catch (e) {
        console.error('Error saving game to Firestore:', e);
        // showMessageModal('Ø®Ø·Ø§ Ø¯Ø± Ø°Ø®ÛŒØ±Ù‡ Ø¨Ø§Ø²ÛŒ!');
      }
    }

    // Load Game (Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø¨Ø§Ø²ÛŒ)
    async function loadGame() {
      if (!db || !userId) {
        console.error("Firebase not initialized or user ID not available. Cannot load game.");
        return;
      }
      try {
        const docRef = doc(db, `artifacts/${__app_id}/users/${userId}/gameState`, 'current');
        const docSnap = await getDoc(docRef);
        if (docSnap.exists()) {
          gameState = docSnap.data();
          updateUI();
          showMessageModal('Ø¨Ø§Ø²ÛŒ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø´Ø¯!');
        } else {
          console.log('No saved game found in Firestore.');
          // If no saved game, stay on start screen (Ø§Ú¯Ø± Ø¨Ø§Ø²ÛŒ Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯Ù‡â€ŒØ§ÛŒ Ù†ÛŒØ³ØªØŒ Ø¯Ø± ØµÙØ­Ù‡ Ø´Ø±ÙˆØ¹ Ø¨Ù…Ø§Ù†ÛŒØ¯)
        }
      } catch (e) {
        console.error('Error loading game from Firestore:', e);
        // showMessageModal('Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø¨Ø§Ø²ÛŒ! ÙØ§ÛŒÙ„ Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯Ù‡ Ø®Ø±Ø§Ø¨ Ø§Ø³Øª.');
      }
    }

    // Reset Game (Ø±ÛŒØ³Øª Ø¨Ø§Ø²ÛŒ)
    async function resetGame() {
      const confirmed = await window.confirm('Ø¢ÛŒØ§ Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ Ú©Ù‡ Ù…ÛŒâ€ŒØ®ÙˆØ§Ù‡ÛŒØ¯ Ø¨Ø§Ø²ÛŒ Ø±Ø§ Ø±ÛŒØ³Øª Ú©Ù†ÛŒØ¯ØŸ ØªÙ…Ø§Ù… Ù¾ÛŒØ´Ø±ÙØª Ø´Ù…Ø§ Ø§Ø² Ø¨ÛŒÙ† Ø®ÙˆØ§Ù‡Ø¯ Ø±ÙØª.');
      if (confirmed) {
        if (db && userId) {
          try {
            const docRef = doc(db, `artifacts/${__app_id}/users/${userId}/gameState`, 'current');
            await setDoc(docRef, {}); // Clear the document (Ø³Ù†Ø¯ Ø±Ø§ Ù¾Ø§Ú© Ú©Ù†ÛŒØ¯)
            console.log('Game state cleared in Firestore.');
          } catch (e) {
            console.error('Error resetting game in Firestore:', e);
          }
        }
        gameState = {
          name: '', gender: '', province: '', familyStatus: '', age: 0, year: 2025, money: 0,
          happiness: 50, health: 80, smarts: 50, looks: 50, spirituality: 50,
          education: { level: 'Ù‡ÛŒÚ†', major: '' }, job: { title: 'Ø¨ÛŒÚ©Ø§Ø±', salary: 0, level: 0 },
          relationships: [], illnesses: [], assets: [], loans: [], investments: [], log: [],
          financeHistory: [{ year: 2025, money: 0 }]
        };
        updateUI();
        showPage('start-screen');
        showMessageModal('Ø¨Ø§Ø²ÛŒ Ø±ÛŒØ³Øª Ø´Ø¯!');
      }
    }

    // Filter Log (ÙÛŒÙ„ØªØ± ØªØ§Ø±ÛŒØ®Ú†Ù‡)
    function filterLog(type) {
      const logElement = document.getElementById('life-log-full');
      const filteredLogs = type === 'all' ? gameState.log : gameState.log.filter(log => log.type === type);
      
      logElement.innerHTML = filteredLogs.map(log => `
        <li class="glass-card p-4">
          <span class="font-semibold">${log.year} - Ø³Ù† ${log.year - 2025}</span>
          <p>${log.event}</p>
        </li>
      `).join('');

      // Update button styles (Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø§Ø³ØªØ§ÛŒÙ„ Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§)
      document.querySelectorAll('#log-page .btn-primary').forEach(btn => {
        btn.classList.remove('btn-primary');
        btn.classList.add('btn-secondary');
      });
      document.getElementById(`log-filter-${type}`).classList.remove('btn-secondary');
      document.getElementById(`log-filter-${type}`).classList.add('btn-primary');
    }

    // Initial setup when the window loads (ØªÙ†Ø¸ÛŒÙ… Ø§ÙˆÙ„ÛŒÙ‡ Ù‡Ù†Ú¯Ø§Ù… Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ù¾Ù†Ø¬Ø±Ù‡)
    window.onload = initGame;
  </script>
</body>
</html>
