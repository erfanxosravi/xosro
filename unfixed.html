<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ø²Ù†Ø¯Ú¯ÛŒ Ø§ÛŒØ±Ø§Ù†ÛŒ - Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø² Ø²Ù†Ø¯Ú¯ÛŒ</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://v1.fontapi.ir/css/Vazir" rel="stylesheet">
  <!-- Chart.js CDN updated to a specific stable version (CDN Ú†Ø§Ø±Øª.Ø¬ÛŒâ€ŒØ§Ø³ Ø¨Ù‡ Ù†Ø³Ø®Ù‡ Ù¾Ø§ÛŒØ¯Ø§Ø± Ùˆ Ù…Ø´Ø®Øµ ØªØºÛŒÛŒØ± ÛŒØ§ÙØª) -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@2.9.4/dist/Chart.min.js"></script>
  <style>
    /* Ensure html and body take full height and do not scroll (Ø§Ø·Ù…ÛŒÙ†Ø§Ù† Ø§Ø² Ø§Ø´ØºØ§Ù„ Ú©Ø§Ù…Ù„ Ø§Ø±ØªÙØ§Ø¹ Ùˆ Ø¹Ø¯Ù… Ø§Ø³Ú©Ø±ÙˆÙ„ Ø¨Ø±Ø§ÛŒ html Ùˆ body) */
    html, body {
      height: 100%;
      overflow: hidden;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: 'Vazir', sans-serif;
      background: linear-gradient(135deg, #121212 0%, #1a202c 100%);
      min-height: 100vh;
      overflow-x: hidden;
      display: flex;
      flex-direction: column;
      color: white; /* Default text color (Ø±Ù†Ú¯ Ù¾ÛŒØ´â€ŒÙØ±Ø¶ Ù…ØªÙ†) */
    }
    .glass-card {
      background: rgba(255, 255, 255, 0.08);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 12px;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }
    .btn-primary {
      background: #10b981;
      color: white;
      transition: transform 0.2s ease, background 0.2s ease;
    }
    .btn-primary:hover {
      background: #059669;
      transform: scale(1.05);
    }
    .btn-secondary {
      background: #4b5563;
      color: white;
      transition: transform 0.2s ease, background 0.2s ease;
    }
    .btn-secondary:hover {
      background: #374151;
      transform: scale(1.05);
    }
    .status-bar {
      height: 8px;
      border-radius: 4px;
      transition: width 0.3s ease;
      width: 100%; /* Make status bar fill its container (Ù†ÙˆØ§Ø± ÙˆØ¶Ø¹ÛŒØª Ø±Ø§ Ù¾Ø± Ù…ÛŒâ€ŒÚ©Ù†Ø¯) */
    }
    .animate-slide-in {
      animation: slideIn 0.5s ease-out;
    }
    @keyframes slideIn {
      from { transform: translateY(20px); opacity: 0; }
      to { transform: translateY(0); opacity: 1; }
    }
    .money-display {
      font-size: 1.5rem;
      font-weight: bold;
    }

    /* Dashboard specific styling (Ø§Ø³ØªØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ø®Ø§Øµ Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯) */
    #dashboard {
      display: flex;
      flex-direction: column;
      height: 100vh; /* Ensure it takes full viewport height (Ø§Ø·Ù…ÛŒÙ†Ø§Ù† Ø§Ø² Ø§Ø´ØºØ§Ù„ Ú©Ø§Ù…Ù„ Ø§Ø±ØªÙØ§Ø¹ ÙˆÛŒÙˆÙ¾ÙˆØ±Øª) */
      overflow: hidden; /* Prevent dashboard itself from scrolling (Ø¬Ù„ÙˆÚ¯ÛŒØ±ÛŒ Ø§Ø² Ø§Ø³Ú©Ø±ÙˆÙ„ Ø®ÙˆØ¯ Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯) */
    }

    /* Header Section - Now part of flex flow (Ø¨Ø®Ø´ Ù‡Ø¯Ø± - Ø§Ú©Ù†ÙˆÙ† Ø¨Ø®Ø´ÛŒ Ø§Ø² Ø¬Ø±ÛŒØ§Ù† ÙÙ„Ú©Ø³) */
    .header-section {
      height: 8rem; /* 128px - Tailwind h-32 */
      flex-shrink: 0; /* Prevents shrinking (Ø¬Ù„ÙˆÚ¯ÛŒØ±ÛŒ Ø§Ø² Ú©ÙˆÚ†Ú© Ø´Ø¯Ù†) */
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1); /* Add shadow for separation (Ø§ÙØ²ÙˆØ¯Ù† Ø³Ø§ÛŒÙ‡ Ø¨Ø±Ø§ÛŒ Ø¬Ø¯Ø§Ø³Ø§Ø²ÛŒ) */
      z-index: 10; /* Ensure header is above scrolling content (Ø§Ø·Ù…ÛŒÙ†Ø§Ù† Ø§Ø² Ù‚Ø±Ø§Ø±Ú¯ÛŒØ±ÛŒ Ù‡Ø¯Ø± Ø¨Ø§Ù„Ø§ÛŒ Ù…Ø­ØªÙˆØ§ÛŒ Ø§Ø³Ú©Ø±ÙˆÙ„ÛŒ) */
    }

    /* Main Content Area - This will contain the scrollable life log (Ø§ÛŒÙ† Ø¨Ø®Ø´ Ø§ØµÙ„ÛŒ Ù…Ø­ØªÙˆØ§ Ø§Ø³Øª Ú©Ù‡ Ø´Ø§Ù…Ù„ Ú¯Ø²Ø§Ø±Ø´ Ø²Ù†Ø¯Ú¯ÛŒ Ù‚Ø§Ø¨Ù„ Ø§Ø³Ú©Ø±ÙˆÙ„ Ø®ÙˆØ§Ù‡Ø¯ Ø¨ÙˆØ¯) */
    #main-dashboard-content {
      flex-grow: 1; /* Takes remaining vertical space (ÙØ¶Ø§ÛŒ Ø¹Ù…ÙˆØ¯ÛŒ Ø¨Ø§Ù‚ÛŒâ€ŒÙ…Ø§Ù†Ø¯Ù‡ Ø±Ø§ Ø§Ø´ØºØ§Ù„ Ù…ÛŒâ€ŒÚ©Ù†Ø¯) */
      padding: 1rem; /* p-4 (Ù¾Ø¯ÛŒÙ†Ú¯ Ú©Ù„ÛŒ Ø¨Ø±Ø§ÛŒ ÙØ¶Ø§ÛŒ Ø¯Ø§Ø®Ù„ÛŒ) */
      display: flex; /* Make it a flex container (Ø¢Ù† Ø±Ø§ Ø¨Ù‡ Ú©Ø§Ù†ØªÛŒÙ†Ø± ÙÙ„Ú©Ø³ ØªØ¨Ø¯ÛŒÙ„ Ú©Ù†ÛŒØ¯) */
      flex-direction: column; /* Stack children vertically (ÙØ±Ø²Ù†Ø¯Ø§Ù† Ø±Ø§ Ø¨Ù‡ ØµÙˆØ±Øª Ø¹Ù…ÙˆØ¯ÛŒ Ù¾Ø´ØªÙ‡ Ú©Ù†ÛŒØ¯) */
      justify-content: flex-start; /* Align content to the top within this area (Ù…Ø­ØªÙˆØ§ Ø±Ø§ Ø¯Ø± Ø¨Ø§Ù„Ø§ÛŒ Ø§ÛŒÙ† Ù†Ø§Ø­ÛŒÙ‡ Ù‡Ù…ØªØ±Ø§Ø² Ú©Ù†ÛŒØ¯) */
      align-items: center; /* Center content horizontally (Ù…Ø­ØªÙˆØ§ Ø±Ø§ Ø¨Ù‡ ØµÙˆØ±Øª Ø§ÙÙ‚ÛŒ ÙˆØ³Ø· Ù‚Ø±Ø§Ø± Ø¯Ù‡ÛŒØ¯) */
      -webkit-overflow-scrolling: touch; /* Smooth scrolling on iOS (Ø§Ø³Ú©Ø±ÙˆÙ„ Ø±ÙˆØ§Ù† Ø¯Ø± iOS) */
    }
    
    /* Styles for the glass-card containing life-log (Ø§Ø³ØªØ§ÛŒÙ„â€ŒÙ‡Ø§ Ø¨Ø±Ø§ÛŒ glass-card Ø´Ø§Ù…Ù„ Ú¯Ø²Ø§Ø±Ø´ Ø²Ù†Ø¯Ú¯ÛŒ) */
    #life-log-scroll-container { /* New ID for direct targeting (Ø¢ÛŒâ€ŒØ¯ÛŒ Ø¬Ø¯ÛŒØ¯ Ø¨Ø±Ø§ÛŒ Ù‡Ø¯Ùâ€ŒÚ¯ÛŒØ±ÛŒ Ù…Ø³ØªÙ‚ÛŒÙ…) */
      flex-grow: 1; /* Make this glass-card take available space within main-dashboard-content (Ø§ÛŒÙ† glass-card ÙØ¶Ø§ÛŒ Ù…ÙˆØ¬ÙˆØ¯ Ø±Ø§ Ø¯Ø± main-dashboard-content Ø§Ø´ØºØ§Ù„ Ù…ÛŒâ€ŒÚ©Ù†Ø¯) */
      display: flex; /* Make it a flex container (Ø¢Ù† Ø±Ø§ Ø¨Ù‡ Ú©Ø§Ù†ØªÛŒÙ†Ø± ÙÙ„Ú©Ø³ ØªØ¨Ø¯ÛŒÙ„ Ú©Ù†ÛŒØ¯) */
      flex-direction: column; /* Stack children vertically (ÙØ±Ø²Ù†Ø¯Ø§Ù† Ø±Ø§ Ø¨Ù‡ ØµÙˆØ±Øª Ø¹Ù…ÙˆØ¯ÛŒ Ù¾Ø´ØªÙ‡ Ú©Ù†ÛŒØ¯) */
      width: 100%; /* Ensure it fills the width (Ø§Ø·Ù…ÛŒÙ†Ø§Ù† Ø§Ø² Ù¾Ø± Ú©Ø±Ø¯Ù† Ø¹Ø±Ø¶) */
      max-width: 768px; /* Optional: limit max width for better readability on larger screens (Ø§Ø®ØªÛŒØ§Ø±ÛŒ: Ù…Ø­Ø¯ÙˆØ¯ Ú©Ø±Ø¯Ù† Ø­Ø¯Ø§Ú©Ø«Ø± Ø¹Ø±Ø¶ Ø¨Ø±Ø§ÛŒ Ø®ÙˆØ§Ù†Ø§ÛŒÛŒ Ø¨Ù‡ØªØ± Ø¯Ø± ØµÙØ­Ø§Øª Ø¨Ø²Ø±Ú¯ØªØ±) */
      overflow-y: auto; /* This glass-card will now handle its own scrolling (Ø§ÛŒÙ† Ú¯Ù„Ø³-Ú©Ø§Ø±Ø¯ Ø§Ú©Ù†ÙˆÙ† Ø§Ø³Ú©Ø±ÙˆÙ„ Ø®ÙˆØ¯Ø´ Ø±Ø§ Ù…Ø¯ÛŒØ±ÛŒØª Ø®ÙˆØ§Ù‡Ø¯ Ú©Ø±Ø¯) */
      min-height: 0; /* Crucial for scrollable flex items in a flex column (Ø­ÛŒØ§ØªÛŒ Ø¨Ø±Ø§ÛŒ Ø¹Ù†Ø§ØµØ± ÙÙ„Ú©Ø³ Ù‚Ø§Ø¨Ù„ Ø§Ø³Ú©Ø±ÙˆÙ„ Ø¯Ø± ÛŒÚ© Ø³ØªÙˆÙ† ÙÙ„Ú©Ø³) */
      /* Calculate remaining height: 100vh - header height - status bar height - tab bar height - main-dashboard-content padding (Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø§Ø±ØªÙØ§Ø¹ Ø¨Ø§Ù‚ÛŒâ€ŒÙ…Ø§Ù†Ø¯Ù‡: 100vh - Ø§Ø±ØªÙØ§Ø¹ Ù‡Ø¯Ø± - Ø§Ø±ØªÙØ§Ø¹ Ù†ÙˆØ§Ø± ÙˆØ¶Ø¹ÛŒØª - Ø§Ø±ØªÙØ§Ø¹ Ù†ÙˆØ§Ø± ØªØ¨ - Ù¾Ø¯ÛŒÙ†Ú¯ main-dashboard-content) */
      max-height: calc(100vh - 8rem - 180px - 60px - 2rem); 
    }

    /* Styles for the actual life-log content area (Ø§Ø³ØªØ§ÛŒÙ„â€ŒÙ‡Ø§ Ø¨Ø±Ø§ÛŒ Ù†Ø§Ø­ÛŒÙ‡ Ù…Ø­ØªÙˆØ§ÛŒ Ú¯Ø²Ø§Ø±Ø´ Ø²Ù†Ø¯Ú¯ÛŒ ÙˆØ§Ù‚Ø¹ÛŒ) */
    #life-log {
      space-y-4; /* Keep spacing (ÙØ§ØµÙ„Ù‡ Ø±Ø§ Ø­ÙØ¸ Ú©Ù†ÛŒØ¯) */
      /* Content within life-log will now cause its parent life-log-scroll-container to scroll (Ù…Ø­ØªÙˆØ§ÛŒ Ø¯Ø§Ø®Ù„ life-log Ø§Ú©Ù†ÙˆÙ† Ø¨Ø§Ø¹Ø« Ø§Ø³Ú©Ø±ÙˆÙ„ Ú¯Ù„Ø³-Ú©Ø§Ø±Ø¯ ÙˆØ§Ù„Ø¯ Ø®ÙˆØ¯ Ù…ÛŒâ€ŒØ´ÙˆØ¯) */
    }

    /* Bottom Sections - Now part of flex flow (Ø¨Ø®Ø´â€ŒÙ‡Ø§ÛŒ Ù¾Ø§ÛŒÛŒÙ† - Ø§Ú©Ù†ÙˆÙ† Ø¨Ø®Ø´ÛŒ Ø§Ø² Ø¬Ø±ÛŒØ§Ù† ÙÙ„Ú©Ø³) */
    .status-bars-section {
      height: 180px; /* Explicit height set (Ø§Ø±ØªÙØ§Ø¹ ØµØ±ÛŒØ­ ØªÙ†Ø¸ÛŒÙ… Ø´Ø¯Ù‡ Ø§Ø³Øª) */
      flex-shrink: 0; /* Prevents shrinking (Ø¬Ù„ÙˆÚ¯ÛŒØ±ÛŒ Ø§Ø² Ú©ÙˆÚ†Ú© Ø´Ø¯Ù†) */
      padding: 1rem; /* p-4 */
      background: rgba(255, 255, 255, 0.08); /* glass-card background (Ù¾Ø³â€ŒØ²Ù…ÛŒÙ†Ù‡ glass-card) */
      backdrop-filter: blur(10px);
      border-top: 1px solid rgba(255, 255, 255, 0.1); /* Top border for separation (Ø­Ø§Ø´ÛŒÙ‡ Ø¨Ø§Ù„Ø§ Ø¨Ø±Ø§ÛŒ Ø¬Ø¯Ø§Ø³Ø§Ø²ÛŒ) */
      border-radius: 12px 12px 0 0; /* Rounded top corners (Ú¯ÙˆØ´Ù‡â€ŒÙ‡Ø§ÛŒ Ø¨Ø§Ù„Ø§ÛŒÛŒ Ú¯Ø±Ø¯) */
      z-index: 10; /* Ensure status bars are above scrolling content (Ø§Ø·Ù…ÛŒÙ†Ø§Ù† Ø§Ø² Ù‚Ø±Ø§Ø±Ú¯ÛŒØ±ÛŒ Ù†ÙˆØ§Ø±Ù‡Ø§ÛŒ ÙˆØ¶Ø¹ÛŒØª Ø¨Ø§Ù„Ø§ÛŒ Ù…Ø­ØªÙˆØ§ÛŒ Ø§Ø³Ú©Ø±ÙˆÙ„ÛŒ) */
    }

    .tab-bar {
      height: 60px; /* Explicit height set (Ø§Ø±ØªÙØ§Ø¹ ØµØ±ÛŒØ­ ØªÙ†Ø¸ÛŒÙ… Ø´Ø¯Ù‡ Ø§Ø³Øª) */
      flex-shrink: 0; /* Prevents shrinking (Ø¬Ù„ÙˆÚ¯ÛŒØ±ÛŒ Ø§Ø² Ú©ÙˆÚ†Ú© Ø´Ø¯Ù†) */
      padding-top: 0.5rem; /* py-2 */
      padding-bottom: 0.5rem; /* py-2 */
      background: rgba(255, 255, 255, 0.08);
      backdrop-filter: blur(10px);
      border-top: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 12px 12px 0 0; /* Rounded top corners (Ú¯ÙˆØ´Ù‡â€ŒÙ‡Ø§ÛŒ Ø¨Ø§Ù„Ø§ÛŒÛŒ Ú¯Ø±Ø¯) */
      z-index: 10; /* Ensure tab bar is above scrolling content (Ø§Ø·Ù…ÛŒÙ†Ø§Ù† Ø§Ø² Ù‚Ø±Ø§Ø±Ú¯ÛŒØ±ÛŒ Ù†ÙˆØ§Ø± ØªØ¨ Ø¨Ø§Ù„Ø§ÛŒ Ù…Ø­ØªÙˆØ§ÛŒ Ø§Ø³Ú©Ø±ÙˆÙ„ÛŒ) */
    }

    .modal-overlay {
      position: fixed;
      inset: 0;
      background-color: rgba(0, 0, 0, 0.75);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 50;
    }
    .modal-content {
      background: rgba(255, 255, 255, 0.15);
      backdrop-filter: blur(15px);
      border: 1px solid rgba(255, 255, 255, 0.2);
      border-radius: 15px;
      padding: 1.5rem;
      width: 90%;
      max-width: 400px;
      text-align: center;
      box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.37);
    }
    .modal-button-container {
      display: flex;
      justify-content: space-around;
      margin-top: 1rem;
    }
    .modal-button {
      padding: 0.75rem 1.5rem;
      border-radius: 8px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s ease;
    }
    .modal-button.primary {
      background-color: #10b981;
      color: white;
    }
    .modal-button.primary:hover {
      background: #059669;
      transform: translateY(-2px);
    }
    .modal-button.secondary {
      background-color: #4b5563;
      color: white;
    }
    .modal-button.secondary:hover {
      background-color: #374151;
      transform: translateY(-2px);
    }
    /* Ensure scrollability for content within pages (Ø§Ø·Ù…ÛŒÙ†Ø§Ù† Ø§Ø² Ù‚Ø§Ø¨Ù„ÛŒØª Ø§Ø³Ú©Ø±ÙˆÙ„ Ø¨Ø±Ø§ÛŒ Ù…Ø­ØªÙˆØ§ÛŒ Ø¯Ø±ÙˆÙ† ØµÙØ­Ø§Øª) */
    .page-content-scroll {
      max-height: calc(100vh - (5rem + 1rem) - (60px + 16px)); /* Recalculate based on specific page fixed elements */
      overflow-y: auto;
      -webkit-overflow-scrolling: touch; /* Smooth scrolling on iOS (Ø§Ø³Ú©Ø±ÙˆÙ„ Ø±ÙˆØ§Ù† Ø¯Ø± iOS) */
    }
    .back-button-container {
        display: flex;
        justify-content: flex-start; /* Align to the left (Ù‡Ù…ØªØ±Ø§Ø² Ú©Ø±Ø¯Ù† Ø¨Ù‡ Ú†Ù¾) */
        margin-bottom: 1rem; /* Space below the button (ÙØ¶Ø§ÛŒ Ø²ÛŒØ± Ø¯Ú©Ù…Ù‡) */
    }

    /* Hide scrollbar for WebKit browsers (Chrome, Safari) - Ù¾Ù†Ù‡Ø§Ù† Ú©Ø±Ø¯Ù† Ø§Ø³Ú©Ø±ÙˆÙ„â€ŒØ¨Ø§Ø± Ø¨Ø±Ø§ÛŒ Ù…Ø±ÙˆØ±Ú¯Ø±Ù‡Ø§ÛŒ WebKit */
    #main-dashboard-content::-webkit-scrollbar, 
    .page-content-scroll::-webkit-scrollbar,
    #life-log-full::-webkit-scrollbar,
    #life-log-scroll-container::-webkit-scrollbar, /* Target the new dashboard scroll container (Ú©Ø§Ù†ØªÛŒÙ†Ø± Ø§Ø³Ú©Ø±ÙˆÙ„ Ø¬Ø¯ÛŒØ¯ Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯ Ø±Ø§ Ù‡Ø¯Ù Ù‚Ø±Ø§Ø± Ø¯Ù‡ÛŒØ¯) */
    #full-log-scroll-area::-webkit-scrollbar,
    .asset-list-container::-webkit-scrollbar { /* Target asset list containers (Ú©Ø§Ù†ØªÛŒÙ†Ø±Ù‡Ø§ÛŒ Ù„ÛŒØ³Øª Ø¯Ø§Ø±Ø§ÛŒÛŒ Ø±Ø§ Ù‡Ø¯Ù Ù‚Ø±Ø§Ø± Ø¯Ù‡ÛŒØ¯) */
      display: none;
    }

    /* Hide scrollbar for Firefox - Ù¾Ù†Ù‡Ø§Ù† Ú©Ø±Ø¯Ù† Ø§Ø³Ú©Ø±ÙˆÙ„â€ŒØ¨Ø§Ø± Ø¨Ø±Ø§ÛŒ ÙØ§ÛŒØ±ÙØ§Ú©Ø³ */
    #main-dashboard-content, 
    .page-content-scroll,
    #life-log-full,
    #life-log-scroll-container, /* Target the new dashboard scroll container (Ú©Ø§Ù†ØªÛŒÙ†Ø± Ø§Ø³Ú©Ø±ÙˆÙ„ Ø¬Ø¯ÛŒØ¯ Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯ Ø±Ø§ Ù‡Ø¯Ù Ù‚Ø±Ø§Ø± Ø¯Ù‡ÛŒØ¯) */
    #full-log-scroll-area,
    .asset-list-container { /* Target asset list containers (Ú©Ø§Ù†ØªÛŒÙ†Ø±Ù‡Ø§ÛŒ Ù„ÛŒØ³Øª Ø¯Ø§Ø±Ø§ÛŒÛŒ Ø±Ø§ Ù‡Ø¯Ù Ù‚Ø±Ø§Ø± Ø¯Ù‡ÛŒØ¯) */
      scrollbar-width: none; /* Firefox */
    }

    /* Styling for the new full log page scroll area (Ø§Ø³ØªØ§ÛŒÙ„â€ŒØ¯Ù‡ÛŒ Ø¨Ø±Ø§ÛŒ Ù†Ø§Ø­ÛŒÙ‡ Ø§Ø³Ú©Ø±ÙˆÙ„ Ø¬Ø¯ÛŒØ¯ ØµÙØ­Ù‡ Ú¯Ø²Ø§Ø±Ø´ Ú©Ø§Ù…Ù„) */
    #full-log-scroll-area {
        overflow-y: auto;
        flex-grow: 1; /* Takes remaining space within its flex parent (ÙØ¶Ø§ÛŒ Ø¨Ø§Ù‚ÛŒâ€ŒÙ…Ø§Ù†Ø¯Ù‡ Ø±Ø§ Ø¯Ø± ÙˆØ§Ù„Ø¯ ÙÙ„Ú©Ø³ Ø®ÙˆØ¯ Ø§Ø´ØºØ§Ù„ Ù…ÛŒâ€ŒÚ©Ù†Ø¯) */
        min-height: 0; /* Important for flex items with overflow (Ù…Ù‡Ù… Ø¨Ø±Ø§ÛŒ Ø¢ÛŒØªÙ…â€ŒÙ‡Ø§ÛŒ ÙÙ„Ú©Ø³ Ø¨Ø§ Ù‚Ø§Ø¨Ù„ÛŒØª overflow) */
        /* Calculation: 100vh (total) - 2rem (log-page p-4) - 2.5rem (h2 margin/approx height) - 2rem (glass-card p-4) - 3rem (filter buttons margin/approx height) */
        max-height: calc(100vh - 2rem - 2.5rem - 2rem - 3rem); /* Adjust as needed (Ø¯Ø± ØµÙˆØ±Øª Ù†ÛŒØ§Ø² ØªÙ†Ø¸ÛŒÙ… Ø´ÙˆØ¯) */
    }

    /* Removed #assets-detail-modal specific styling as it's replaced by pages (Ø§Ø³ØªØ§ÛŒÙ„â€ŒØ¯Ù‡ÛŒ Ø®Ø§Øµ #assets-detail-modal Ø­Ø°Ù Ø´Ø¯ Ø²ÛŒØ±Ø§ Ø¨Ø§ ØµÙØ­Ø§Øª Ø¬Ø§ÛŒÚ¯Ø²ÛŒÙ† Ø´Ø¯Ù‡ Ø§Ø³Øª) */
  </style>
</head>
<body>
  <div id="start-screen" class="flex flex-col items-center justify-center min-h-screen p-4">
    <img src="https://placehold.co/150x120/10b981/ffffff?text=Ù„ÙˆÚ¯Ùˆ" alt="Ù„ÙˆÚ¯Ùˆ Ø¨Ø§Ø²ÛŒ" class="h-32 mb-5 animate-slide-in rounded-lg">
    <div class="glass-card p-6 w-11/12 max-w-md text-center">
      <h1 class="text-3xl font-bold mb-4">Ø²Ù†Ø¯Ú¯ÛŒ Ø§ÛŒØ±Ø§Ù†ÛŒ</h1>
      <input id="name-input" type="text" placeholder="Ù†Ø§Ù… Ø®ÙˆØ¯ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯" class="w-full p-3 mb-4 text-right bg-gray-800 rounded-lg focus:outline-none focus:ring-2 focus:ring-emerald-500" value="Ø¹Ø±ÙØ§Ù† Ø®Ø³Ø±ÙˆÛŒ">
      <select id="gender-select" class="w-full p-3 mb-4 text-right bg-gray-800 rounded-lg focus:outline-none focus:ring-2 focus:ring-emerald-500">
        <option value="male" selected>Ù…Ø±Ø¯ ğŸ‘¨</option>
        <option value="female">Ø²Ù† ğŸ‘©</option>
      </select>
      <select id="province-select" class="w-full p-3 mb-4 text-right bg-gray-800 rounded-lg focus:outline-none focus:ring-2 focus:ring-emerald-500">
        <option value="tehran" selected>ØªÙ‡Ø±Ø§Ù† - Ù¾Ø§ÛŒØªØ®ØªØŒ Ø§Ù…Ú©Ø§Ù†Ø§Øª Ø²ÛŒØ§Ø¯</option>
        <option value="isfahan">Ø§ØµÙÙ‡Ø§Ù† - ØªØ§Ø±ÛŒØ®ÛŒØŒ ÙØ±Ù‡Ù†Ú¯ÛŒ</option>
        <option value="shiraz">Ø´ÛŒØ±Ø§Ø² - Ø§Ø¯Ø¨ÛŒØŒ Ø®ÙˆØ´ Ø¢Ø¨â€ŒÙˆÙ‡ÙˆØ§</option>
        <option value="mashhad">Ù…Ø´Ù‡Ø¯ - Ù…Ø°Ù‡Ø¨ÛŒØŒ Ø²ÛŒØ§Ø±ØªÛŒ</option>
        <option value="tabriz">ØªØ¨Ø±ÛŒØ² - ØµÙ†Ø¹ØªÛŒØŒ ØªØ§Ø±ÛŒØ®ÛŒ</option>
      </select>
      <select id="family-status" class="w-full p-3 mb-4 text-right bg-gray-800 rounded-lg focus:outline-none focus:ring-2 focus:ring-emerald-500">
        <option value="normal" selected>Ø®Ø§Ù†ÙˆØ§Ø¯Ù‡ Ù…Ø¹Ù…ÙˆÙ„ÛŒ</option>
        <option value="wealthy">Ø®Ø§Ù†ÙˆØ§Ø¯Ù‡ Ø«Ø±ÙˆØªÙ…Ù†Ø¯</option>
        <option value="rural">Ø®Ø§Ù†ÙˆØ§Ø¯Ù‡ Ø±ÙˆØ³ØªØ§ÛŒÛŒ</option>
        <option value="poor">Ø®Ø§Ù†ÙˆØ§Ø¯Ù‡ Ø¨Ø§ Ù…Ø´Ú©Ù„Ø§Øª Ù…Ø§Ù„ÛŒ</option>
      </select>
      <button id="start-new-life" class="btn-primary w-4/5 py-3 rounded-full text-lg font-semibold mb-3 shadow-lg">Ø´Ø±ÙˆØ¹ Ø²Ù†Ø¯Ú¯ÛŒ Ø¬Ø¯ÛŒØ¯</button>
      <button id="continue-life" class="btn-secondary w-4/5 py-3 rounded-full text-md shadow-lg">Ø§Ø¯Ø§Ù…Ù‡ Ø²Ù†Ø¯Ú¯ÛŒ Ù‚Ø¨Ù„ÛŒ</button>
    </div>
    <!-- Removed settings button from start screen (Ø¯Ú©Ù…Ù‡ ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø§Ø² ØµÙØ­Ù‡ Ø´Ø±ÙˆØ¹ Ø­Ø°Ù Ø´Ø¯) -->
    <div class="absolute bottom-5 right-5">
      <select id="language-select" class="bg-gray-800 p-2 rounded-lg text-sm">
        <option value="fa" selected>ÙØ§Ø±Ø³ÛŒ</option>
      </select>
    </div>
  </div>

  <div id="dashboard" style="display: none;" class="flex-1 flex flex-col">
    <!-- Header Section (Ø¨Ø®Ø´ Ù‡Ø¯Ø±) -->
    <div class="header-section glass-card p-4 flex flex-col justify-center items-center">
      <div class="flex justify-between w-full items-center">
        <!-- Left Section: Name & Age (Ø¨Ø®Ø´ Ú†Ù¾: Ù†Ø§Ù… Ùˆ Ø³Ù†) -->
        <div class="text-right flex-1 pr-2">
          <h2 id="dashboard-char-name" class="text-xl font-bold"></h2>
          <p id="dashboard-char-age" class="text-sm text-gray-300"></p>
        </div>

        <!-- Center Section: Game Title (Ø¨Ø®Ø´ Ù…Ø±Ú©Ø²ÛŒ: Ø¹Ù†ÙˆØ§Ù† Ø¨Ø§Ø²ÛŒ) -->
        <h1 class="text-2xl font-bold text-white flex-none">Ø²Ù†Ø¯Ú¯ÛŒ Ø§ÛŒØ±Ø§Ù†ÛŒ</h1> 

        <!-- Right Section: Settings Icon, Money & Job (Ø¨Ø®Ø´ Ø±Ø§Ø³Øª: Ø¢ÛŒÚ©ÙˆÙ† ØªÙ†Ø¸ÛŒÙ…Ø§ØªØŒ Ù¾ÙˆÙ„ Ùˆ Ø´ØºÙ„) -->
        <div class="text-left flex-1 pl-2 flex flex-col items-end">
          <button id="header-settings-btn" class="text-gray-400 hover:text-white transition text-2xl mb-1 p-1 rounded-full hover:bg-gray-700">âš™ï¸</button> <!-- New settings icon (Ø¢ÛŒÚ©ÙˆÙ† ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø¬Ø¯ÛŒØ¯) -->
          <p id="dashboard-char-money" class="text-lg text-emerald-400"></p>
          <p id="dashboard-char-job" class="text-sm text-gray-300"></p>
        </div>
      </div>
    </div>

    <!-- Main Content Area - This will be the scrollable part (Ø§ÛŒÙ† Ø¨Ø®Ø´ Ø§ØµÙ„ÛŒ Ù…Ø­ØªÙˆØ§ Ø§Ø³Øª Ú©Ù‡ Ø´Ø§Ù…Ù„ Ú¯Ø²Ø§Ø±Ø´ Ø²Ù†Ø¯Ú¯ÛŒ Ù‚Ø§Ø¨Ù„ Ø§Ø³Ú©Ø±ÙˆÙ„ Ø®ÙˆØ§Ù‡Ø¯ Ø¨ÙˆØ¯) -->
    <div id="main-dashboard-content"> 
      <div id="life-log-scroll-container" class="glass-card p-4 flex flex-col flex-grow h-full">
        <!-- Removed "Ú¯Ø²Ø§Ø±Ø´ Ø²Ù†Ø¯Ú¯ÛŒ" header as requested (Ù‡Ø¯Ø± "Ú¯Ø²Ø§Ø±Ø´ Ø²Ù†Ø¯Ú¯ÛŒ" Ø·Ø¨Ù‚ Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ø­Ø°Ù Ø´Ø¯) -->
        <div id="life-log" class="space-y-4"></div>
      </div>
    </div>

    <!-- Bottom Status Bars & Tab Bar (Ù†ÙˆØ§Ø±Ù‡Ø§ÛŒ ÙˆØ¶Ø¹ÛŒØª Ùˆ Ù†ÙˆØ§Ø± ØªØ¨ Ù¾Ø§ÛŒÛŒÙ†) -->
    <!-- Status bars (Ù†ÙˆØ§Ø±Ù‡Ø§ÛŒ ÙˆØ¶Ø¹ÛŒØª) -->
    <div id="status-bars-container" class="status-bars-section"> 
      <div class="flex flex-col space-y-2 text-sm">
        <div class="flex items-center"><span class="ml-2 w-16">ğŸ˜Š Ø´Ø§Ø¯ÛŒ</span><div class="flex-1 bg-gray-700 rounded-full"><div id="happiness-bar" class="status-bar bg-blue-500"></div></div><span id="happiness-value" class="ml-2 w-10 text-left"></span></div>
        <div class="flex items-center"><span class="ml-2 w-16">ğŸ’ª Ø³Ù„Ø§Ù…Øª</span><div class="flex-1 bg-gray-700 rounded-full"><div id="health-bar" class="status-bar bg-red-500"></div></div><span id="health-value" class="ml-2 w-10 text-left"></span></div>
        <div class="flex items-center"><span class="ml-2 w-16">ğŸ§  Ù‡ÙˆØ´</span><div class="flex-1 bg-gray-700 rounded-full"><div id="smarts-bar" class="status-bar bg-purple-500"></div></div><span id="smarts-value" class="ml-2 w-10 text-left"></span></div>
        <div class="flex items-center"><span class="ml-2 w-16">ğŸ˜ Ø¸Ø§Ù‡Ø±</span><div class="flex-1 bg-gray-700 rounded-full"><div id="looks-bar" class="status-bar bg-yellow-500"></div></div><span id="looks-value" class="ml-2 w-10 text-left"></span></div>
        <div class="flex items-center"><span class="ml-2 w-16">ğŸ•Œ Ù…Ø¹Ù†ÙˆÛŒØª</span><div class="flex-1 bg-gray-700 rounded-full"><div id="spirituality-bar" class="status-bar bg-teal-500"></div></div><span id="spirituality-value" class="ml-2 w-10 text-left"></span></div>
      </div>
    </div>

    <div class="tab-bar flex justify-around"> 
      <!-- New Tab Buttons (Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ÛŒ ØªØ¨ Ø¬Ø¯ÛŒØ¯) -->
      <button id="career-tab" class="flex flex-col items-center text-sm p-2 rounded-lg hover:bg-gray-700 transition"><span>ğŸ’¼</span>Ø­Ø±ÙÙ‡</button>
      <button id="assets-tab" class="flex flex-col items-center text-sm p-2 rounded-lg hover:bg-gray-700 transition"><span>ğŸ’°</span>Ø¯Ø§Ø±Ø§ÛŒÛŒâ€ŒÙ‡Ø§</button>
      <button id="age-up-tab" class="flex flex-col items-center text-sm p-2 rounded-lg hover:bg-gray-700 transition"><span>â­ï¸</span>ÛŒÚ© Ø³Ø§Ù„ Ø¨Ú¯Ø°Ø±ÙˆÙ†</button>
      <button id="relationships-main-tab" class="flex flex-col items-center text-sm p-2 rounded-lg hover:bg-gray-700 transition"><span>â¤ï¸</span>Ø±ÙˆØ§Ø¨Ø·</button>
      <button id="activities-tab" class="flex flex-col items-center text-sm p-2 rounded-lg hover:bg-gray-700 transition"><span>...</span>ÙØ¹Ø§Ù„ÛŒØªâ€ŒÙ‡Ø§</button> <!-- Changed emoji to three dots (ØªØºÛŒÛŒØ± Ø§ÛŒÙ…ÙˆØ¬ÛŒ Ø¨Ù‡ Ø³Ù‡ Ù†Ù‚Ø·Ù‡) -->
    </div>

    <div id="activities-menu" style="display: none;" class="modal-overlay"> <!-- Renamed from more-menu -->
      <div class="modal-content text-white">
        <h2 class="text-xl font-bold mb-4">Ú¯Ø²ÛŒÙ†Ù‡â€ŒÙ‡Ø§ÛŒ Ø¨ÛŒØ´ØªØ±</h2>
        <div class="grid grid-cols-2 gap-4">
          <button id="education-btn" class="glass-card p-4 flex flex-col items-center justify-center hover:bg-gray-700 transition">
            <span class="text-2xl">ğŸ“</span>
            <span>ØªØ­ØµÛŒÙ„Ø§Øª</span>
          </button>
          <button id="health-btn" class="glass-card p-4 flex flex-col items-center justify-center hover:bg-gray-700 transition">
            <span class="text-2xl">ğŸ¥</span>
            <span>Ø³Ù„Ø§Ù…Øª</span>
          </button>
          <button id="finance-btn" class="glass-card p-4 flex flex-col items-center justify-center hover:bg-gray-700 transition">
            <span class="text-2xl">ğŸ“Š</span>
            <span>Ù…Ø§Ù„ÛŒ</span>
          </button>
          <button id="investments-btn" class="glass-card p-4 flex flex-col items-center justify-center hover:bg-gray-700 transition">
            <span class="text-2xl">ğŸ“ˆ</span>
            <span>Ø³Ø±Ù…Ø§ÛŒÙ‡â€ŒÚ¯Ø°Ø§Ø±ÛŒ</span>
          </button>
          <!-- Removed settings button from activities menu (Ø¯Ú©Ù…Ù‡ ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø§Ø² Ù…Ù†ÙˆÛŒ ÙØ¹Ø§Ù„ÛŒØªâ€ŒÙ‡Ø§ Ø­Ø°Ù Ø´Ø¯) -->
        </div>
        <button id="close-activities-menu" class="btn-secondary w-full py-2 mt-4 rounded-lg">Ø¨Ø³ØªÙ†</button> <!-- Renamed ID -->
      </div>
    </div>
  </div>

  <div id="character-page" style="display: none;" class="min-h-screen p-4 main-content-padding page-content-scroll">
    <div class="back-button-container">
        <!-- Back button for Character Page, returns to Dashboard (Ø¯Ú©Ù…Ù‡ Ø¨Ø§Ø²Ú¯Ø´Øª Ø¨Ø±Ø§ÛŒ ØµÙØ­Ù‡ Ø´Ø®ØµÛŒØªØŒ Ø¨Ù‡ Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯ Ø¨Ø±Ù…ÛŒâ€ŒÚ¯Ø±Ø¯Ø¯) -->
        <button class="btn-secondary px-4 py-2 rounded-lg" onclick="window.showPage('dashboard')">Ø¨Ø§Ø²Ú¯Ø´Øª</button>
    </div>
    <h2 class="text-2xl font-bold mb-4">Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø´Ø®ØµÛŒØª</h2>
    <div class="glass-card p-4 mb-4">
      <p><strong>Ù†Ø§Ù…:</strong> <span id="char-name"></span></p>
      <p><strong>Ø¬Ù†Ø³ÛŒØª:</strong> <span id="char-gender"></span></p>
      <p><strong>Ù…Ø­Ù„ ØªÙˆÙ„Ø¯:</strong> <span id="char-province"></span></p>
      <p><strong>ÙˆØ¶Ø¹ÛŒØª Ø®Ø§Ù†ÙˆØ§Ø¯Ú¯ÛŒ:</strong> <span id="char-family"></span></p>
      <p><strong>Ø³Ù†:</strong> <span id="char-age"></span></p>
    </div>
    <div class="glass-card p-4 mb-4">
      <h3 class="text-lg font-semibold mb-2">Ø®Ø§Ù†ÙˆØ§Ø¯Ù‡</h3>
      <ul id="family-list" class="space-y-2"></ul>
    </div>
    <div class="glass-card p-4">
      <h3 class="text-lg font-semibold mb-2">ÙˆÛŒÚ˜Ú¯ÛŒâ€ŒÙ‡Ø§</h3>
      <p>Ù‡ÙˆØ´: <span id="char-smarts"></span></p>
      <p>Ø¸Ø§Ù‡Ø±: <span id="char-looks"></span></p>
      <p>Ù…Ø¹Ù†ÙˆÛŒØª: <span id="char-spirituality"></span></p>
    </div>
  </div>

  <div id="log-page" style="display: none;" class="min-h-screen p-4"> <!-- Removed page-content-scroll from log-page itself -->
    <div class="back-button-container">
        <!-- Back button for Log Page, returns to Activities Menu (Ø¯Ú©Ù…Ù‡ Ø¨Ø§Ø²Ú¯Ø´Øª Ø¨Ø±Ø§ÛŒ ØµÙØ­Ù‡ ØªØ§Ø±ÛŒØ®Ú†Ù‡ØŒ Ø¨Ù‡ Ù…Ù†ÙˆÛŒ ÙØ¹Ø§Ù„ÛŒØªâ€ŒÙ‡Ø§ Ø¨Ø±Ù…ÛŒâ€ŒÚ¯Ø±Ø¯Ø¯) -->
        <button class="btn-secondary px-4 py-2 rounded-lg" onclick="window.showActivitiesMenu()">Ø¨Ø§Ø²Ú¯Ø´Øª</button>
    </div>
    <h2 class="text-2xl font-bold mb-4">ØªØ§Ø±ÛŒØ®Ú†Ù‡ Ø²Ù†Ø¯Ú¯ÛŒ</h2>
    <div class="glass-card p-4 flex flex-col"> <!-- Added flex flex-col to parent glass-card -->
      <div class="flex space-x-2 mb-4 overflow-x-auto pb-2 flex-shrink-0"> <!-- Added flex-shrink-0 for filter buttons -->
        <button id="log-filter-all" class="btn-primary px-4 py-2 rounded-lg flex-shrink-0">Ù‡Ù…Ù‡</button>
        <button id="log-filter-career" class="btn-secondary px-4 py-2 rounded-lg flex-shrink-0">Ø´ØºÙ„</button>
        <button id="log-filter-family" class="btn-secondary px-4 py-2 rounded-lg flex-shrink-0">Ø®Ø§Ù†ÙˆØ§Ø¯Ù‡</button>
        <button id="log-filter-health" class="btn-secondary px-4 py-2 rounded-lg flex-shrink-0">Ø³Ù„Ø§Ù…Øª</button>
        <button id="log-filter-education" class="btn-secondary px-4 py-2 rounded-lg flex-shrink-0">ØªØ­ØµÛŒÙ„Ø§Øª</button>
        <button id="log-filter-finance" class="btn-secondary px-4 py-2 rounded-lg flex-shrink-0">Ù…Ø§Ù„ÛŒ</button>
      </div>
      <div id="full-log-scroll-area"> <!-- New scrollable container for the full log (Ú©Ø§Ù†ØªÛŒÙ†Ø± Ù‚Ø§Ø¨Ù„ Ø§Ø³Ú©Ø±ÙˆÙ„ Ø¬Ø¯ÛŒØ¯ Ø¨Ø±Ø§ÛŒ Ú¯Ø²Ø§Ø±Ø´ Ú©Ø§Ù…Ù„) -->
        <ul id="life-log-full" class="space-y-4"></ul>
      </div>
    </div>
  </div>

  <div id="education-page" style="display: none;" class="min-h-screen p-4 main-content-padding page-content-scroll">
    <div class="back-button-container">
        <!-- Back button for Education Page, returns to Activities Menu (Ø¯Ú©Ù…Ù‡ Ø¨Ø§Ø²Ú¯Ø´Øª Ø¨Ø±Ø§ÛŒ ØµÙØ­Ù‡ ØªØ­ØµÛŒÙ„Ø§ØªØŒ Ø¨Ù‡ Ù…Ù†ÙˆÛŒ ÙØ¹Ø§Ù„ÛŒØªâ€ŒÙ‡Ø§ Ø¨Ø±Ù…ÛŒâ€ŒÚ¯Ø±Ø¯Ø¯) -->
        <button class="btn-secondary px-4 py-2 rounded-lg" onclick="window.showActivitiesMenu()">Ø¨Ø§Ø²Ú¯Ø´Øª</button>
    </div>
    <h2 class="text-2xl font-bold mb-4">ØªØ­ØµÛŒÙ„Ø§Øª</h2>
    <div class="glass-card p-4">
      <div class="flex space-x-2 mb-4">
        <button id="school-tab" class="btn-primary px-4 py-2 rounded-lg">Ù…Ø¯Ø±Ø³Ù‡</button>
        <button id="university-tab" class="btn-secondary px-4 py-2 rounded-lg">Ø¯Ø§Ù†Ø´Ú¯Ø§Ù‡</button>
      </div>
      <div id="education-content"></div>
    </div>
  </div>

  <div id="job-page" style="display: none;" class="min-h-screen p-4 main-content-padding page-content-scroll">
    <div class="back-button-container">
        <!-- Back button for Job Page, returns to Dashboard (Ø¯Ú©Ù…Ù‡ Ø¨Ø§Ø²Ú¯Ø´Øª Ø¨Ø±Ø§ÛŒ ØµÙØ­Ù‡ Ø´ØºÙ„ØŒ Ø¨Ù‡ Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯ Ø¨Ø±Ù…ÛŒâ€ŒÚ¯Ø±Ø¯Ø¯) -->
        <button class="btn-secondary px-4 py-2 rounded-lg" onclick="window.showPage('dashboard')">Ø¨Ø§Ø²Ú¯Ø´Øª</button>
    </div>
    <h2 class="text-2xl font-bold mb-4">Ø´ØºÙ„</h2>
    <div class="glass-card p-4">
      <div class="flex space-x-2 mb-4">
        <button id="job-list-tab" class="btn-primary px-4 py-2 rounded-lg">Ù…Ø´Ø§ØºÙ„</button>
        <button id="career-progress-tab" class="btn-secondary px-4 py-2 rounded-lg">Ù¾ÛŒØ´Ø±ÙØª Ø´ØºÙ„ÛŒ</button>
      </div>
      <div id="job-content"></div>
    </div>
  </div>

  <div id="relationships-page" style="display: none;" class="min-h-screen p-4 main-content-padding page-content-scroll">
    <div class="back-button-container">
        <!-- Back button for Relationships Page, returns to Dashboard (Ø¯Ú©Ù…Ù‡ Ø¨Ø§Ø²Ú¯Ø´Øª Ø¨Ø±Ø§ÛŒ ØµÙØ­Ù‡ Ø±ÙˆØ§Ø¨Ø·ØŒ Ø¨Ù‡ Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯ Ø¨Ø±Ù…ÛŒâ€ŒÚ¯Ø±Ø¯Ø¯) -->
        <button class="btn-secondary px-4 py-2 rounded-lg" onclick="window.showPage('dashboard')">Ø¨Ø§Ø²Ú¯Ø´Øª</button>
    </div>
    <h2 class="text-2xl font-bold mb-4">Ø±ÙˆØ§Ø¨Ø·</h2>
    <div id="relationships-list" class="grid grid-cols-1 md:grid-cols-2 gap-4"></div>
    <div class="glass-card p-4 mt-4">
      <h3 class="text-lg font-semibold mb-2">Ø±ÙˆØ§Ø¨Ø· Ø¹Ø§Ø·ÙÛŒ</h3>
      <div id="romantic-relationships" class="space-y-2"></div>
      <button id="find-partner-btn" class="btn-primary px-4 py-2 rounded-lg mt-4">Ù¾ÛŒØ¯Ø§ Ú©Ø±Ø¯Ù† Ø´Ø±ÛŒÚ© Ø¹Ø§Ø·ÙÛŒ</button>
    </div>
  </div>

  <div id="health-page" style="display: none;" class="min-h-screen p-4 main-content-padding page-content-scroll">
    <div class="back-button-container">
        <!-- Back button for Health Page, returns to Activities Menu (Ø¯Ú©Ù…Ù‡ Ø¨Ø§Ø²Ú¯Ø´Øª Ø¨Ø±Ø§ÛŒ ØµÙØ­Ù‡ Ø³Ù„Ø§Ù…ØªØŒ Ø¨Ù‡ Ù…Ù†ÙˆÛŒ ÙØ¹Ø§Ù„ÛŒØªâ€ŒÙ‡Ø§ Ø¨Ø±Ù…ÛŒâ€ŒÚ¯Ø±Ø¯Ø¯) -->
        <button class="btn-secondary px-4 py-2 rounded-lg" onclick="window.showActivitiesMenu()">Ø¨Ø§Ø²Ú¯Ø´Øª</button>
    </div>
    <h2 class="text-2xl font-bold mb-4">Ø³Ù„Ø§Ù…Øª</h2>
    <div class="glass-card p-4">
      <p><strong>ÙˆØ¶Ø¹ÛŒØª Ø³Ù„Ø§Ù…Øª:</strong> <span id="health-status"></span></p>
      <p><strong>Ø¨ÛŒÙ…Ø§Ø±ÛŒâ€ŒÙ‡Ø§:</strong> <span id="illnesses"></span></p>
      <div class="flex space-x-2 mt-4 flex-wrap gap-2">
        <button id="visit-doctor" class="btn-primary px-4 py-2 rounded-lg">Ù…Ø±Ø§Ø¬Ø¹Ù‡ Ø¨Ù‡ Ù¾Ø²Ø´Ú© Ø¹Ù…ÙˆÙ…ÛŒ</button>
        <button id="visit-specialist" class="btn-primary px-4 py-2 rounded-lg">Ù…Ø±Ø§Ø¬Ø¹Ù‡ Ø¨Ù‡ Ù…ØªØ®ØµØµ</button>
        <button id="go-gym" class="btn-primary px-4 py-2 rounded-lg">ÙˆØ±Ø²Ø´</button>
        <button id="meditate" class="btn-primary px-4 py-2 rounded-lg">Ù…Ø±Ø§Ù‚Ø¨Ù‡</button>
      </div>
    </div>
    <div class="glass-card p-4 mt-4">
      <h3 class="text-lg font-semibold mb-2">Ø¨ÛŒÙ…Ø§Ø±ÛŒâ€ŒÙ‡Ø§ Ùˆ Ø¯Ø±Ù…Ø§Ù†â€ŒÙ‡Ø§</h3>
      <ul id="illness-list" class="space-y-2"></ul>
    </div>
  </div>

  <div id="finance-page" style="display: none;" class="min-h-screen p-4 main-content-padding page-content-scroll">
    <div class="back-button-container">
        <button class="btn-secondary px-4 py-2 rounded-lg" onclick="window.showActivitiesMenu()">Ø¨Ø§Ø²Ú¯Ø´Øª</button>
    </div>
    <h2 class="text-2xl font-bold mb-4">Ù…Ø§Ù„ÛŒ</h2>
    <div class="glass-card p-4">
      <p><strong>Ø¯Ø§Ø±Ø§ÛŒÛŒ Ø®Ø§Ù„Øµ:</strong> <span id="net-worth"></span></p>
      <canvas id="finance-chart" class="my-4 w-full h-64"></canvas>
      <div class="flex space-x-2 flex-wrap gap-2">
        <!-- Removed Invest button, now it's in the investments page (Ø¯Ú©Ù…Ù‡ Ø³Ø±Ù…Ø§ÛŒÙ‡â€ŒÚ¯Ø°Ø§Ø±ÛŒ Ø­Ø°Ù Ø´Ø¯ØŒ Ø§Ú©Ù†ÙˆÙ† Ø¯Ø± ØµÙØ­Ù‡ Ø³Ø±Ù…Ø§ÛŒÙ‡â€ŒÚ¯Ø°Ø§Ø±ÛŒ Ø§Ø³Øª) -->
        <button id="loan-btn" class="btn-primary px-4 py-2 rounded-lg">Ø¯Ø±ÛŒØ§ÙØª ÙˆØ§Ù…</button>
      </div>
    </div>
    <!-- Removed investment-section, now it's in the investments page (Ø¨Ø®Ø´ Ø³Ø±Ù…Ø§ÛŒÙ‡â€ŒÚ¯Ø°Ø§Ø±ÛŒ Ø­Ø°Ù Ø´Ø¯ØŒ Ø§Ú©Ù†ÙˆÙ† Ø¯Ø± ØµÙØ­Ù‡ Ø³Ø±Ù…Ø§ÛŒÙ‡â€ŒÚ¯Ø°Ø§Ø±ÛŒ Ø§Ø³Øª) -->
    <div id="loan-section" style="display: none;" class="glass-card p-4 mt-4">
      <h3 class="text-lg font-semibold mb-2">Ø¯Ø±ÛŒØ§ÙØª ÙˆØ§Ù…</h3>
      <p class="mb-2">Ù…Ø¨Ù„Øº ÙˆØ§Ù… (ØªÙˆÙ…Ø§Ù†):</p>
      <input type="number" id="loan-amount" class="w-full p-2 mb-4 text-right bg-gray-800 rounded-lg focus:outline-none focus:ring-2 focus:ring-emerald-500" min="100000" value="100000">
      <button id="confirm-loan-btn" class="btn-primary w-full py-2 rounded-lg" onclick="window.takeLoan()">ØªØ§ÛŒÛŒØ¯ ÙˆØ§Ù…</button>
      <ul id="current-loans" class="mt-4 space-y-2"></ul>
    </div>
  </div>

  <!-- New Investment Page (ØµÙØ­Ù‡ Ø¬Ø¯ÛŒØ¯ Ø³Ø±Ù…Ø§ÛŒÙ‡â€ŒÚ¯Ø°Ø§Ø±ÛŒ) -->
  <div id="investment-page" style="display: none;" class="min-h-screen p-4 main-content-padding page-content-scroll">
    <div class="back-button-container">
        <button class="btn-secondary px-4 py-2 rounded-lg" onclick="window.showActivitiesMenu()">Ø¨Ø§Ø²Ú¯Ø´Øª</button>
    </div>
    <h2 class="text-2xl font-bold mb-4">Ø³Ø±Ù…Ø§ÛŒÙ‡â€ŒÚ¯Ø°Ø§Ø±ÛŒâ€ŒÙ‡Ø§</h2>
    <div class="glass-card p-4 flex flex-col space-y-4">
      <button id="gold_coins-category-btn" class="btn-secondary w-full py-3 rounded-lg flex-shrink-0">ğŸ’° Ø·Ù„Ø§ Ùˆ Ø³Ú©Ù‡</button>
      <button id="stocks_bourse-category-btn" class="btn-secondary w-full py-3 rounded-lg flex-shrink-0">ğŸ“ˆ Ø³Ù‡Ø§Ù… Ø¨ÙˆØ±Ø³</button>
      <button id="cryptocurrency-category-btn" class="btn-secondary w-full py-3 rounded-lg flex-shrink-0">â‚¿ Ø§Ø±Ø² Ø¯ÛŒØ¬ÛŒØªØ§Ù„</button>
      <button id="investment_land-category-btn" class="btn-secondary w-full py-3 rounded-lg flex-shrink-0">ğŸ¡ Ø²Ù…ÛŒÙ† Ùˆ Ø§Ù…Ù„Ø§Ú©</button>
      <button id="raw_materials-category-btn" class="btn-secondary w-full py-3 rounded-lg flex-shrink-0">ğŸ“¦ Ù…ÙˆØ§Ø¯ Ø§ÙˆÙ„ÛŒÙ‡</button>
    </div>
    <div class="glass-card p-4 mt-4">
      <h3 class="text-lg font-semibold mb-2">Ø³Ø±Ù…Ø§ÛŒÙ‡â€ŒÚ¯Ø°Ø§Ø±ÛŒâ€ŒÙ‡Ø§ÛŒ ÙØ¹Ù„ÛŒ Ø´Ù…Ø§:</h3>
      <ul id="current-investments-summary" class="mt-4 space-y-2"></ul>
    </div>
  </div>

  <!-- New detailed investment pages (ØµÙØ­Ø§Øª Ø¬Ø²Ø¦ÛŒØ§Øª Ø³Ø±Ù…Ø§ÛŒÙ‡â€ŒÚ¯Ø°Ø§Ø±ÛŒ Ø¬Ø¯ÛŒØ¯) -->
  <div id="gold_coins-page" style="display: none;" class="min-h-screen p-4 main-content-padding page-content-scroll">
    <div class="back-button-container">
        <button class="btn-secondary px-4 py-2 rounded-lg" onclick="window.showPage('investment-page')">Ø¨Ø§Ø²Ú¯Ø´Øª Ø¨Ù‡ Ø³Ø±Ù…Ø§ÛŒÙ‡â€ŒÚ¯Ø°Ø§Ø±ÛŒâ€ŒÙ‡Ø§</button>
    </div>
    <h2 class="text-2xl font-bold mb-4">ğŸ’° Ø·Ù„Ø§ Ùˆ Ø³Ú©Ù‡</h2>
    <div class="glass-card p-4 mb-4">
      <h3 class="text-lg font-semibold mb-2">Ø¯Ø§Ø±Ø§ÛŒÛŒâ€ŒÙ‡Ø§ÛŒ ÙØ¹Ù„ÛŒ Ø´Ù…Ø§:</h3>
      <div id="owned-gold_coins-list" class="space-y-2 asset-list-container max-h-40 overflow-y-auto"></div>
    </div>
    <div class="glass-card p-4">
      <h3 class="text-lg font-semibold mb-2">Ø¨Ø±Ø§ÛŒ Ø®Ø±ÛŒØ¯:</h3>
      <div id="buy-gold_coins-list" class="space-y-2 asset-list-container"></div>
    </div>
  </div>

  <div id="stocks_bourse-page" style="display: none;" class="min-h-screen p-4 main-content-padding page-content-scroll">
    <div class="back-button-container">
        <button class="btn-secondary px-4 py-2 rounded-lg" onclick="window.showPage('investment-page')">Ø¨Ø§Ø²Ú¯Ø´Øª Ø¨Ù‡ Ø³Ø±Ù…Ø§ÛŒÙ‡â€ŒÚ¯Ø°Ø§Ø±ÛŒâ€ŒÙ‡Ø§</button>
    </div>
    <h2 class="text-2xl font-bold mb-4">ğŸ“ˆ Ø³Ù‡Ø§Ù… Ø¨ÙˆØ±Ø³</h2>
    <div class="glass-card p-4 mb-4">
      <h3 class="text-lg font-semibold mb-2">Ø¯Ø§Ø±Ø§ÛŒÛŒâ€ŒÙ‡Ø§ÛŒ ÙØ¹Ù„ÛŒ Ø´Ù…Ø§:</h3>
      <div id="owned-stocks_bourse-list" class="space-y-2 asset-list-container max-h-40 overflow-y-auto"></div>
    </div>
    <div class="glass-card p-4">
      <h3 class="text-lg font-semibold mb-2">Ø¨Ø±Ø§ÛŒ Ø®Ø±ÛŒØ¯:</h3>
      <div id="buy-stocks_bourse-list" class="space-y-2 asset-list-container"></div>
    </div>
  </div>

  <div id="cryptocurrency-page" style="display: none;" class="min-h-screen p-4 main-content-padding page-content-scroll">
    <div class="back-button-container">
        <button class="btn-secondary px-4 py-2 rounded-lg" onclick="window.showPage('investment-page')">Ø¨Ø§Ø²Ú¯Ø´Øª Ø¨Ù‡ Ø³Ø±Ù…Ø§ÛŒÙ‡â€ŒÚ¯Ø°Ø§Ø±ÛŒâ€ŒÙ‡Ø§</button>
    </div>
    <h2 class="text-2xl font-bold mb-4">â‚¿ Ø§Ø±Ø² Ø¯ÛŒØ¬ÛŒØªØ§Ù„</h2>
    <div class="glass-card p-4 mb-4">
      <h3 class="text-lg font-semibold mb-2">Ø¯Ø§Ø±Ø§ÛŒÛŒâ€ŒÙ‡Ø§ÛŒ ÙØ¹Ù„ÛŒ Ø´Ù…Ø§:</h3>
      <div id="owned-cryptocurrency-list" class="space-y-2 asset-list-container max-h-40 overflow-y-auto"></div>
    </div>
    <div class="glass-card p-4">
      <h3 class="text-lg font-semibold mb-2">Ø¨Ø±Ø§ÛŒ Ø®Ø±ÛŒØ¯:</h3>
      <div id="buy-cryptocurrency-list" class="space-y-2 asset-y-auto"></div>
    </div>
  </div>

  <div id="investment_land-page" style="display: none;" class="min-h-screen p-4 main-content-padding page-content-scroll">
    <div class="back-button-container">
        <button class="btn-secondary px-4 py-2 rounded-lg" onclick="window.showPage('investment-page')">Ø¨Ø§Ø²Ú¯Ø´Øª Ø¨Ù‡ Ø³Ø±Ù…Ø§ÛŒÙ‡â€ŒÚ¯Ø°Ø§Ø±ÛŒâ€ŒÙ‡Ø§</button>
    </div>
    <h2 class="text-2xl font-bold mb-4">ğŸ¡ Ø²Ù…ÛŒÙ† Ùˆ Ø§Ù…Ù„Ø§Ú© (Ø³Ø±Ù…Ø§ÛŒÙ‡â€ŒÚ¯Ø°Ø§Ø±ÛŒ)</h2>
    <div class="glass-card p-4 mb-4">
      <h3 class="text-lg font-semibold mb-2">Ø¯Ø§Ø±Ø§ÛŒÛŒâ€ŒÙ‡Ø§ÛŒ ÙØ¹Ù„ÛŒ Ø´Ù…Ø§:</h3>
      <div id="owned-investment_land-list" class="space-y-2 asset-list-container max-h-40 overflow-y-auto"></div>
    </div>
    <div class="glass-card p-4">
      <h3 class="text-lg font-semibold mb-2">Ø¨Ø±Ø§ÛŒ Ø®Ø±ÛŒØ¯:</h3>
      <div id="buy-investment_land-list" class="space-y-2 asset-list-container"></div>
    </div>
  </div>

  <div id="raw_materials-page" style="display: none;" class="min-h-screen p-4 main-content-padding page-content-scroll">
    <div class="back-button-container">
        <button class="btn-secondary px-4 py-2 rounded-lg" onclick="window.showPage('investment-page')">Ø¨Ø§Ø²Ú¯Ø´Øª Ø¨Ù‡ Ø³Ø±Ù…Ø§ÛŒÙ‡â€ŒÚ¯Ø°Ø§Ø±ÛŒâ€ŒÙ‡Ø§</button>
    </div>
    <h2 class="text-2xl font-bold mb-4">ğŸ“¦ Ù…ÙˆØ§Ø¯ Ø§ÙˆÙ„ÛŒÙ‡</h2>
    <div class="glass-card p-4 mb-4">
      <h3 class="text-lg font-semibold mb-2">Ø¯Ø§Ø±Ø§ÛŒÛŒâ€ŒÙ‡Ø§ÛŒ ÙØ¹Ù„ÛŒ Ø´Ù…Ø§:</h3>
      <div id="owned-raw_materials-list" class="space-y-2 asset-list-container max-h-40 overflow-y-auto"></div>
    </div>
    <div class="glass-card p-4">
      <h3 class="text-lg font-semibold mb-2">Ø¨Ø±Ø§ÛŒ Ø®Ø±ÛŒØ¯:</h3>
      <div id="buy-raw_materials-list" class="space-y-2 asset-list-container"></div>
    </div>
  </div>


  <div id="assets-page" style="display: none;" class="min-h-screen p-4 main-content-padding page-content-scroll">
    <div class="back-button-container">
        <!-- Back button for Assets Page, returns to Dashboard (Ø¯Ú©Ù…Ù‡ Ø¨Ø§Ø²Ú¯Ø´Øª Ø¨Ø±Ø§ÛŒ ØµÙØ­Ù‡ Ø¯Ø§Ø±Ø§ÛŒÛŒâ€ŒÙ‡Ø§ØŒ Ø¨Ù‡ Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯ Ø¨Ø±Ù…ÛŒâ€ŒÚ¯Ø±Ø¯Ø¯) -->
        <button class="btn-secondary px-4 py-2 rounded-lg" onclick="window.showPage('dashboard')">Ø¨Ø§Ø²Ú¯Ø´Øª</button>
    </div>
    <h2 class="text-2xl font-bold mb-4">Ø¯Ø§Ø±Ø§ÛŒÛŒâ€ŒÙ‡Ø§</h2>
    <!-- Vertical list of asset categories (Ù„ÛŒØ³Øª Ø¹Ù…ÙˆØ¯ÛŒ Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒâ€ŒÙ‡Ø§ÛŒ Ø¯Ø§Ø±Ø§ÛŒÛŒ) -->
    <div id="assets-category-list" class="glass-card p-4 flex flex-col space-y-4">
      <button id="properties-category-btn" class="btn-secondary w-full py-3 rounded-lg flex-shrink-0">ğŸ  Ø§Ù…Ù„Ø§Ú©</button>
      <button id="vehicles-category-btn" class="btn-secondary w-full py-3 rounded-lg flex-shrink-0">ğŸš— Ø®ÙˆØ¯Ø±ÙˆÙ‡Ø§</button>
      <button id="plane_boat-category-btn" class="btn-secondary w-full py-3 rounded-lg flex-shrink-0">âœˆï¸/â›µ Ù‡ÙˆØ§Ù¾ÛŒÙ…Ø§/Ù‚Ø§ÛŒÙ‚</button>
      <button id="jewelry-category-btn" class="btn-secondary w-full py-3 rounded-lg flex-shrink-0">ğŸ’ Ø¬ÙˆØ§Ù‡Ø±Ø§Øª</button>
      <button id="instruments-category-btn" class="btn-secondary w-full py-3 rounded-lg flex-shrink-0">ğŸ¸ Ø³Ø§Ø²Ù‡Ø§</button>
      <!-- Removed investments-category-btn from assets, now in activities menu (Ø³Ø±Ù…Ø§ÛŒÙ‡â€ŒÚ¯Ø°Ø§Ø±ÛŒâ€ŒÙ‡Ø§ Ø§Ø² Ø¯Ø§Ø±Ø§ÛŒÛŒâ€ŒÙ‡Ø§ Ø­Ø°Ù Ø´Ø¯ØŒ Ø§Ú©Ù†ÙˆÙ† Ø¯Ø± Ù…Ù†ÙˆÛŒ ÙØ¹Ø§Ù„ÛŒØªâ€ŒÙ‡Ø§ Ø§Ø³Øª) -->
    </div>
  </div>


  <div id="settings-page" style="display: none;" class="min-h-screen p-4 main-content-padding page-content-scroll">
    <div class="back-button-container">
        <!-- Back button for Settings Page, returns to Dashboard (Ø¯Ú©Ù…Ù‡ Ø¨Ø§Ø²Ú¯Ø´Øª Ø¨Ø±Ø§ÛŒ ØµÙØ­Ù‡ ØªÙ†Ø¸ÛŒÙ…Ø§ØªØŒ Ø¨Ù‡ Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯ Ø¨Ø±Ù…ÛŒâ€ŒÚ¯Ø±Ø¯Ø¯) -->
        <button class="btn-secondary px-4 py-2 rounded-lg" onclick="window.showPage('dashboard')">Ø¨Ø§Ø²Ú¯Ø´Øª</button>
    </div>
    <h2 class="text-2xl font-bold mb-4">ØªÙ†Ø¸ÛŒÙ…Ø§Øª</h2>
    <div class="glass-card p-4">
      <div class="mb-4">
        <label class="block mb-2">ØªÙ…</label>
        <select id="theme-select" class="w-full p-2 bg-gray-800 rounded-lg">
          <option value="dark" selected>ØªÛŒØ±Ù‡</option>
          <option value="light">Ø±ÙˆØ´Ù†</option>
        </select>
      </div>
      <div class="flex space-x-2 flex-wrap gap-2">
        <button id="save-game" class="btn-primary px-4 py-2 rounded-lg">Ø°Ø®ÛŒØ±Ù‡</button>
        <button id="load-game" class="btn-primary px-4 py-2 rounded-lg">Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ</button>
        <button id="reset-game" class="btn-secondary px-4 py-2 rounded-lg">Ø±ÛŒØ³Øª</button>
      </div>
    </div>
  </div>

  <script type="module">
    // Global game state and other variables (ÙˆØ¶Ø¹ÛŒØª Ø³Ø±Ø§Ø³Ø±ÛŒ Ø¨Ø§Ø²ÛŒ Ùˆ Ø³Ø§ÛŒØ± Ù…ØªØºÛŒØ±Ù‡Ø§)
    let gameState = {
      name: '',
      gender: '',
      province: '',
      familyStatus: '',
      age: 0,
      year: 2025,
      money: 0,
      happiness: 50,
      health: 80,
      smarts: 50,
      looks: 50,
      spirituality: 50,
      education: { level: 'Ù‡ÛŒÚ†', major: '', degreeProgress: 0 },
      job: { title: 'Ø¨ÛŒÚ©Ø§Ø±', salary: 0, level: 0, experience: 0 },
      relationships: [
        { id: 'parent1', name: 'Ù¾Ø¯Ø±', role: 'Ù¾Ø¯Ø±', relationship: 80, respect: 70, happiness: 60 },
        { id: 'parent2', name: 'Ù…Ø§Ø¯Ø±', role: 'Ù…Ø§Ø¯Ø±', relationship: 85, respect: 75, happiness: 65 }
      ],
      romanticRelationships: [],
      children: [],
      illnesses: [],
      assets: [], // For properties, vehicles, jewelry, instruments
      loans: [],
      investments: [], // For gold, stocks, crypto, investment_land, raw_materials
      log: [],
      financeHistory: [{ year: 2025, money: 0 }]
    };

    let financeChartInstance; // To store the Chart.js instance (Ø¨Ø±Ø§ÛŒ Ø°Ø®ÛŒØ±Ù‡ Ù†Ù…ÙˆÙ†Ù‡ Chart.js)
    let currentInvestmentPageType = ''; // To track the currently open investment detail page (Ø¨Ø±Ø§ÛŒ Ù¾ÛŒÚ¯ÛŒØ±ÛŒ ØµÙØ­Ù‡ Ø¬Ø²Ø¦ÛŒØ§Øª Ø³Ø±Ù…Ø§ÛŒÙ‡â€ŒÚ¯Ø°Ø§Ø±ÛŒ Ø¨Ø§Ø² Ø´Ø¯Ù‡)
    let activeMainPageId = 'start-screen'; // To track the currently active *main* page (Ø¨Ø±Ø§ÛŒ Ù¾ÛŒÚ¯ÛŒØ±ÛŒ ØµÙØ­Ù‡ Ø§ØµÙ„ÛŒ ÙØ¹Ø§Ù„ ÙØ¹Ù„ÛŒ)
    let pageBeforeActivitiesMenu = ''; // New: Stores the page active before activities menu was opened (Ø¬Ø¯ÛŒØ¯: ØµÙØ­Ù‡â€ŒÛŒ ÙØ¹Ø§Ù„ Ù‚Ø¨Ù„ Ø§Ø² Ø¨Ø§Ø² Ø´Ø¯Ù† Ù…Ù†ÙˆÛŒ ÙØ¹Ø§Ù„ÛŒØªâ€ŒÙ‡Ø§ Ø±Ø§ Ø°Ø®ÛŒØ±Ù‡ Ù…ÛŒâ€ŒÚ©Ù†Ø¯)

    // Custom Message Modal (Ù…ÙˆØ¯Ø§Ù„ Ù¾ÛŒØ§Ù… Ø³ÙØ§Ø±Ø´ÛŒ)
    function showMessageModal(message) {
      const modalOverlay = document.createElement('div');
      modalOverlay.className = 'modal-overlay';
      
      const modalContent = document.createElement('div');
      modalContent.className = 'modal-content';
      
      const messageText = document.createElement('p');
      messageText.className = 'text-lg mb-4';
      messageText.textContent = message;
      
      const closeButton = document.createElement('button');
      closeButton.className = 'modal-button primary';
      closeButton.textContent = 'Ø¨Ø§Ø´Ù‡';
      closeButton.onclick = () => {
        document.body.removeChild(modalOverlay);
      };

      modalContent.appendChild(messageText);
      modalContent.appendChild(closeButton);
      modalOverlay.appendChild(modalContent);
      document.body.appendChild(modalOverlay);
    }

    // Override default confirm for custom modal (Ø¬Ø§ÛŒÚ¯Ø²ÛŒÙ†ÛŒ confirm Ù¾ÛŒØ´â€ŒÙØ±Ø¶ Ø¨Ø§ Ù…ÙˆØ¯Ø§Ù„ Ø³ÙØ§Ø±Ø´ÛŒ)
    window.confirm = function(message) {
      return new Promise((resolve) => {
        const modalOverlay = document.createElement('div');
        modalOverlay.className = 'modal-overlay';
        
        const modalContent = document.createElement('div');
        modalContent.className = 'modal-content';
        
        const messageText = document.createElement('p');
        messageText.className = 'text-lg mb-4';
        messageText.textContent = message;
        
        const buttonContainer = document.createElement('div');
        buttonContainer.className = 'modal-button-container';

        const confirmButton = document.createElement('button');
        confirmButton.className = 'modal-button primary';
        confirmButton.textContent = 'Ø¨Ù„Ù‡';
        confirmButton.onclick = () => {
          document.body.removeChild(modalOverlay);
          resolve(true);
        };

        const cancelButton = document.createElement('button');
        cancelButton.className = 'modal-button secondary';
        cancelButton.textContent = 'Ø®ÛŒØ±';
        cancelButton.onclick = () => {
          document.body.removeChild(modalOverlay);
          resolve(false);
        };

        buttonContainer.appendChild(confirmButton);
        buttonContainer.appendChild(cancelButton);
        modalContent.appendChild(messageText);
        modalContent.appendChild(buttonContainer);
        modalOverlay.appendChild(modalContent);
        document.body.appendChild(modalOverlay);
      });
    };

    // Initialize Game (Ù…Ù‚Ø¯Ø§Ø±Ø¯Ù‡ÛŒ Ø§ÙˆÙ„ÛŒÙ‡ Ø¨Ø§Ø²ÛŒ)
    async function initGame() {
      console.log('Initializing game...'); // Debugging line

      // Event Listeners for Start Screen (Ø´Ù†ÙˆÙ†Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ø±ÙˆÛŒØ¯Ø§Ø¯ Ø¨Ø±Ø§ÛŒ ØµÙØ­Ù‡ Ø´Ø±ÙˆØ¹)
      document.getElementById('start-new-life').addEventListener('click', startNewLife);
      document.getElementById('continue-life').addEventListener('click', continueLife);

      // Event Listeners for Bottom Tab Bar (Ø´Ù†ÙˆÙ†Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ø±ÙˆÛŒØ¯Ø§Ø¯ Ø¨Ø±Ø§ÛŒ Ù†ÙˆØ§Ø± ØªØ¨ Ù¾Ø§ÛŒÛŒÙ†)
      document.getElementById('career-tab').addEventListener('click', () => { console.log('Navigating to job-page'); window.showPage('job-page'); });
      document.getElementById('assets-tab').addEventListener('click', () => { console.log('Navigating to assets-page'); window.showPage('assets-page'); }); 
      document.getElementById('age-up-tab').addEventListener('click', ageUp);
      document.getElementById('relationships-main-tab').addEventListener('click', () => { console.log('Navigating to relationships-page'); window.showPage('relationships-page'); });
      document.getElementById('activities-tab').addEventListener('click', () => { console.log('Showing activities menu from dashboard'); window.showActivitiesMenu(); }); // Calls modal function directly

      // Event Listener for the new header settings button (Ø´Ù†ÙˆÙ†Ø¯Ù‡ Ø±ÙˆÛŒØ¯Ø§Ø¯ Ø¨Ø±Ø§ÛŒ Ø¯Ú©Ù…Ù‡ ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø¬Ø¯ÛŒØ¯ Ø¯Ø± Ù‡Ø¯Ø±)
      document.getElementById('header-settings-btn').addEventListener('click', () => { console.log('Navigating to settings-page'); window.showPage('settings-page'); });

      // Event Listeners for Activities Menu (Ø´Ù†ÙˆÙ†Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ø±ÙˆÛŒØ¯Ø§Ø¯ Ø¨Ø±Ø§ÛŒ Ù…Ù†ÙˆÛŒ ÙØ¹Ø§Ù„ÛŒØªâ€ŒÙ‡Ø§)
      // These now hide the modal and then show the page (Ø§ÛŒÙ†Ù‡Ø§ Ø§Ú©Ù†ÙˆÙ† Ù…ÙˆØ¯Ø§Ù„ Ø±Ø§ Ù¾Ù†Ù‡Ø§Ù† Ú©Ø±Ø¯Ù‡ Ùˆ Ø³Ù¾Ø³ ØµÙØ­Ù‡ Ø±Ø§ Ù†Ù…Ø§ÛŒØ´ Ù…ÛŒâ€ŒØ¯Ù‡Ù†Ø¯)
      document.getElementById('education-btn').addEventListener('click', () => { console.log('Navigating from activities menu to education-page'); window.hideActivitiesMenu(); window.showPage('education-page'); });
      document.getElementById('health-btn').addEventListener('click', () => { console.log('Navigating from activities menu to health-page'); window.hideActivitiesMenu(); window.showPage('health-page'); });
      // Call updateFinanceChart specifically when finance page is shown
      document.getElementById('finance-btn').addEventListener('click', () => { 
        console.log('Navigating from activities menu to finance-page');
        window.hideActivitiesMenu(); 
        window.showPage('finance-page');
        updateFinanceChart(); // Call update chart when finance page is active
      });
      document.getElementById('investments-btn').addEventListener('click', () => { console.log('Navigating from activities menu to investment-page'); window.hideActivitiesMenu(); window.showPage('investment-page'); }); // New: Go to investment page
      document.getElementById('close-activities-menu').addEventListener('click', () => { console.log('Closing activities menu'); window.hideActivitiesMenu(); }); // Only hides the modal

      // Event Listeners for Settings Page (Ø´Ù†ÙˆÙ†Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ø±ÙˆÛŒØ¯Ø§Ø¯ Ø¨Ø±Ø§ÛŒ ØµÙØ­Ù‡ ØªÙ†Ø¸ÛŒÙ…Ø§Øª)
      document.getElementById('save-game').addEventListener('click', saveGame);
      document.getElementById('load-game').addEventListener('click', loadGame);
      document.getElementById('reset-game').addEventListener('click', resetGame);

      // Event Listeners for Health Page (Ø´Ù†ÙˆÙ†Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ø±ÙˆÛŒØ¯Ø§Ø¯ Ø¨Ø±Ø§ÛŒ ØµÙØ­Ù‡ Ø³Ù„Ø§Ù…Øª)
      document.getElementById('visit-doctor').addEventListener('click', visitDoctor);
      document.getElementById('visit-specialist').addEventListener('click', visitSpecialist);
      document.getElementById('go-gym').addEventListener('click', goGym);
      document.getElementById('meditate').addEventListener('click', meditate);

      // Event Listeners for Finance Page (Ø´Ù†ÙˆÙ†Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ø±ÙˆÛŒØ¯Ø§Ø¯ Ø¨Ø±Ø§ÛŒ ØµÙØ­Ù‡ Ù…Ø§Ù„ÛŒ)
      // Removed investment-related listeners from here, as they are now on investment-page
      document.getElementById('loan-btn').addEventListener('click', () => {
        document.getElementById('loan-section').style.display = document.getElementById('loan-section').style.display === 'none' ? 'block' : 'none';
      });
      document.getElementById('confirm-loan-btn').addEventListener('click', window.takeLoan);

      // Event Listeners for Education Page (Ø´Ù†ÙˆÙ†Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ø±ÙˆÛŒØ¯Ø§Ø¯ Ø¨Ø±Ø§ÛŒ ØµÙØ­Ù‡ ØªØ­ØµÛŒÙ„Ø§Øª)
      document.getElementById('school-tab').addEventListener('click', showSchool);
      document.getElementById('university-tab').addEventListener('click', showUniversity);

      // Event Listeners for Job Page (Ø´Ù†ÙˆÙ†Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ø±ÙˆÛŒØ¯Ø§Ø¯ Ø¨Ø±Ø§ÛŒ ØµÙØ­Ù‡ Ø´ØºÙ„)
      document.getElementById('job-list-tab').addEventListener('click', showJobList);
      document.getElementById('career-progress-tab').addEventListener('click', showCareerProgress);

      // Event Listeners for Assets Page category buttons (Ø´Ù†ÙˆÙ†Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ø±ÙˆÛŒØ¯Ø§Ø¯ Ø¨Ø±Ø§ÛŒ Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ÛŒ Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ ØµÙØ­Ù‡ Ø¯Ø§Ø±Ø§ÛŒÛŒâ€ŒÙ‡Ø§)
      document.getElementById('properties-category-btn').addEventListener('click', () => window.showAssetCategoryPage('properties'));
      document.getElementById('vehicles-category-btn').addEventListener('click', () => window.showAssetCategoryPage('vehicles'));
      document.getElementById('plane_boat-category-btn').addEventListener('click', () => window.showAssetCategoryPage('plane_boat'));
      document.getElementById('jewelry-category-btn').addEventListener('click', () => window.showAssetCategoryPage('jewelry'));
      document.getElementById('instruments-category-btn').addEventListener('click', () => window.showAssetCategoryPage('instruments'));
      
      // Event Listeners for NEW Investment Page category buttons (Ø´Ù†ÙˆÙ†Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ø±ÙˆÛŒØ¯Ø§Ø¯ Ø¨Ø±Ø§ÛŒ Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ÛŒ Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ ØµÙØ­Ù‡ Ø³Ø±Ù…Ø§ÛŒÙ‡â€ŒÚ¯Ø°Ø§Ø±ÛŒ Ø¬Ø¯ÛŒØ¯)
      document.getElementById('gold_coins-category-btn').addEventListener('click', () => window.showInvestmentCategoryPage('gold_coins'));
      document.getElementById('stocks_bourse-category-btn').addEventListener('click', () => window.showInvestmentCategoryPage('stocks_bourse'));
      document.getElementById('cryptocurrency-category-btn').addEventListener('click', () => window.showInvestmentCategoryPage('cryptocurrency'));
      document.getElementById('investment_land-category-btn').addEventListener('click', () => window.showInvestmentCategoryPage('investment_land'));
      document.getElementById('raw_materials-category-btn').addEventListener('click', () => window.showInvestmentCategoryPage('raw_materials'));

      // Event Listeners for Log Filters (Ø´Ù†ÙˆÙ†Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ø±ÙˆÛŒØ¯Ø§Ø¯ Ø¨Ø±Ø§ÛŒ ÙÛŒÙ„ØªØ±Ù‡Ø§ÛŒ ØªØ§Ø±ÛŒØ®Ú†Ù‡)
      document.getElementById('log-filter-all').addEventListener('click', () => filterLog('all'));
      document.getElementById('log-filter-career').addEventListener('click', () => filterLog('career'));
      document.getElementById('log-filter-family').addEventListener('click', () => filterLog('family'));
      document.getElementById('log-filter-health').addEventListener('click', () => filterLog('health'));
      document.getElementById('log-filter-education').addEventListener('click', () => filterLog('education'));
      document.getElementById('log-filter-finance').addEventListener('click', () => filterLog('finance'));
      
      // Event Listener for static "Find Partner" button (Ø´Ù†ÙˆÙ†Ø¯Ù‡ Ø±ÙˆÛŒØ¯Ø§Ø¯ Ø¨Ø±Ø§ÛŒ Ø¯Ú©Ù…Ù‡ Ø«Ø§Ø¨Øª "Ù¾ÛŒØ¯Ø§ Ú©Ø±Ø¯Ù† Ø´Ø±ÛŒÚ© Ø¹Ø§Ø·ÙÛŒ")
      document.getElementById('find-partner-btn').addEventListener('click', window.findPartner);


      // Initial UI update (Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø§ÙˆÙ„ÛŒÙ‡ Ø±Ø§Ø¨Ø· Ú©Ø§Ø±Ø¨Ø±ÛŒ)
      updateUI();
      // Ensure only start screen is visible on initial load (Ø§Ø·Ù…ÛŒÙ†Ø§Ù† Ø§Ø² Ù†Ù…Ø§ÛŒØ´ ØªÙ†Ù‡Ø§ ØµÙØ­Ù‡ Ø´Ø±ÙˆØ¹ Ø¯Ø± Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø§ÙˆÙ„ÛŒÙ‡)
      // activeMainPageId is initially 'start-screen', so this is fine. (activeMainPageId Ø¯Ø± Ø§Ø¨ØªØ¯Ø§ 'start-screen' Ø§Ø³ØªØŒ Ù¾Ø³ Ø§ÛŒÙ† Ø®ÙˆØ¨ Ø§Ø³Øª.)
      window.showPage('start-screen');

      // Call updateInvestmentPrices once initially and then every 9 seconds (ÙØ±Ø§Ø®ÙˆØ§Ù†ÛŒ updateInvestmentPrices ÛŒÚ© Ø¨Ø§Ø± Ø¯Ø± Ø§Ø¨ØªØ¯Ø§ Ùˆ Ø³Ù¾Ø³ Ù‡Ø± Û¹ Ø«Ø§Ù†ÛŒÙ‡)
      updateInvestmentPrices(); // Initial call to set fluctuating prices (ÙØ±Ø§Ø®ÙˆØ§Ù†ÛŒ Ø§ÙˆÙ„ÛŒÙ‡ Ø¨Ø±Ø§ÛŒ ØªÙ†Ø¸ÛŒÙ… Ù‚ÛŒÙ…Øªâ€ŒÙ‡Ø§ÛŒ Ù†ÙˆØ³Ø§Ù†ÛŒ)
      setInterval(updateInvestmentPrices, 9000); // Set interval for price updates (ØªÙ†Ø¸ÛŒÙ… Ø§ÛŒÙ†ØªØ±ÙˆØ§Ù„ Ø¨Ø±Ø§ÛŒ Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ù‚ÛŒÙ…Øªâ€ŒÙ‡Ø§)
    }

    // Start New Life (Ø´Ø±ÙˆØ¹ Ø²Ù†Ø¯Ú¯ÛŒ Ø¬Ø¯ÛŒØ¯)
    function startNewLife() {
      const nameInput = document.getElementById('name-input');
      const name = nameInput.value.trim();
      if (!name || name.length < 2) {
        showMessageModal('Ù„Ø·ÙØ§Ù‹ Ù†Ø§Ù… Ù…Ø¹ØªØ¨Ø± (Ø­Ø¯Ø§Ù‚Ù„ Û² Ø­Ø±Ù) Ø®ÙˆØ¯ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯.');
        nameInput.focus();
        return;
      }
      
      gameState = {
        name: name,
        gender: document.getElementById('gender-select').value,
        province: document.getElementById('province-select').value,
        familyStatus: document.getElementById('family-status').value,
        age: 0,
        year: 2025,
        money: 0,
        happiness: 50,
        health: 80,
        smarts: 50,
        looks: 50,
        spirituality: 50,
        education: { level: 'Ù‡ÛŒÚ†', major: '', degreeProgress: 0 },
        job: { title: 'Ø¨ÛŒÚ©Ø§Ø±', salary: 0, level: 0, experience: 0 },
        relationships: [
          { id: 'parent1', name: 'Ù¾Ø¯Ø±', role: 'Ù¾Ø¯Ø±', relationship: 80, respect: 70, happiness: 60 },
          { id: 'parent2', name: 'Ù…Ø§Ø¯Ø±', role: 'Ù…Ø§Ø¯Ø±', relationship: 85, respect: 75, happiness: 65 }
        ],
        romanticRelationships: [],
        children: [],
        illnesses: [],
        assets: [],
        loans: [],
        investments: [],
        log: [],
        financeHistory: [{ year: 2025, money: 0 }]
      };

      // Initial money based on family status (Ù¾ÙˆÙ„ Ø§ÙˆÙ„ÛŒÙ‡ Ø¨Ø± Ø§Ø³Ø§Ø³ ÙˆØ¶Ø¹ÛŒØª Ø®Ø§Ù†ÙˆØ§Ø¯Ú¯ÛŒ)
      switch (gameState.familyStatus) {
        case 'wealthy': gameState.money = 10000000; break;
        case 'poor': gameState.money = 100000; break;
        case 'rural': gameState.money = 200000; break;
        default: gameState.money = 500000; break;
      }

      gameState.log.push({ year: gameState.year, event: `Ø´Ù…Ø§ Ø¯Ø± ${document.querySelector(`#province-select option[value="${gameState.province}"]`).textContent} Ù…ØªÙˆÙ„Ø¯ Ø´Ø¯ÛŒØ¯!`, type: 'family' });
      
      updateUI();
      window.showPage('dashboard');
      saveGame();
    }

    // Continue Life (Ø§Ø¯Ø§Ù…Ù‡ Ø²Ù†Ø¯Ú¯ÛŒ)
    function continueLife() {
      try {
        const savedGameState = localStorage.getItem('iranianLifeSimState');
        if (savedGameState) {
          gameState = JSON.parse(savedGameState);
          // Ensure financeHistory is an array and has at least one entry (Ø§Ø·Ù…ÛŒÙ†Ø§Ù† Ø§Ø² Ø§ÛŒÙ†Ú©Ù‡ financeHistory ÛŒÚ© Ø¢Ø±Ø§ÛŒÙ‡ Ø§Ø³Øª Ùˆ Ø­Ø¯Ø§Ù‚Ù„ ÛŒÚ© ÙˆØ±ÙˆØ¯ÛŒ Ø¯Ø§Ø±Ø¯)
          if (!gameState.financeHistory || gameState.financeHistory.length === 0) {
              gameState.financeHistory = [{ year: gameState.year, money: gameState.money }];
          }
          updateUI();
          window.showPage('dashboard');
          showMessageModal('Ø¨Ø§Ø²ÛŒ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø´Ø¯!');
        } else {
          showMessageModal('Ù‡ÛŒÚ† Ø²Ù†Ø¯Ú¯ÛŒ Ø°Ø®ÛŒØ±Ù‡â€ŒØ´Ø¯Ù‡â€ŒØ§ÛŒ ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯!');
        }
      } catch (e) {
        console.error('Error loading game:', e);
        showMessageModal('Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø¨Ø§Ø²ÛŒ! ÙØ§ÛŒÙ„ Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯Ù‡ Ù…Ù…Ú©Ù† Ø§Ø³Øª Ø®Ø±Ø§Ø¨ Ø¨Ø§Ø´Ø¯.');
      }
    }

    // Show Page (Ù†Ù…Ø§ÛŒØ´ ØµÙØ­Ù‡)
    window.showPage = function(pageId) {
      console.log(`[showPage] Attempting to show page: ${pageId}`); // Debugging line

      const pages = [
        'start-screen', 'dashboard', 'character-page', 'log-page', 
        'education-page', 'job-page', 'relationships-page', 
        'health-page', 'finance-page', 'assets-page', 'settings-page',
        'properties-page', 'vehicles-page', 'plane_boat-page', 'jewelry-page', 'instruments-page',
        'investment-page', 'gold_coins-page', 'stocks_bourse-page', 'cryptocurrency-page', 'investment_land-page', 'raw_materials-page'
      ];
      pages.forEach(page => {
        const element = document.getElementById(page);
        if (element) {
          element.style.display = 'none'; // Hide all pages explicitly (Ù¾Ù†Ù‡Ø§Ù† Ú©Ø±Ø¯Ù† Ù‡Ù…Ù‡ ØµÙØ­Ø§Øª Ø¨Ù‡ ØµÙˆØ±Øª ØµØ±ÛŒØ­)
        }
      });

      const targetPage = document.getElementById(pageId);
      if (targetPage) {
        console.log(`[showPage] Page element found: ${pageId}`); // Debugging line
        // Determine the correct display type based on the pageId (ØªØ¹ÛŒÛŒÙ† Ù†ÙˆØ¹ Ù†Ù…Ø§ÛŒØ´ ØµØ­ÛŒØ­ Ø¨Ø± Ø§Ø³Ø§Ø³ pageId)
        if (pageId === 'start-screen' || pageId === 'dashboard') {
          targetPage.style.display = 'flex'; // These are flex containers (Ø§ÛŒÙ†Ù‡Ø§ Ú©Ø§Ù†ØªÛŒÙ†Ø±Ù‡Ø§ÛŒ ÙÙ„Ú©Ø³ Ù‡Ø³ØªÙ†Ø¯)
        }
        else {
          targetPage.style.display = 'block'; // Other pages might be block (Ø³Ø§ÛŒØ± ØµÙØ­Ø§Øª Ù…Ù…Ú©Ù† Ø§Ø³Øª Ø¨Ù„Ø§Ú© Ø¨Ø§Ø´Ù†Ø¯)
        }
        console.log(`[showPage] Display set for ${pageId}: ${targetPage.style.display}`); // Debugging line
        activeMainPageId = pageId; // Update the active main page (Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ ØµÙØ­Ù‡ Ø§ØµÙ„ÛŒ ÙØ¹Ø§Ù„)
      } else {
        console.error(`[showPage] Page element NOT found: ${pageId}`); // Debugging line
      }

      // Handle currentInvestmentPageType (Ù…Ø¯ÛŒØ±ÛŒØª Ù†ÙˆØ¹ ØµÙØ­Ù‡ Ø³Ø±Ù…Ø§ÛŒÙ‡â€ŒÚ¯Ø°Ø§Ø±ÛŒ ÙØ¹Ù„ÛŒ)
      // Clear it unless it's an investment detail page (Ø¢Ù† Ø±Ø§ Ù¾Ø§Ú© Ú©Ù†ÛŒØ¯ Ù…Ú¯Ø± Ø§ÛŒÙ†Ú©Ù‡ ÛŒÚ© ØµÙØ­Ù‡ Ø¬Ø²Ø¦ÛŒØ§Øª Ø³Ø±Ù…Ø§ÛŒÙ‡â€ŒÚ¯Ø°Ø§Ø±ÛŒ Ø¨Ø§Ø´Ø¯)
      const investmentPagePrefixes = Object.keys(investmentCategories); // e.g., ['gold_coins', 'stocks_bourse', ...]
      const isInvestmentDetailPage = investmentPagePrefixes.some(prefix => pageId === `${prefix}-page`);

      if (isInvestmentDetailPage) {
          currentInvestmentPageType = pageId.replace('-page', '');
      } else {
          currentInvestmentPageType = ''; // Clear if not navigating to a specific investment detail page
      }
      
      updateUI(); // Make sure UI is updated after page changes
    }

    // Show Activities Menu (Ù†Ù…Ø§ÛŒØ´ Ù…Ù†ÙˆÛŒ ÙØ¹Ø§Ù„ÛŒØªâ€ŒÙ‡Ø§) - Managed as a separate modal (Ø¨Ù‡ Ø¹Ù†ÙˆØ§Ù† ÛŒÚ© Ù…ÙˆØ¯Ø§Ù„ Ø¬Ø¯Ø§Ú¯Ø§Ù†Ù‡ Ù…Ø¯ÛŒØ±ÛŒØª Ù…ÛŒâ€ŒØ´ÙˆØ¯)
    window.showActivitiesMenu = function() {
      console.log('[showActivitiesMenu] Called');
      const activitiesMenu = document.getElementById('activities-menu');
      const activitiesMenuContent = document.querySelector('#activities-menu .modal-content');

      // Log the activitiesMenu element for more detail
      console.log('[showActivitiesMenu] activitiesMenu element:', activitiesMenu); 
      if (activitiesMenu) {
          const rect = activitiesMenu.getBoundingClientRect();
          console.log(`[showActivitiesMenu] activitiesMenu dimensions: Width=${rect.width}, Height=${rect.height}, Top=${rect.top}, Left=${rect.left}`);
      }
      if (activitiesMenuContent) {
          const contentRect = activitiesMenuContent.getBoundingClientRect();
          console.log(`[showActivitiesMenu] activitiesMenuContent dimensions: Width=${contentRect.width}, Height=${contentRect.height}, Top=${contentRect.top}, Left=${contentRect.left}`);
      }

      if (!activitiesMenu) {
          console.error('[showActivitiesMenu] Activities menu element not found!');
          showMessageModal('Ø®Ø·Ø§: Ù…Ù†ÙˆÛŒ ÙØ¹Ø§Ù„ÛŒØªâ€ŒÙ‡Ø§ ÛŒØ§ÙØª Ù†Ø´Ø¯.');
          return;
      }

      // Store the current active main page before hiding it (Ø°Ø®ÛŒØ±Ù‡ ØµÙØ­Ù‡ Ø§ØµÙ„ÛŒ ÙØ¹Ø§Ù„ ÙØ¹Ù„ÛŒ Ù‚Ø¨Ù„ Ø§Ø² Ù¾Ù†Ù‡Ø§Ù† Ú©Ø±Ø¯Ù† Ø¢Ù†)
      // This is crucial for correctly returning from sub-pages
      pageBeforeActivitiesMenu = activeMainPageId; // Store the ID of the page we're coming from (ID ØµÙØ­Ù‡â€ŒØ§ÛŒ Ú©Ù‡ Ø§Ø² Ø¢Ù† Ù…ÛŒâ€ŒØ¢ÛŒÛŒÙ… Ø±Ø§ Ø°Ø®ÛŒØ±Ù‡ Ú©Ù†ÛŒØ¯)
      console.log(`[showActivitiesMenu] Storing pageBeforeActivitiesMenu as ${pageBeforeActivitiesMenu}`);

      // Hide the currently active main page (Ù¾Ù†Ù‡Ø§Ù† Ú©Ø±Ø¯Ù† ØµÙØ­Ù‡ Ø§ØµÙ„ÛŒ ÙØ¹Ø§Ù„ ÙØ¹Ù„ÛŒ)
      const currentlyVisiblePage = document.getElementById(activeMainPageId);
      if (currentlyVisiblePage) {
          currentlyVisiblePage.style.display = 'none';
          console.log(`[showActivitiesMenu] Hidden active page ${activeMainPageId}`);
      } else {
          console.log(`[showActivitiesMenu] No active page (${activeMainPageId}) to hide.`);
      }

      activitiesMenu.style.display = 'flex'; // Display the modal (Ù†Ù…Ø§ÛŒØ´ Ù…ÙˆØ¯Ø§Ù„)
      // TEST: Temporarily change background to red for visibility (ØªØ³Øª: ØªØºÛŒÛŒØ± Ù…ÙˆÙ‚Øª Ù¾Ø³â€ŒØ²Ù…ÛŒÙ†Ù‡ Ø¨Ù‡ Ù‚Ø±Ù…Ø² Ø¨Ø±Ø§ÛŒ Ù…Ø´Ø§Ù‡Ø¯Ù‡â€ŒÙ¾Ø°ÛŒØ±ÛŒ)
      activitiesMenu.style.backgroundColor = 'rgba(255, 0, 0, 0.75)'; 
      if (activitiesMenuContent) { // Apply green background and blue border to content
          activitiesMenuContent.style.backgroundColor = 'rgba(0, 255, 0, 0.5)';
          activitiesMenuContent.style.border = '2px solid blue';
      }

      console.log(`[showActivitiesMenu] activities-menu display set to flex, backgrounds/borders applied.`);
      console.log(`[showActivitiesMenu] Current activities-menu computed style display:`, window.getComputedStyle(activitiesMenu).display); // Verify
    }

    // Hide Activities Menu (Ù¾Ù†Ù‡Ø§Ù† Ú©Ø±Ø¯Ù† Ù…Ù†ÙˆÛŒ ÙØ¹Ø§Ù„ÛŒØªâ€ŒÙ‡Ø§) - Managed as a separate modal (Ø¨Ù‡ Ø¹Ù†ÙˆØ§Ù† ÛŒÚ© Ù…ÙˆØ¯Ø§Ù„ Ø¬Ø¯Ø§Ú¯Ø§Ù†Ù‡ Ù…Ø¯ÛŒØ±ÛŒØª Ù…ÛŒâ€ŒØ´ÙˆØ¯)
    window.hideActivitiesMenu = function() {
      console.log('[hideActivitiesMenu] Called');
      const activitiesMenu = document.getElementById('activities-menu');
      const activitiesMenuContent = document.querySelector('#activities-menu .modal-content');

      if (!activitiesMenu) {
          console.error('[hideActivitiesMenu] Activities menu element not found!');
          return;
      }
      
      activitiesMenu.style.display = 'none'; // Hide the modal (Ù¾Ù†Ù‡Ø§Ù† Ú©Ø±Ø¯Ù† Ù…ÙˆØ¯Ø§Ù„)
      // Revert background color (Ø¨Ø§Ø²Ú¯Ø±Ø¯Ø§Ù†Ø¯Ù† Ø±Ù†Ú¯ Ù¾Ø³â€ŒØ²Ù…ÛŒÙ†Ù‡)
      activitiesMenu.style.backgroundColor = 'rgba(0, 0, 0, 0.75)'; 
      if (activitiesMenuContent) { // Revert content styles
          activitiesMenuContent.style.backgroundColor = ''; // Revert to original CSS
          activitiesMenuContent.style.border = ''; // Revert to original CSS
      }

      console.log(`[hideActivitiesMenu] activities-menu display set to none and backgrounds/borders reverted`);
      console.log(`[hideActivitiesMenu] Current activities-menu computed style display:`, window.getComputedStyle(activitiesMenu).display); // Verify
      
      // Re-show the page that was active before the modal was opened (Ù†Ù…Ø§ÛŒØ´ Ù…Ø¬Ø¯Ø¯ ØµÙØ­Ù‡â€ŒØ§ÛŒ Ú©Ù‡ Ù‚Ø¨Ù„ Ø§Ø² Ø¨Ø§Ø² Ø´Ø¯Ù† Ù…ÙˆØ¯Ø§Ù„ ÙØ¹Ø§Ù„ Ø¨ÙˆØ¯)
      if (pageBeforeActivitiesMenu) {
          const previouslyVisiblePage = document.getElementById(pageBeforeActivitiesMenu);
          if (previouslyVisiblePage) {
              // Ensure it uses the correct display style (Ø§Ø·Ù…ÛŒÙ†Ø§Ù† Ø§Ø² Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² Ø§Ø³ØªØ§ÛŒÙ„ Ù†Ù…Ø§ÛŒØ´ ØµØ­ÛŒØ­)
              if (pageBeforeActivitiesMenu === 'start-screen' || pageBeforeActivitiesMenu === 'dashboard') {
                  previouslyVisiblePage.style.display = 'flex';
              } else {
                  previouslyVisiblePage.style.display = 'block';
              }
              console.log(`[hideActivitiesMenu] Re-shown page ${pageBeforeActivitiesMenu} with display: ${previouslyVisiblePage.style.display}`);
              // Important: Re-set activeMainPageId to the page we returned to (Ù…Ù‡Ù…: activeMainPageId Ø±Ø§ Ø¨Ù‡ ØµÙØ­Ù‡â€ŒØ§ÛŒ Ú©Ù‡ Ø¨Ø§Ø²Ú¯Ø´ØªÛŒÙ…ØŒ Ù…Ø¬Ø¯Ø¯Ø§Ù‹ ØªÙ†Ø¸ÛŒÙ… Ú©Ù†ÛŒØ¯)
              activeMainPageId = pageBeforeActivitiesMenu;
              console.log(`[hideActivitiesMenu] activeMainPageId reset to ${activeMainPageId}`);
          } else {
              console.error(`[hideActivitiesMenu] Page to re-show not found: ${pageBeforeActivitiesMenu}`);
          }
      } else {
          console.log('[hideActivitiesMenu] No page to re-show (pageBeforeActivitiesMenu is empty).');
      }
    }

    // Update UI (Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø±Ø§Ø¨Ø· Ú©Ø§Ø±Ø¨Ø±ÛŒ)
    function updateUI() {
      // Update Combined Header (Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ù‡Ø¯Ø± ÛŒÚ©Ù¾Ø§Ø±Ú†Ù‡)
      document.getElementById('dashboard-char-name').textContent = gameState.name;
      // Only display age (ÙÙ‚Ø· Ø³Ù† Ø±Ø§ Ù†Ù…Ø§ÛŒØ´ Ø¯Ù‡ÛŒØ¯)
      document.getElementById('dashboard-char-age').textContent = `Ø³Ù†: ${gameState.age} Ø³Ø§Ù„Ù‡`; 
      document.getElementById('dashboard-char-money').textContent = `Ù¾ÙˆÙ„: ${gameState.money.toLocaleString('fa-IR')} ØªÙˆÙ…Ø§Ù†`;
      document.getElementById('dashboard-char-job').textContent = `Ø´ØºÙ„: ${gameState.job.title === 'Ø¨ÛŒÚ©Ø§Ø±' && gameState.age < 18 ? 'Ù…Ø­ØµÙ„' : gameState.job.title}`;
      
      // Status Bars (Ù†ÙˆØ§Ø±Ù‡Ø§ÛŒ ÙˆØ¶Ø¹ÛŒØª)
      const updateStatusBar = (id, value) => {
        document.getElementById(`${id}-value`).textContent = `${value}%`;
        document.getElementById(`${id}-bar`).style.width = `${value}%`;
      };
      updateStatusBar('happiness', gameState.happiness);
      updateStatusBar('health', gameState.health);
      updateStatusBar('smarts', gameState.smarts);
      updateStatusBar('looks', gameState.looks);
      updateStatusBar('spirituality', gameState.spirituality);

      // Character Page (ØµÙØ­Ù‡ Ø´Ø®ØµÛŒØª)
      document.getElementById('char-name').textContent = gameState.name;
      document.getElementById('char-gender').textContent = gameState.gender === 'male' ? 'Ù…Ø±Ø¯' : 'Ø²Ù†';
      document.getElementById('char-province').textContent = document.querySelector(`#province-select option[value="${gameState.province}"]`)?.textContent || 'Ù†Ø§Ù…Ø´Ø®Øµ';
      document.getElementById('char-family').textContent = document.querySelector(`#family-status option[value="${gameState.familyStatus}"]`)?.textContent || 'Ù†Ø§Ù…Ø´Ø®Øµ';
      document.getElementById('char-age').textContent = gameState.age;
      document.getElementById('char-smarts').textContent = gameState.smarts;
      document.getElementById('char-looks').textContent = gameState.looks;
      document.getElementById('char-spirituality').textContent = gameState.spirituality;
      
      const familyList = document.getElementById('family-list');
      familyList.innerHTML = gameState.relationships.map(r => `<li>${r.name} (${r.role}) - Ø±Ø§Ø¨Ø·Ù‡: ${r.relationship}%</li>`).join('');

      // Update Dashboard Life Log (Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ú¯Ø²Ø§Ø±Ø´ Ø²Ù†Ø¯Ú¯ÛŒ Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯)
      updateLifeLogOnDashboard();

      // Log Pages (ØµÙØ­Ø§Øª ØªØ§Ø±ÛŒØ®Ú†Ù‡) - This remains separate for the full log page
      filterLog('all'); // Always show all logs by default on update (Ù‡Ù…ÛŒØ´Ù‡ Ù‡Ù…Ù‡ Ú¯Ø²Ø§Ø±Ø´â€ŒÙ‡Ø§ Ø±Ø§ Ø¨Ù‡â€ŒØ·ÙˆØ± Ù¾ÛŒØ´â€ŒÙØ±Ø¶ Ø¯Ø± Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ù†Ù…Ø§ÛŒØ´ Ø¯Ù‡ÛŒØ¯)

      // Education Page (ØµÙØ­Ù‡ ØªØ­ØµÛŒÙ„Ø§Øª)
      const currentEducationTab = document.querySelector('#education-page .btn-primary')?.id;
      if (currentEducationTab === 'university-tab') {
        showUniversity();
      } else {
        showSchool(); // Default to school (Ù¾ÛŒØ´â€ŒÙØ±Ø¶ Ø¨Ù‡ Ù…Ø¯Ø±Ø³Ù‡)
      }

      // Job Page (ØµÙØ­Ù‡ Ø´ØºÙ„)
      const currentJobTab = document.querySelector('#job-page .btn-primary')?.id;
      if (currentJobTab === 'career-progress-tab') {
        showCareerProgress();
      } else {
        showJobList(); // Default to job list (Ù¾ÛŒØ´â€ŒÙØ±Ø¶ Ø¨Ù‡ Ù„ÛŒØ³Øª Ù…Ø´Ø§ØºÙ„)
      }

      // Relationships Page (ØµÙØ­Ù‡ Ø±ÙˆØ§Ø¨Ø·)
      const relList = document.getElementById('relationships-list');
      relList.innerHTML = gameState.relationships.map(r => `
        <div class="glass-card p-4">
          <p><strong>${r.name}</strong> (${r.role})</p>
          <p>Ø±Ø§Ø¨Ø·Ù‡: ${r.relationship}%</p>
          <div class="flex space-x-2 mt-2 flex-wrap gap-2">
            <button class="btn-primary px-2 py-1 rounded-lg" onclick="window.interact('${r.id}', 'talk')">ØµØ­Ø¨Øª</button>
            <button class="btn-primary px-2 py-1 rounded-lg" onclick="window.interact('${r.id}', 'gift')">Ù‡Ø¯ÛŒÙ‡</button>
            <button class="btn-secondary px-2 py-1 rounded-lg" onclick="window.interact('${r.id}', 'argue')">Ø¯Ø¹ÙˆØ§</button>
          </div>
        </div>
      `).join('');

      const romanticRelList = document.getElementById('romantic-relationships');
      romanticRelList.innerHTML = gameState.romanticRelationships.map(r => `
        <div class="glass-card p-4">
          <p><strong>${r.name}</strong> (${r.role})</p>
          <p>Ø±Ø§Ø¨Ø·Ù‡: ${r.relationship}%</p>
          ${r.isMarried ? `<p class="text-emerald-400">ğŸ’ Ù…ØªØ§Ù‡Ù„</p>` : ''}
          <div class="flex space-x-2 mt-2 flex-wrap gap-2">
            <button class="btn-primary px-2 py-1 rounded-lg" onclick="window.interactRomantic('${r.id}', 'talk')">ØµØ­Ø¨Øª</button>
            <button class="btn-primary px-2 py-1 rounded-lg" onclick="window.interactRomantic('${r.id}', 'date')">Ù‚Ø±Ø§Ø±</button>
            ${!r.isMarried ? `<button class="btn-primary px-2 py-1 rounded-lg" onclick="window.proposeMarriage('${r.id}')">Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯ Ø§Ø²Ø¯ÙˆØ§Ø¬</button>` : ''}
            ${r.isMarried ? `<button class="btn-primary px-2 py-1 rounded-lg" onclick="window.tryForBaby('${r.id}')">Ø¨Ú†Ù‡â€ŒØ¯Ø§Ø± Ø´Ø¯Ù†</button>` : ''}
            <button class="btn-secondary px-2 py-1 rounded-lg" onclick="window.breakup('${r.id}')">Ú©Ø§Øª Ú©Ø±Ø¯Ù†</button>
          </div>
        </div>
      `).join('') || '<p>Ù‡Ù†ÙˆØ² Ù‡ÛŒÚ† Ø´Ø±ÛŒÚ© Ø¹Ø§Ø·ÙÛŒ Ù†Ø¯Ø§Ø±ÛŒØ¯.</p>';

      const childrenList = document.getElementById('children-list');
      if (childrenList) { // Check if element exists (Ø¨Ø±Ø±Ø³ÛŒ ÙˆØ¬ÙˆØ¯ Ø¹Ù†ØµØ±)
        childrenList.innerHTML = gameState.children.map(child => `
          <div class="glass-card p-4">
            <p><strong>${child.name}</strong> (Ø³Ù†: ${child.age})</p>
            <p>Ø±Ø§Ø¨Ø·Ù‡: ${child.relationship}%</p>
          </div>
        `).join('') || '<p>Ù‡Ù†ÙˆØ² ÙØ±Ø²Ù†Ø¯ÛŒ Ù†Ø¯Ø§Ø±ÛŒØ¯.</p>';
      }


      // Health Page (ØµÙØ­Ù‡ Ø³Ù„Ø§Ù…Øª)
      document.getElementById('health-status').textContent = gameState.health + '%';
      const illnessList = document.getElementById('illness-list');
      illnessList.innerHTML = gameState.illnesses.length ? 
        gameState.illnesses.map(ill => `<li>${ill.name} (Ø´Ø¯Øª: ${ill.severity})</li>`).join('') : 
        '<li>Ø³Ø§Ù„Ù… Ù‡Ø³ØªÛŒØ¯.</li>';
      document.getElementById('illnesses').textContent = gameState.illnesses.length ? gameState.illnesses.map(ill => ill.name).join(', ') : 'Ø³Ø§Ù„Ù…';


      // Finance Page (ØµÙØ­Ù‡ Ù…Ø§Ù„ÛŒ)
      document.getElementById('net-worth').textContent = `${gameState.money.toLocaleString('fa-IR')} ØªÙˆÙ…Ø§Ù†`;
      // updateFinanceChart() is now called only when finance page is shown
      // Current loans list (Ù„ÛŒØ³Øª ÙˆØ§Ù…â€ŒÙ‡Ø§ÛŒ ÙØ¹Ù„ÛŒ)
      document.getElementById('current-loans').innerHTML = gameState.loans.map(loan => `
        <li>ÙˆØ§Ù… ${loan.amount.toLocaleString('fa-IR')} ØªÙˆÙ…Ø§Ù† (Ø¨Ø§Ù‚ÛŒâ€ŒÙ…Ø§Ù†Ø¯Ù‡: ${loan.remaining.toLocaleString('fa-IR')} ØªÙˆÙ…Ø§Ù†) <button class="btn-primary px-2 py-1 rounded-lg text-xs ml-2" onclick="window.payLoan('${loan.id}')">Ù¾Ø±Ø¯Ø§Ø®Øª</button></li>
      `).join('');
    
      // Investment Page Summary (Ø®Ù„Ø§ØµÙ‡ ØµÙØ­Ù‡ Ø³Ø±Ù…Ø§ÛŒÙ‡â€ŒÚ¯Ø°Ø§Ø±ÛŒ)
      const currentInvestmentsSummary = document.getElementById('current-investments-summary');
      if (currentInvestmentsSummary) { // Check if element exists (Ø¨Ø±Ø±Ø³ÛŒ ÙˆØ¬ÙˆØ¯ Ø¹Ù†ØµØ±)
        currentInvestmentsSummary.innerHTML = gameState.investments.map(inv => `
          <li>${inv.emoji} ${inv.name} - ${inv.value.toLocaleString('fa-IR')} ØªÙˆÙ…Ø§Ù† (Ø¨Ø§Ø²Ø¯Ù‡: ${(inv.growth * 100).toFixed(1)}%)</li>
        `).join('') || '<p class="text-gray-400">Ù‡Ù†ÙˆØ² Ù‡ÛŒÚ† Ø³Ø±Ù…Ø§ÛŒÙ‡â€ŒÚ¯Ø°Ø§Ø±ÛŒ Ù†Ø¯Ø§Ø±ÛŒØ¯.</p>';
      }
    }

    // Age Up (ÛŒÚ© Ø³Ø§Ù„ Ø¨Ø²Ø±Ú¯â€ŒØªØ± Ø´Ø¯Ù†)
    async function ageUp() {
      gameState.age++;
      gameState.year++;

      // Base stat changes (ØªØºÛŒÛŒØ±Ø§Øª Ù¾Ø§ÛŒÙ‡ Ø¢Ù…Ø§Ø±)
      gameState.happiness = Math.max(0, Math.min(100, gameState.happiness - 5 + Math.floor(Math.random() * 10)));
      gameState.health = Math.max(0, Math.min(100, gameState.health - 3 + Math.floor(Math.random() * 6)));
      gameState.smarts = Math.min(100, gameState.smarts + (gameState.education.level !== 'Ù‡ÛŒÚ†' ? 2 : 0));
      gameState.looks = Math.max(0, Math.min(100, gameState.looks - 2 + Math.floor(Math.random() * 4)));
      gameState.spirituality = Math.min(100, gameState.spirituality + Math.floor(Math.random() * 5));
      
      // Health decay based on age (Ú©Ø§Ù‡Ø´ Ø³Ù„Ø§Ù…Øª Ø¨Ø± Ø§Ø³Ø§Ø³ Ø³Ù†)
      if (gameState.age > 40) gameState.health = Math.max(0, gameState.health - 2);
      if (gameState.age > 60) gameState.health = Math.max(0, gameState.health - 5);

      // Job salary (Ø­Ù‚ÙˆÙ‚ Ø´ØºÙ„)
      if (gameState.job.title !== 'Ø¨ÛŒÚ©Ø§Ø±') {
        gameState.money += gameState.job.salary;
        gameState.job.experience += 1; // Gain experience (ØªØ¬Ø±Ø¨Ù‡ Ú©Ø³Ø¨ Ù…ÛŒâ€ŒÚ©Ù†Ø¯)
        gameState.log.push({ year: gameState.year, event: `Ø­Ù‚ÙˆÙ‚ Ù…Ø§Ù‡Ø§Ù†Ù‡ Ø®ÙˆØ¯ Ø±Ø§ Ø§Ø² Ø´ØºÙ„ ${gameState.job.title} Ø¯Ø±ÛŒØ§ÙØª Ú©Ø±Ø¯ÛŒØ¯. (${gameState.job.salary.toLocaleString('fa-IR')} ØªÙˆÙ…Ø§Ù†)`, type: 'finance' });
      }

      // Education progress (Ù¾ÛŒØ´Ø±ÙØª ØªØ­ØµÛŒÙ„ÛŒ)
      if (gameState.education.level === 'Ø¯Ø§Ù†Ø´Ú¯Ø§Ù‡') {
          gameState.education.degreeProgress += 10 + Math.floor(Math.random() * 10); // 10-20% progress per year (Û±Û°-Û²Û°Ùª Ù¾ÛŒØ´Ø±ÙØª Ø¯Ø± Ø³Ø§Ù„)
          if (gameState.education.degreeProgress >= 100) {
              gameState.education.degreeProgress = 100;
              gameState.education.level = `ÙØ§Ø±Øºâ€ŒØ§Ù„ØªØ­ØµÛŒÙ„ ${gameState.education.major}`;
              gameState.log.push({ year: gameState.year, event: `Ø´Ù…Ø§ Ø§Ø² Ø¯Ø§Ù†Ø´Ú¯Ø§Ù‡ Ø¯Ø± Ø±Ø´ØªÙ‡ ${gameState.education.major} ÙØ§Ø±Øºâ€ŒØ§Ù„ØªØ­ØµÛŒÙ„ Ø´Ø¯ÛŒØ¯!`, type: 'education' });
              showMessageModal(`ØªØ¨Ø±ÛŒÚ©! Ø´Ù…Ø§ Ø§Ø² Ø¯Ø§Ù†Ø´Ú¯Ø§Ù‡ Ø¯Ø± Ø±Ø´ØªÙ‡ ${gameState.education.major} ÙØ§Ø±Øºâ€ŒØ§Ù„ØªØ­ØµÛŒÙ„ Ø´Ø¯ÛŒØ¯.`);
          } else {
              gameState.log.push({ year: gameState.year, event: `Ø´Ù…Ø§ Ø¯Ø± Ø­Ø§Ù„ ØªØ­ØµÛŒÙ„ Ø¯Ø± Ø±Ø´ØªÙ‡ ${gameState.education.major} Ù‡Ø³ØªÛŒØ¯. (${gameState.education.degreeProgress}% Ù¾ÛŒØ´Ø±ÙØª)`, type: 'education' });
          }
      }

      // Investment growth (Ø±Ø´Ø¯ Ø³Ø±Ù…Ø§ÛŒÙ‡â€ŒÚ¯Ø°Ø§Ø±ÛŒ)
      gameState.investments.forEach(inv => {
        // Apply volatility to growth rate (Ø§Ø¹Ù…Ø§Ù„ Ù†ÙˆØ³Ø§Ù†Ø§Øª Ø¨Ø± Ù†Ø±Ø® Ø±Ø´Ø¯)
        const volatilityFactor = (Math.random() * 2 - 1) * 0.1; // -0.1 to +0.1
        const actualGrowthRate = inv.growth + volatilityFactor;
        const growthAmount = inv.value * actualGrowthRate;
        inv.value = Math.max(0, inv.value + growthAmount); // Value cannot go below zero (Ø§Ø±Ø²Ø´ Ù†Ù…ÛŒâ€ŒØªÙˆØ§Ù†Ø¯ Ú©Ù…ØªØ± Ø§Ø² ØµÙØ± Ø´ÙˆØ¯)
        
        // Log positive or negative growth (Ø«Ø¨Øª Ø±Ø´Ø¯ Ù…Ø«Ø¨Øª ÛŒØ§ Ù…Ù†ÙÛŒ)
        if (growthAmount >= 0) {
            gameState.log.push({ year: gameState.year, event: `Ø³Ø±Ù…Ø§ÛŒÙ‡â€ŒÚ¯Ø°Ø§Ø±ÛŒ Ø´Ù…Ø§ Ø¯Ø± ${inv.name} Ø¨Ù‡ Ù…Ø¨Ù„Øº ${growthAmount.toLocaleString('fa-IR')} ØªÙˆÙ…Ø§Ù† Ø³ÙˆØ¯ Ú©Ø±Ø¯. (Ø§Ø±Ø²Ø´ ÙØ¹Ù„ÛŒ: ${inv.value.toLocaleString('fa-IR')} ØªÙˆÙ…Ø§Ù†)`, type: 'finance' });
        } else {
            gameState.log.push({ year: gameState.year, event: `Ø³Ø±Ù…Ø§ÛŒÙ‡â€ŒÚ¯Ø°Ø§Ø±ÛŒ Ø´Ù…Ø§ Ø¯Ø± ${inv.name} Ø¨Ù‡ Ù…Ø¨Ù„Øº ${Math.abs(growthAmount).toLocaleString('fa-IR')} ØªÙˆÙ…Ø§Ù† Ø¶Ø±Ø± Ú©Ø±Ø¯. (Ø§Ø±Ø²Ø´ ÙØ¹Ù„ÛŒ: ${inv.value.toLocaleString('fa-IR')} ØªÙˆÙ…Ø§Ù†)`, type: 'finance' });
        }
      });


      // Loan payments (Ù¾Ø±Ø¯Ø§Ø®Øª ÙˆØ§Ù…)
      gameState.loans = gameState.loans.filter(loan => {
        const payment = Math.min(loan.remaining, loan.amount * 0.1); // Pay 10% of original amount or remaining (Ù¾Ø±Ø¯Ø§Ø®Øª Û±Û°Ùª Ø§Ø² Ù…Ø¨Ù„Øº Ø§ØµÙ„ÛŒ ÛŒØ§ Ø¨Ø§Ù‚ÛŒâ€ŒÙ…Ø§Ù†Ø¯Ù‡)
        if (gameState.money < payment) {
          gameState.health = Math.max(0, gameState.health - 5); // Penalty for not affording loan (Ø¬Ø±ÛŒÙ…Ù‡ Ø¹Ø¯Ù… ØªÙˆØ§Ù†Ø§ÛŒÛŒ Ù¾Ø±Ø¯Ø§Ø®Øª ÙˆØ§Ù…)
          gameState.log.push({ year: gameState.year, event: `Ù†ØªÙˆØ§Ù†Ø³ØªÛŒØ¯ Ù‚Ø³Ø· ÙˆØ§Ù… Ø®ÙˆØ¯ Ø±Ø§ Ù¾Ø±Ø¯Ø§Ø®Øª Ú©Ù†ÛŒØ¯! Ø³Ù„Ø§Ù…Øª Ø´Ù…Ø§ Ú©Ø§Ù‡Ø´ ÛŒØ§ÙØª.`, type: 'finance' });
          return true; // Keep loan (ÙˆØ§Ù… Ø±Ø§ Ù†Ú¯Ù‡ Ø¯Ø§Ø±ÛŒØ¯)
        }
        gameState.money -= payment;
        loan.remaining -= payment;
        gameState.log.push({ year: gameState.year, event: `Ù‚Ø³Ø· ÙˆØ§Ù… Ø®ÙˆØ¯ Ø±Ø§ Ø¨Ù‡ Ù…Ø¨Ù„Øº ${payment.toLocaleString('fa-IR')} ØªÙˆÙ…Ø§Ù† Ù¾Ø±Ø¯Ø§Ø®Øª Ú©Ø±Ø¯ÛŒØ¯.`, type: 'finance' });
        return loan.remaining > 0; // Remove if fully paid (Ø§Ú¯Ø± Ú©Ø§Ù…Ù„ Ù¾Ø±Ø¯Ø§Ø®Øª Ø´Ø¯ØŒ Ø­Ø°Ù Ú©Ù†ÛŒØ¯)
      });

      // Update children's age (Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø³Ù† ÙØ±Ø²Ù†Ø¯Ø§Ù†)
      gameState.children.forEach(child => {
        child.age++;
        child.relationship = Math.min(100, child.relationship + Math.floor(Math.random() * 5)); // Slight improvement (Ø¨Ù‡Ø¨ÙˆØ¯ Ø¬Ø²Ø¦ÛŒ)
      });

      // Random events (Ø±ÙˆÛŒØ¯Ø§Ø¯Ù‡Ø§ÛŒ ØªØµØ§Ø¯ÙÛŒ)
      const events = [
        { event: 'Ø´Ù…Ø§ ÛŒÚ© Ø³Ø§Ù„ Ø¨Ø²Ø±Ú¯â€ŒØªØ± Ø´Ø¯ÛŒØ¯!', type: 'general' },
        { event: 'Ø¨Ù‡ ÛŒÚ© Ø¹Ø±ÙˆØ³ÛŒ Ø¯Ø¹ÙˆØª Ø´Ø¯ÛŒØ¯!', type: 'family', effect: () => gameState.happiness = Math.min(100, gameState.happiness + 10) },
        { event: 'ÛŒÚ© Ø¨ÛŒÙ…Ø§Ø±ÛŒ Ø®ÙÛŒÙ Ú¯Ø±ÙØªÛŒØ¯.', type: 'health', effect: () => { gameState.health = Math.max(0, gameState.health - 10); gameState.illnesses.push({ name: 'Ø³Ø±Ù…Ø§Ø®ÙˆØ±Ø¯Ú¯ÛŒ', severity: 'Ø®ÙÛŒÙ' }); } },
        { event: 'ÛŒÚ© Ø¯ÙˆØ³Øª Ø¬Ø¯ÛŒØ¯ Ù¾ÛŒØ¯Ø§ Ú©Ø±Ø¯ÛŒØ¯!', type: 'family', effect: () => gameState.relationships.push({ id: crypto.randomUUID(), name: 'Ø¯ÙˆØ³Øª Ø¬Ø¯ÛŒØ¯', role: 'Ø¯ÙˆØ³Øª', relationship: 50, respect: 50, happiness: 50 }) },
        { event: 'ÛŒÚ© Ø¬Ø§ÛŒØ²Ù‡ Ú©ÙˆÚ†Ú© Ø¨Ø±Ø¯ÛŒØ¯!', type: 'finance', effect: () => gameState.money += 100000 },
        { event: 'Ø¯Ø± ØªØ±Ø§ÙÛŒÚ© Ú¯ÛŒØ± Ú©Ø±Ø¯ÛŒØ¯ Ùˆ Ø¯ÛŒØ±ØªØ§Ù† Ø´Ø¯.', type: 'general', effect: () => gameState.happiness = Math.max(0, gameState.happiness - 5) },
        { event: 'ÛŒÚ© Ú©ØªØ§Ø¨ Ø¬Ø¯ÛŒØ¯ Ø®ÙˆØ§Ù†Ø¯ÛŒØ¯ Ùˆ Ù‡ÙˆØ´ Ø´Ù…Ø§ Ø§ÙØ²Ø§ÛŒØ´ ÛŒØ§ÙØª.', type: 'education', effect: () => gameState.smarts = Math.min(100, gameState.smarts + 3) },
        { event: 'Ù…Ø¯ØªÛŒ Ø±Ø§ Ø¯Ø± Ø·Ø¨ÛŒØ¹Øª Ú¯Ø°Ø±Ø§Ù†Ø¯ÛŒØ¯ Ùˆ Ù…Ø¹Ù†ÙˆÛŒØª Ø´Ù…Ø§ Ø§ÙØ²Ø§ÛŒØ´ ÛŒØ§ÙØª.', type: 'spirituality', effect: () => gameState.spirituality = Math.min(100, gameState.spirituality + 5) },
        { event: 'ÛŒÚ© ÙˆØ³ÛŒÙ„Ù‡ Ø§Ù„Ú©ØªØ±ÙˆÙ†ÛŒÚ©ÛŒ Ø´Ù…Ø§ Ø®Ø±Ø§Ø¨ Ø´Ø¯ Ùˆ Ù‡Ø²ÛŒÙ†Ù‡ ØªØ¹Ù…ÛŒØ± Ø¯Ø§Ø´ØªÛŒØ¯.', type: 'finance', effect: () => gameState.money = Math.max(0, gameState.money - 50000) },
        { event: 'Ø¯Ø± Ù…Ø­Ù„ Ú©Ø§Ø± Ø¨Ø§ Ù‡Ù…Ú©Ø§Ø±Ø§Ù†ØªØ§Ù† Ø¨Ù‡ Ù…Ø´Ú©Ù„ Ø®ÙˆØ±Ø¯ÛŒØ¯.', type: 'career', effect: () => gameState.happiness = Math.max(0, gameState.happiness - 8) },
        { event: 'ÛŒÚ© Ø¯ÙˆØ±Ù‡ Ø¢Ù…ÙˆØ²Ø´ÛŒ Ø¢Ù†Ù„Ø§ÛŒÙ† Ú¯Ø°Ø±Ø§Ù†Ø¯ÛŒØ¯ Ùˆ Ù…Ù‡Ø§Ø±Øªâ€ŒÙ‡Ø§ÛŒØªØ§Ù† Ø¨Ù‡Ø¨ÙˆØ¯ ÛŒØ§ÙØª.', type: 'education', effect: () => gameState.smarts = Math.min(100, gameState.smarts + 7) },
        { event: 'Ø¨Ù‡ ÛŒÚ© Ø³ÙØ± Ú©ÙˆØªØ§Ù‡ Ø±ÙØªÛŒØ¯.', type: 'general', effect: () => gameState.happiness = Math.min(100, gameState.happiness + 15) },
      ];
      const randomEvent = events[Math.floor(Math.random() * events.length)];
      gameState.log.push({ year: gameState.year, event: randomEvent.event, type: randomEvent.type });
      if (randomEvent.effect) randomEvent.effect();

      // Add current money to finance history (Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ù¾ÙˆÙ„ ÙØ¹Ù„ÛŒ Ø¨Ù‡ ØªØ§Ø±ÛŒØ®Ú†Ù‡ Ù…Ø§Ù„ÛŒ)
      gameState.financeHistory.push({ year: gameState.year, money: gameState.money });

      updateUI();
      saveGame();
    }

    // Education (ØªØ­ØµÛŒÙ„Ø§Øª)
    function showSchool() {
      const content = document.getElementById('education-content');
      let schoolOptions = '';
      if (gameState.age < 6) {
        schoolOptions = '<p>Ø´Ù…Ø§ Ø¨Ø±Ø§ÛŒ Ø´Ø±ÙˆØ¹ ØªØ­ØµÛŒÙ„ Ø®ÛŒÙ„ÛŒ Ú©ÙˆÚ†Ú© Ù‡Ø³ØªÛŒØ¯.</p>';
      } else if (gameState.age < 12) {
        schoolOptions = `
          <p>ÙˆØ¶Ø¹ÛŒØª ØªØ­ØµÛŒÙ„ÛŒ: Ø¯Ø¨Ø³ØªØ§Ù† (${gameState.education.level === 'Ø¯Ø¨Ø³ØªØ§Ù†' ? 'Ø¯Ø± Ø­Ø§Ù„ ØªØ­ØµÛŒÙ„' : 'ÙØ§Ø±Øºâ€ŒØ§Ù„ØªØ­ØµÛŒÙ„'})</p>
          <button class="btn-primary px-4 py-2 rounded-lg mt-2" onclick="window.study('primary')">Ø¯Ø±Ø³ Ø¨Ø®ÙˆØ§Ù†ÛŒØ¯</button>
        `;
      } else if (gameState.age < 15) {
        schoolOptions = `
          <p>ÙˆØ¶Ø¹ÛŒØª ØªØ­ØµÛŒÙ„ÛŒ: Ø±Ø§Ù‡Ù†Ù…Ø§ÛŒÛŒ (${gameState.education.level === 'Ø±Ø§Ù‡Ù†Ù…Ø§ÛŒÛŒ' ? 'Ø¯Ø± Ø­Ø§Ù„ ØªØ­ØµÛŒÙ„' : 'ÙØ§Ø±Øºâ€ŒØ§Ù„ØªØ­ØµÛŒÙ„'})</p>
          <button class="btn-primary px-4 py-2 rounded-lg mt-2" onclick="window.study('middle')">Ø¯Ø±Ø³ Ø¨Ø®ÙˆØ§Ù†ÛŒØ¯</button>
        `;
      } else if (gameState.age < 18) {
        schoolOptions = `
          <p>ÙˆØ¶Ø¹ÛŒØª ØªØ­ØµÛŒÙ„ÛŒ: Ø¯Ø¨ÛŒØ±Ø³ØªØ§Ù† (${gameState.education.level === 'Ø¯Ø¨ÛŒØ±Ø³ØªØ§Ù†' ? 'Ø¯Ø± Ø­Ø§Ù„ ØªØ­ØµÛŒÙ„' : 'ÙØ§Ø±Øºâ€ŒØ§Ù„ØªØ­ØµÛŒÙ„'})</p>
          <button class="btn-primary px-4 py-2 rounded-lg mt-2" onclick="window.study('high')">Ø¯Ø±Ø³ Ø¨Ø®ÙˆØ§Ù†ÛŒØ¯</button>
        `;
      } else {
        schoolOptions = `
          <p>Ø´Ù…Ø§ ØªØ­ØµÛŒÙ„Ø§Øª Ù…Ø¯Ø±Ø³Ù‡ Ø±Ø§ Ø¨Ù‡ Ù¾Ø§ÛŒØ§Ù† Ø±Ø³Ø§Ù†Ø¯Ù‡â€ŒØ§ÛŒØ¯.</p>
          <button class="btn-primary px-4 py-2 rounded-lg mt-2" onclick="window.study('general')">Ù…Ø·Ø§Ù„Ø¹Ù‡ Ø¢Ø²Ø§Ø¯</button>
        `;
      }
      content.innerHTML = schoolOptions;

      document.getElementById('school-tab').classList.add('btn-primary');
      document.getElementById('school-tab').classList.remove('btn-secondary');
      document.getElementById('university-tab').classList.add('btn-secondary');
      document.getElementById('university-tab').classList.remove('btn-primary');
    }

    function showUniversity() {
      const content = document.getElementById('education-content');
      if (gameState.age < 18 || gameState.education.level !== 'Ø¯Ø¨ÛŒØ±Ø³ØªØ§Ù†') {
        content.innerHTML = '<p>Ø¨Ø±Ø§ÛŒ ÙˆØ±ÙˆØ¯ Ø¨Ù‡ Ø¯Ø§Ù†Ø´Ú¯Ø§Ù‡ Ø¨Ø§ÛŒØ¯ Ø­Ø¯Ø§Ù‚Ù„ Û±Û¸ Ø³Ø§Ù„ Ø¯Ø§Ø´ØªÙ‡ Ø¨Ø§Ø´ÛŒØ¯ Ùˆ Ø¯Ø¨ÛŒØ±Ø³ØªØ§Ù† Ø±Ø§ ØªÙ…Ø§Ù… Ú©Ø±Ø¯Ù‡ Ø¨Ø§Ø´ÛŒØ¯.</p>';
      } else {
        content.innerHTML = `
          <p>ÙˆØ¶Ø¹ÛŒØª ØªØ­ØµÛŒÙ„ÛŒ: ${gameState.education.major ? `Ø¯Ø§Ù†Ø´Ø¬Ùˆ (${gameState.education.major} - ${gameState.education.degreeProgress}% Ù¾ÛŒØ´Ø±ÙØª)` : 'Ø¢Ù…Ø§Ø¯Ù‡ Ø¨Ø±Ø§ÛŒ Ø§Ù†ØªØ®Ø§Ø¨ Ø±Ø´ØªÙ‡'}</p>
          <p>Ø§Ù†ØªØ®Ø§Ø¨ Ø±Ø´ØªÙ‡:</p>
          <select id="major-select" class="w-full p-2 bg-gray-800 rounded-lg mb-4">
            <option value="Ù¾Ø²Ø´Ú©ÛŒ">Ù¾Ø²Ø´Ú©ÛŒ (Ù†ÛŒØ§Ø² Ø¨Ù‡ Ù‡ÙˆØ´ Ø¨Ø§Ù„Ø§)</option>
            <option value="Ù…Ù‡Ù†Ø¯Ø³ÛŒ">Ù…Ù‡Ù†Ø¯Ø³ÛŒ (Ù†ÛŒØ§Ø² Ø¨Ù‡ Ù‡ÙˆØ´ Ù…ØªÙˆØ³Ø·)</option>
            <option value="Ø­Ù‚ÙˆÙ‚">Ø­Ù‚ÙˆÙ‚ (Ù†ÛŒØ§Ø² Ø¨Ù‡ Ù‡ÙˆØ´ Ù…ØªÙˆØ³Ø·)</option>
            <option value="Ù‡Ù†Ø±">Ù‡Ù†Ø± (Ù†ÛŒØ§Ø² Ø¨Ù‡ Ø¸Ø§Ù‡Ø± Ùˆ Ø´Ø§Ø¯ÛŒ)</option>
            <option value="Ù…Ø¯ÛŒØ±ÛŒØª">Ù…Ø¯ÛŒØ±ÛŒØª</option>
          </select>
          <button class="btn-primary px-4 py-2 rounded-lg" onclick="window.applyUniversity()">Ø«Ø¨Øªâ€ŒÙ†Ø§Ù…/Ø§Ø¯Ø§Ù…Ù‡ ØªØ­ØµÛŒÙ„</button>
          ${gameState.education.level === 'Ø¯Ø§Ù†Ø´Ú¯Ø§Ù‡' ? `<button class="btn-secondary px-4 py-2 rounded-lg mt-2 ml-2" onclick="window.dropOut()">Ø§Ù†ØµØ±Ø§Ù Ø§Ø² ØªØ­ØµÛŒÙ„</button>` : ''}
        `;
      }
      document.getElementById('university-tab').classList.add('btn-primary');
      document.getElementById('university-tab').classList.remove('btn-secondary');
      document.getElementById('school-tab').classList.add('btn-secondary');
      document.getElementById('school-tab').classList.remove('btn-primary');
    }

    window.study = function(level) {
      gameState.smarts = Math.min(100, gameState.smarts + 5);
      let logMessage = '';
      if (level === 'primary') {
        gameState.education.level = 'Ø¯Ø¨Ø³ØªØ§Ù†';
        logMessage = 'Ø´Ù…Ø§ Ø¯Ø± Ø¯Ø¨Ø³ØªØ§Ù† Ø¯Ø±Ø³ Ø®ÙˆØ§Ù†Ø¯ÛŒØ¯.';
      } else if (level === 'middle') {
        gameState.education.level = 'Ø±Ø§Ù‡Ù†Ù…Ø§ÛŒÛŒ';
        logMessage = 'Ø´Ù…Ø§ Ø¯Ø± Ø±Ø§Ù‡Ù†Ù…Ø§ÛŒÛŒ Ø¯Ø±Ø³ Ø®ÙˆØ§Ù†Ø¯ÛŒØ¯.';
      } else if (level === 'high') {
        gameState.education.level = 'Ø¯Ø¨ÛŒØ±Ø³ØªØ§Ù†';
        logMessage = 'Ø´Ù…Ø§ Ø¯Ø± Ø¯Ø¨ÛŒØ±Ø³ØªØ§Ù† Ø¯Ø±Ø³ Ø®ÙˆØ§Ù†Ø¯ÛŒØ¯.';
      } else if (level === 'general') {
        logMessage = 'Ø´Ù…Ø§ Ù…Ø·Ø§Ù„Ø¹Ù‡ Ø¢Ø²Ø§Ø¯ Ø¯Ø§Ø´ØªÛŒØ¯ Ùˆ Ù‡ÙˆØ´ Ø´Ù…Ø§ Ø§ÙØ²Ø§ÛŒØ´ ÛŒØ§ÙØª.';
      }
      gameState.log.push({ year: gameState.year, event: logMessage, type: 'education' });
      updateUI();
      saveGame();
    }

    window.applyUniversity = function() {
      if (gameState.age < 18 || gameState.education.level !== 'Ø¯Ø¨ÛŒØ±Ø³ØªØ§Ù†') {
        showMessageModal('Ø¨Ø±Ø§ÛŒ ÙˆØ±ÙˆØ¯ Ø¨Ù‡ Ø¯Ø§Ù†Ø´Ú¯Ø§Ù‡ Ø¨Ø§ÛŒØ¯ Ø­Ø¯Ø§Ù‚Ù„ Û±Û¸ Ø³Ø§Ù„ Ø¯Ø§Ø´ØªÙ‡ Ø¨Ø§Ø´ÛŒØ¯ Ùˆ Ø¯Ø¨ÛŒØ±Ø³ØªØ§Ù† Ø±Ø§ ØªÙ…Ø§Ù… Ú©Ø±Ø¯Ù‡ Ø¨Ø§Ø´ÛŒØ¯.');
        return;
      }
      const selectedMajor = document.getElementById('major-select').value;
      
      // Check requirements for majors (Ø¨Ø±Ø±Ø³ÛŒ Ø§Ù„Ø²Ø§Ù…Ø§Øª Ø¨Ø±Ø§ÛŒ Ø±Ø´ØªÙ‡â€ŒÙ‡Ø§)
      if (selectedMajor === 'Ù¾Ø²Ø´Ú©ÛŒ' && gameState.smarts < 70) {
        showMessageModal('Ù‡ÙˆØ´ Ø´Ù…Ø§ Ø¨Ø±Ø§ÛŒ Ø±Ø´ØªÙ‡ Ù¾Ø²Ø´Ú©ÛŒ Ú©Ø§ÙÛŒ Ù†ÛŒØ³Øª. (Ù†ÛŒØ§Ø² Ø¨Ù‡ Ù‡ÙˆØ´ Û·Û°)');
        return;
      }
      if ((selectedMajor === 'Ù…Ù‡Ù†Ø¯Ø³ÛŒ' || selectedMajor === 'Ø­Ù‚ÙˆÙ‚') && gameState.smarts < 60) {
        showMessageModal('Ù‡ÙˆØ´ Ø´Ù…Ø§ Ø¨Ø±Ø§ÛŒ Ø§ÛŒÙ† Ø±Ø´ØªÙ‡ Ú©Ø§ÙÛŒ Ù†ÛŒØ³Øª. (Ù†ÛŒØ§Ø² Ø¨Ù‡ Ù‡ÙˆØ´ Û¶Û°)');
        return;
      }
      if (selectedMajor === 'Ù‡Ù†Ø±' && (gameState.looks < 50 || gameState.happiness < 50)) {
        showMessageModal('Ø¨Ø±Ø§ÛŒ Ø±Ø´ØªÙ‡ Ù‡Ù†Ø± Ù†ÛŒØ§Ø² Ø¨Ù‡ Ø¸Ø§Ù‡Ø± Ùˆ Ø´Ø§Ø¯ÛŒ Ø¨ÛŒØ´ØªØ±ÛŒ Ø¯Ø§Ø±ÛŒØ¯. (Ù†ÛŒØ§Ø² Ø¨Ù‡ Ø¸Ø§Ù‡Ø± ÛµÛ° Ùˆ Ø´Ø§Ø¯ÛŒ ÛµÛ°)');
        return;
      }

      gameState.education.level = 'Ø¯Ø§Ù†Ø´Ú¯Ø§Ù‡';
      gameState.education.major = selectedMajor;
      gameState.education.degreeProgress = 0; // Reset progress (Ù¾ÛŒØ´Ø±ÙØª Ø±Ø§ Ø¨Ø§Ø²Ù†Ø´Ø§Ù†ÛŒ Ù…ÛŒâ€ŒÚ©Ù†Ø¯)
      gameState.log.push({ year: gameState.year, event: `Ø´Ù…Ø§ Ø¯Ø± Ø±Ø´ØªÙ‡ ${selectedMajor} Ø¯Ø± Ø¯Ø§Ù†Ø´Ú¯Ø§Ù‡ Ø«Ø¨Øªâ€ŒÙ†Ø§Ù… Ú©Ø±Ø¯ÛŒØ¯.`, type: 'education' });
      updateUI();
      saveGame();
    }

    window.dropOut = function() {
        if (gameState.education.level !== 'Ø¯Ø§Ù†Ø´Ú¯Ø§Ù‡') {
            showMessageModal('Ø´Ù…Ø§ Ø¯Ø± Ø­Ø§Ù„ Ø­Ø§Ø¶Ø± Ø¯Ø§Ù†Ø´Ø¬ÙˆÛŒ Ø¯Ø§Ù†Ø´Ú¯Ø§Ù‡ Ù†ÛŒØ³ØªÛŒØ¯.');
            return;
        }
        window.confirm('Ø¢ÛŒØ§ Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ Ú©Ù‡ Ù…ÛŒâ€ŒØ®ÙˆØ§Ù‡ÛŒØ¯ Ø§Ø² Ø¯Ø§Ù†Ø´Ú¯Ø§Ù‡ Ø§Ù†ØµØ±Ø§Ù Ø¯Ù‡ÛŒØ¯ØŸ Ø§ÛŒÙ† Ú©Ø§Ø± Ù…Ù…Ú©Ù† Ø§Ø³Øª Ø¨Ø± Ø¢ÛŒÙ†Ø¯Ù‡ Ø´ØºÙ„ÛŒ Ø´Ù…Ø§ ØªØ£Ø«ÛŒØ± Ø¨Ú¯Ø°Ø§Ø±Ø¯.').then(confirmed => {
            if (confirmed) {
                gameState.education.level = 'ÙØ§Ø±Øºâ€ŒØ§Ù„ØªØ­ØµÛŒÙ„ Ø¯Ø¨ÛŒØ±Ø³ØªØ§Ù†'; // Changed to this to reflect reality (Ø¨Ù‡ Ø§ÛŒÙ† ØªØºÛŒÛŒØ± ÛŒØ§ÙØª ØªØ§ ÙˆØ§Ù‚Ø¹ÛŒØª Ø±Ø§ Ù…Ù†Ø¹Ø§Ú©Ø³ Ú©Ù†Ø¯)
                gameState.education.major = '';
                gameState.education.degreeProgress = 0;
                gameState.log.push({ year: gameState.year, event: 'Ø´Ù…Ø§ Ø§Ø² Ø¯Ø§Ù†Ø´Ú¯Ø§Ù‡ Ø§Ù†ØµØ±Ø§Ù Ø¯Ø§Ø¯ÛŒØ¯.', type: 'education' });
                showMessageModal('Ø´Ù…Ø§ Ø§Ø² Ø¯Ø§Ù†Ø´Ú¯Ø§Ù‡ Ø§Ù†ØµØ±Ø§Ù Ø¯Ø§Ø¯ÛŒØ¯.');
                updateUI();
                saveGame();
            }
        });
    }

    // Jobs (Ø´ØºÙ„â€ŒÙ‡Ø§)
    const availableJobs = [
      { name: 'Ú©Ø§Ø±Ú¯Ø± Ø³Ø§Ø¯Ù‡', salary: 3000000, req: 'none', minAge: 18, smartsReq: 0, looksReq: 0, initialLevel: 1 },
      { name: 'ÙØ±ÙˆØ´Ù†Ø¯Ù‡', salary: 4000000, req: 'none', minAge: 18, smartsReq: 20, looksReq: 40, initialLevel: 1 },
      { name: 'Ù…Ø¹Ù„Ù…', salary: 7000000, req: 'Ø¯Ø§Ù†Ø´Ú¯Ø§Ù‡', majorReq: '', minAge: 22, smartsReq: 60, looksReq: 0, initialLevel: 1 },
      { name: 'Ú©Ø§Ø±Ù…Ù†Ø¯ Ø¯ÙˆÙ„Øª', salary: 6000000, req: 'Ø¯Ø§Ù†Ø´Ú¯Ø§Ù‡', majorReq: '', minAge: 20, smartsReq: 50, looksReq: 0, initialLevel: 1 },
      { name: 'Ø±Ø§Ù†Ù†Ø¯Ù‡ ØªØ§Ú©Ø³ÛŒ', salary: 5000000, req: 'none', minAge: 20, smartsReq: 0, looksReq: 0, initialLevel: 1 },
      { name: 'Ù¾Ø²Ø´Ú© Ø¹Ù…ÙˆÙ…ÛŒ', salary: 25000000, req: 'Ø¯Ø§Ù†Ø´Ú¯Ø§Ù‡', majorReq: 'Ù¾Ø²Ø´Ú©ÛŒ', minAge: 26, smartsReq: 80, looksReq: 0, initialLevel: 1 },
      { name: 'Ù…Ù‡Ù†Ø¯Ø³ Ù†Ø±Ù…â€ŒØ§ÙØ²Ø§Ø±', salary: 20000000, req: 'Ø¯Ø§Ù†Ø´Ú¯Ø§Ù‡', majorReq: 'Ù…Ù‡Ù†Ø¯Ø³ÛŒ', minAge: 24, smartsReq: 75, looksReq: 0, initialLevel: 1 },
      { name: 'ÙˆÚ©ÛŒÙ„ Ù¾Ø§ÛŒÙ‡ ÛŒÚ©', salary: 18000000, req: 'Ø¯Ø§Ù†Ø´Ú¯Ø§Ù‡', majorReq: 'Ø­Ù‚ÙˆÙ‚', minAge: 25, smartsReq: 70, looksReq: 0, initialLevel: 1 },
      { name: 'Ù‡Ù†Ø±Ù…Ù†Ø¯ Ù†Ù‚Ø§Ø´', salary: 5000000, req: 'Ø¯Ø§Ù†Ø´Ú¯Ø§Ù‡', majorReq: 'Ù‡Ù†Ø±', minAge: 20, smartsReq: 30, looksReq: 60, initialLevel: 1 },
      { name: 'Ù…Ø¯ÛŒØ± Ù¾Ø±ÙˆÚ˜Ù‡', salary: 15000000, req: 'Ø¯Ø§Ù†Ø´Ú¯Ø§Ù‡', majorReq: 'Ù…Ø¯ÛŒØ±ÛŒØª', minAge: 28, smartsReq: 65, looksReq: 0, initialLevel: 1 },
    ];

    function showJobList() {
      const content = document.getElementById('job-content');
      content.innerHTML = `
        <p class="mb-4">Ø´ØºÙ„ ÙØ¹Ù„ÛŒ: ${gameState.job.title === 'Ø¨ÛŒÚ©Ø§Ø±' ? 'Ø¨ÛŒÚ©Ø§Ø±' : `${gameState.job.title} (Ø¯Ø±Ø¢Ù…Ø¯ Ù…Ø§Ù‡Ø§Ù†Ù‡: ${gameState.job.salary.toLocaleString('fa-IR')} ØªÙˆÙ…Ø§Ù†)`}</p>
        <div class="space-y-2">
          ${availableJobs.map(job => `
            <div class="glass-card p-4 flex flex-col sm:flex-row justify-between items-center">
              <div>
                <p class="font-semibold">${job.name}</p>
                <p class="text-sm text-gray-400">${job.salary.toLocaleString('fa-IR')} ØªÙˆÙ…Ø§Ù†/Ù…Ø§Ù‡</p>
                <p class="text-xs text-gray-500">Ù†ÛŒØ§Ø²: ${job.req !== 'none' ? `${job.req} ${job.majorReq ? `(${job.majorReq})` : ''}` : 'Ù†Ø¯Ø§Ø±Ø¯'} (Ø³Ù†: ${job.minAge}+)</p>
                <p class="text-xs text-gray-500">Ù‡ÙˆØ´: ${job.smartsReq}+ØŒ Ø¸Ø§Ù‡Ø±: ${job.looksReq}+</p>
              </div>
              <button class="btn-primary px-4 py-2 rounded-lg mt-2 sm:mt-0" onclick="window.applyJob('${job.name}', ${job.salary}, '${job.req}', '${job.majorReq}', ${job.minAge}, ${job.smartsReq}, ${job.looksReq})">Ø¯Ø±Ø®ÙˆØ§Ø³Øª</button>
            </div>
          `).join('')}
        </div>
      `;
      document.getElementById('job-list-tab').classList.add('btn-primary');
      document.getElementById('job-list-tab').classList.remove('btn-secondary');
      document.getElementById('career-progress-tab').classList.add('btn-secondary');
      document.getElementById('career-progress-tab').classList.remove('btn-primary');
    }

    function showCareerProgress() {
      const content = document.getElementById('job-content');
      content.innerHTML = `
        <p>Ø´ØºÙ„ ÙØ¹Ù„ÛŒ: ${gameState.job.title}</p>
        <p>Ø¯Ø±Ø¢Ù…Ø¯ Ù…Ø§Ù‡Ø§Ù†Ù‡: ${gameState.job.salary.toLocaleString('fa-IR')} ØªÙˆÙ…Ø§Ù†</p>
        <p>Ø³Ø·Ø­ Ø´ØºÙ„ÛŒ: ${gameState.job.level}</p>
        <p>ØªØ¬Ø±Ø¨Ù‡ Ø´ØºÙ„ÛŒ: ${gameState.job.experience} Ø³Ø§Ù„</p>
        ${gameState.job.title !== 'Ø¨ÛŒÚ©Ø§Ø±' ? `
          <button class="btn-primary px-4 py-2 rounded-lg mt-4" onclick="window.promoteJob()">Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ø§Ø±ØªÙ‚Ø§</button>
          <button class="btn-secondary px-4 py-2 rounded-lg mt-4 ml-2" onclick="window.resignJob()">Ø§Ø³ØªØ¹ÙØ§</button>
        ` : '<p class="text-gray-400 mt-2">Ø´Ù…Ø§ Ø¯Ø± Ø­Ø§Ù„ Ø­Ø§Ø¶Ø± Ø´ØºÙ„ÛŒ Ù†Ø¯Ø§Ø±ÛŒØ¯.</p>'}
      `;
      document.getElementById('career-progress-tab').classList.add('btn-primary');
      document.getElementById('career-progress-tab').classList.remove('btn-secondary');
      document.getElementById('job-list-tab').classList.add('btn-secondary');
      document.getElementById('job-list-tab').classList.remove('btn-primary');
    }

    window.applyJob = function(name, salary, req, majorReq, minAge, smartsReq, looksReq) {
      if (gameState.age < minAge) {
        showMessageModal(`Ø¨Ø±Ø§ÛŒ Ø§ÛŒÙ† Ø´ØºÙ„ Ø¨Ø§ÛŒØ¯ Ø­Ø¯Ø§Ù‚Ù„ ${minAge} Ø³Ø§Ù„ Ø¯Ø§Ø´ØªÙ‡ Ø¨Ø§Ø´ÛŒØ¯.`);
        return;
      }
      if (req !== 'none' && (gameState.education.level !== req || (majorReq && gameState.education.major !== majorReq))) {
        showMessageModal(`Ù†ÛŒØ§Ø² Ø¨Ù‡ ØªØ­ØµÛŒÙ„Ø§Øª ${req} ${majorReq ? `(Ø±Ø´ØªÙ‡ ${majorReq})` : ''} Ø¯Ø§Ø±ÛŒØ¯!`);
        return;
      }
      if (gameState.smarts < smartsReq) {
          showMessageModal(`Ù‡ÙˆØ´ Ø´Ù…Ø§ Ø¨Ø±Ø§ÛŒ Ø§ÛŒÙ† Ø´ØºÙ„ Ú©Ø§ÙÛŒ Ù†ÛŒØ³Øª. (Ù†ÛŒØ§Ø² Ø¨Ù‡ Ù‡ÙˆØ´ ${smartsReq}+)`);
          return;
      }
      if (gameState.looks < looksReq) {
          showMessageModal(`Ø¸Ø§Ù‡Ø± Ø´Ù…Ø§ Ø¨Ø±Ø§ÛŒ Ø§ÛŒÙ† Ø´ØºÙ„ Ú©Ø§ÙÛŒ Ù†ÛŒØ³Øª. (Ù†ÛŒØ§Ø² Ø¨Ù‡ Ø¸Ø§Ù‡Ø± ${looksReq}+)`);
          return;
      }
      
      gameState.job = { title: name, salary: salary, level: 1, experience: 0 };
      gameState.log.push({ year: gameState.year, event: `Ø´Ù…Ø§ Ø¨Ù‡ Ø¹Ù†ÙˆØ§Ù† ${name} Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø´Ø¯ÛŒØ¯.`, type: 'career' });
      updateUI();
      saveGame();
    }

    window.promoteJob = function() {
      if (gameState.job.title === 'Ø¨ÛŒÚ©Ø§Ø±') {
        showMessageModal('Ø´Ù…Ø§ Ø´ØºÙ„ÛŒ Ù†Ø¯Ø§Ø±ÛŒØ¯ Ú©Ù‡ Ø§Ø±ØªÙ‚Ø§ Ø¨Ú¯ÛŒØ±ÛŒØ¯.');
        return;
      }
      // More complex promotion logic (Ù…Ù†Ø·Ù‚ Ø§Ø±ØªÙ‚Ø§Ø¡ Ù¾ÛŒÚ†ÛŒØ¯Ù‡â€ŒØªØ±)
      const promotionChance = (gameState.smarts / 100) * (gameState.job.experience / 10) * (1 - (gameState.job.level / 10)); // Smarts, experience, and current level affect success (Ù‡ÙˆØ´ØŒ ØªØ¬Ø±Ø¨Ù‡ Ùˆ Ø³Ø·Ø­ ÙØ¹Ù„ÛŒ Ø¨Ø± Ù…ÙˆÙÙ‚ÛŒØª ØªØ£Ø«ÛŒØ± Ù…ÛŒâ€ŒÚ¯Ø°Ø§Ø±Ø¯)
      const success = Math.random() < promotionChance;

      if (success && gameState.job.level < 10) { // Max level 10 (Ø­Ø¯Ø§Ú©Ø«Ø± Ø³Ø·Ø­ Û±Û°)
        gameState.job.level++;
        gameState.job.salary = Math.floor(gameState.job.salary * 1.25); // 25% salary increase (Ø§ÙØ²Ø§ÛŒØ´ Û²ÛµÙª Ø­Ù‚ÙˆÙ‚)
        gameState.log.push({ year: gameState.year, event: `Ø´Ù…Ø§ Ø¯Ø± Ø´ØºÙ„ ${gameState.job.title} Ø§Ø±ØªÙ‚Ø§ ÛŒØ§ÙØªÛŒØ¯! Ø³Ø·Ø­ ${gameState.job.level} Ø¨Ø§ Ø­Ù‚ÙˆÙ‚ ${gameState.job.salary.toLocaleString('fa-IR')} ØªÙˆÙ…Ø§Ù†.`, type: 'career' });
        showMessageModal('ØªØ¨Ø±ÛŒÚ©! Ø´Ù…Ø§ Ø§Ø±ØªÙ‚Ø§ ÛŒØ§ÙØªÛŒØ¯.');
      } else if (gameState.job.level >= 10) {
        showMessageModal('Ø´Ù…Ø§ Ø¨Ù‡ Ø¨Ø§Ù„Ø§ØªØ±ÛŒÙ† Ø³Ø·Ø­ Ø´ØºÙ„ÛŒ Ø¯Ø± Ø§ÛŒÙ† Ø­Ø±ÙÙ‡ Ø±Ø³ÛŒØ¯Ù‡â€ŒØ§ÛŒØ¯!');
      } else {
        gameState.log.push({ year: gameState.year, event: `ØªÙ„Ø§Ø´ Ø¨Ø±Ø§ÛŒ Ø§Ø±ØªÙ‚Ø§ Ø¯Ø± Ø´ØºÙ„ ${gameState.job.title} Ù†Ø§Ù…ÙˆÙÙ‚ Ø¨ÙˆØ¯.`, type: 'career' });
        showMessageModal('ØªÙ„Ø§Ø´ Ø´Ù…Ø§ Ø¨Ø±Ø§ÛŒ Ø§Ø±ØªÙ‚Ø§ Ù…ÙˆÙÙ‚ Ù†Ø¨ÙˆØ¯. Ø´Ø§ÛŒØ¯ Ù†ÛŒØ§Ø² Ø¨Ù‡ ØªØ¬Ø±Ø¨Ù‡ ÛŒØ§ Ù‡ÙˆØ´ Ø¨ÛŒØ´ØªØ±ÛŒ Ø¯Ø§Ø±ÛŒØ¯.');
      }
      updateUI();
      saveGame();
    }

    window.resignJob = function() {
      if (gameState.job.title === 'Ø¨ÛŒÚ©Ø§Ø±') {
        showMessageModal('Ø´Ù…Ø§ Ø¯Ø± Ø­Ø§Ù„ Ø­Ø§Ø¶Ø± Ø´ØºÙ„ÛŒ Ù†Ø¯Ø§Ø±ÛŒØ¯ Ú©Ù‡ Ø§Ø³ØªØ¹ÙØ§ Ø¯Ù‡ÛŒØ¯.');
        return;
      }
      window.confirm('Ø¢ÛŒØ§ Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ Ú©Ù‡ Ù…ÛŒâ€ŒØ®ÙˆØ§Ù‡ÛŒØ¯ Ø§Ø² Ø´ØºÙ„ Ø®ÙˆØ¯ Ø§Ø³ØªØ¹ÙØ§ Ø¯Ù‡ÛŒØ¯ØŸ').then(confirmed => {
        if (confirmed) {
            gameState.job = { title: 'Ø¨ÛŒÚ©Ø§Ø±', salary: 0, level: 0, experience: 0 };
            gameState.log.push({ year: gameState.year, event: 'Ø´Ù…Ø§ Ø§Ø² Ø´ØºÙ„ Ø®ÙˆØ¯ Ø§Ø³ØªØ¹ÙØ§ Ø¯Ø§Ø¯ÛŒØ¯.', type: 'career' });
            showMessageModal('Ø´Ù…Ø§ Ø§Ø² Ø´ØºÙ„ Ø®ÙˆØ¯ Ø§Ø³ØªØ¹ÙØ§ Ø¯Ø§Ø¯ÛŒØ¯.');
            updateUI();
            saveGame();
        }
      });
    }

    // Relationships (Ø±ÙˆØ§Ø¨Ø·)
    window.interact = function(personId, action) {
      const person = gameState.relationships.find(r => r.id === personId);
      if (!person) return;

      if (action === 'talk') {
        person.relationship = Math.min(100, person.relationship + 5);
        gameState.happiness = Math.min(100, gameState.happiness + 3);
        gameState.log.push({ year: gameState.year, event: `Ø´Ù…Ø§ Ø¨Ø§ ${person.name} ØµØ­Ø¨Øª Ú©Ø±Ø¯ÛŒØ¯.`, type: 'family' });
      } else if (action === 'gift') {
        const giftCost = 100000;
        if (gameState.money < giftCost) {
          showMessageModal(`Ù¾ÙˆÙ„ Ú©Ø§ÙÛŒ Ø¨Ø±Ø§ÛŒ Ø®Ø±ÛŒØ¯ Ù‡Ø¯ÛŒÙ‡ Ù†Ø¯Ø§Ø±ÛŒØ¯! (Ø­Ø¯Ø§Ù‚Ù„ ${giftCost.toLocaleString('fa-IR')} ØªÙˆÙ…Ø§Ù†)`);
          return;
        }
        person.relationship = Math.min(100, person.relationship + 10);
        gameState.money -= giftCost;
        gameState.log.push({ year: gameState.year, event: `Ø´Ù…Ø§ Ø¨Ù‡ ${person.name} Ù‡Ø¯ÛŒÙ‡ Ø¯Ø§Ø¯ÛŒØ¯.`, type: 'family' });
      } else if (action === 'argue') {
        person.relationship = Math.max(0, person.relationship - 15);
        gameState.happiness = Math.max(0, gameState.happiness - 5);
        gameState.log.push({ year: gameState.year, event: `Ø´Ù…Ø§ Ø¨Ø§ ${person.name} Ø¯Ø¹ÙˆØ§ Ú©Ø±Ø¯ÛŒØ¯.`, type: 'family' });
      }
      updateUI();
      saveGame();
    }

    // Romantic Relationships (Ø±ÙˆØ§Ø¨Ø· Ø¹Ø§Ø·ÙÛŒ)
    window.findPartner = function() {
        if (gameState.age < 18) {
            showMessageModal('Ø´Ù…Ø§ Ø¨Ø±Ø§ÛŒ Ù¾ÛŒØ¯Ø§ Ú©Ø±Ø¯Ù† Ø´Ø±ÛŒÚ© Ø¹Ø§Ø·ÙÛŒ Ø®ÛŒÙ„ÛŒ Ú©ÙˆÚ†Ú© Ù‡Ø³ØªÛŒØ¯.');
            return;
        }
        if (gameState.romanticRelationships.length > 0 && gameState.romanticRelationships[0].isMarried) {
            showMessageModal('Ø´Ù…Ø§ Ø¯Ø± Ø­Ø§Ù„ Ø­Ø§Ø¶Ø± Ù…ØªØ§Ù‡Ù„ Ù‡Ø³ØªÛŒØ¯ Ùˆ Ù†Ù…ÛŒâ€ŒØªÙˆØ§Ù†ÛŒØ¯ Ø´Ø±ÛŒÚ© Ø¹Ø§Ø·ÙÛŒ Ø¬Ø¯ÛŒØ¯ÛŒ Ù¾ÛŒØ¯Ø§ Ú©Ù†ÛŒØ¯.');
            return;
        }
        
        const chance = (gameState.looks + gameState.happiness) / 200; // Chance based on looks and happiness (Ø´Ø§Ù†Ø³ Ø¨Ø± Ø§Ø³Ø§Ø³ Ø¸Ø§Ù‡Ø± Ùˆ Ø´Ø§Ø¯ÛŒ)
        if (Math.random() < chance) {
            const partnerName = gameState.gender === 'male' ? 'Ø®Ø§Ù†Ù…' : 'Ø¢Ù‚Ø§'; // Simple naming (Ù†Ø§Ù…Ú¯Ø°Ø§Ø±ÛŒ Ø³Ø§Ø¯Ù‡)
            const newPartner = {
                id: crypto.randomUUID(),
                name: `${partnerName} Ø¬Ø¯ÛŒØ¯`,
                role: 'Ø´Ø±ÛŒÚ© Ø¹Ø§Ø·ÙÛŒ',
                relationship: 30 + Math.floor(Math.random() * 20), // Initial relationship (Ø±Ø§Ø¨Ø·Ù‡ Ø§ÙˆÙ„ÛŒÙ‡)
                isMarried: false
            };
            gameState.romanticRelationships.push(newPartner);
            gameState.log.push({ year: gameState.year, event: `Ø´Ù…Ø§ Ø¨Ø§ ${newPartner.name} Ø¢Ø´Ù†Ø§ Ø´Ø¯ÛŒØ¯!`, type: 'family' });
            showMessageModal(`ØªØ¨Ø±ÛŒÚ©! Ø´Ù…Ø§ Ø¨Ø§ ${newPartner.name} Ø¢Ø´Ù†Ø§ Ø´Ø¯ÛŒØ¯.`);
        } else {
            gameState.log.push({ year: gameState.year, event: 'ØªÙ„Ø§Ø´ Ø¨Ø±Ø§ÛŒ Ù¾ÛŒØ¯Ø§ Ú©Ø±Ø¯Ù† Ø´Ø±ÛŒÚ© Ø¹Ø§Ø·ÙÛŒ Ù†Ø§Ù…ÙˆÙÙ‚ Ø¨ÙˆØ¯.', type: 'family' });
            showMessageModal('Ù…ØªØ§Ø³ÙØ§Ù†Ù‡ Ø¯Ø± Ø§ÛŒÙ† Ø³Ø§Ù„ Ø´Ø±ÛŒÚ© Ø¹Ø§Ø·ÙÛŒ Ù¾ÛŒØ¯Ø§ Ù†Ú©Ø±Ø¯ÛŒØ¯.');
        }
        updateUI();
        saveGame();
    }

    window.interactRomantic = function(personId, action) {
        const partner = gameState.romanticRelationships.find(r => r.id === personId);
        if (!partner) return;

        if (action === 'talk') {
            partner.relationship = Math.min(100, partner.relationship + 7);
            gameState.happiness = Math.min(100, gameState.happiness + 5);
            gameState.log.push({ year: gameState.year, event: `Ø´Ù…Ø§ Ø¨Ø§ ${partner.name} ØµØ­Ø¨Øª Ø¹Ù…ÛŒÙ‚ÛŒ Ø¯Ø§Ø´ØªÛŒØ¯.`, type: 'family' });
        } else if (action === 'date') {
            const dateCost = 500000;
            if (gameState.money < dateCost) {
                showMessageModal(`Ù¾ÙˆÙ„ Ú©Ø§ÙÛŒ Ø¨Ø±Ø§ÛŒ Ù‚Ø±Ø§Ø± Ù…Ù„Ø§Ù‚Ø§Øª Ù†Ø¯Ø§Ø±ÛŒØ¯! (Ø­Ø¯Ø§Ù‚Ù„ ${dateCost.toLocaleString('fa-IR')} ØªÙˆÙ…Ø§Ù†)`);
                return;
            }
            gameState.money -= dateCost;
            partner.relationship = Math.min(100, partner.relationship + 15);
            gameState.happiness = Math.min(100, gameState.happiness + 10);
            gameState.log.push({ year: gameState.year, event: `Ø´Ù…Ø§ Ø¨Ø§ ${partner.name} Ø¨Ù‡ Ù‚Ø±Ø§Ø± Ù…Ù„Ø§Ù‚Ø§Øª Ø±ÙØªÛŒØ¯.`, type: 'family' });
        }
        updateUI();
        saveGame();
    }

    window.proposeMarriage = function(personId) {
        const partner = gameState.romanticRelationships.find(r => r.id === personId);
        if (!partner || partner.isMarried) return;

        if (partner.relationship < 80) {
            showMessageModal('Ø±Ø§Ø¨Ø·Ù‡ Ø´Ù…Ø§ Ø¨Ø§ Ø§ÛŒÙ† Ø´Ø®Øµ Ø¨Ù‡ Ø§Ù†Ø¯Ø§Ø²Ù‡ Ú©Ø§ÙÛŒ Ù‚ÙˆÛŒ Ù†ÛŒØ³Øª Ú©Ù‡ Ø§Ø²Ø¯ÙˆØ§Ø¬ Ú©Ù†ÛŒØ¯. (Ù†ÛŒØ§Ø² Ø¨Ù‡ Ø±Ø§Ø¨Ø·Ù‡ Û¸Û°Ùª+)');
            return;
        }

        const success = Math.random() < (partner.relationship / 100);
        if (success) {
            partner.role = 'Ù‡Ù…Ø³Ø±';
            partner.isMarried = true;
            gameState.happiness = Math.min(100, gameState.happiness + 20);
            gameState.log.push({ year: gameState.year, event: `Ø´Ù…Ø§ Ø¨Ø§ ${partner.name} Ø§Ø²Ø¯ÙˆØ§Ø¬ Ú©Ø±Ø¯ÛŒØ¯! ØªØ¨Ø±ÛŒÚ©!`, type: 'family' });
            showMessageModal(`ØªØ¨Ø±ÛŒÚ©! Ø´Ù…Ø§ Ø¨Ø§ ${partner.name} Ø§Ø²Ø¯ÙˆØ§Ø¬ Ú©Ø±Ø¯ÛŒØ¯.`);
        } else {
            partner.relationship = Math.max(0, partner.relationship - 20); // Relationship hit (Ø¶Ø±Ø¨Ù‡ Ø¨Ù‡ Ø±Ø§Ø¨Ø·Ù‡)
            gameState.happiness = Math.max(0, gameState.happiness - 10); // Happiness hit (Ø¶Ø±Ø¨Ù‡ Ø¨Ù‡ Ø´Ø§Ø¯ÛŒ)
            gameState.log.push({ year: gameState.year, event: `Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯ Ø§Ø²Ø¯ÙˆØ§Ø¬ Ø´Ù…Ø§ Ø¨Ù‡ ${partner.name} Ø±Ø¯ Ø´Ø¯.`, type: 'family' });
            showMessageModal(`Ù…ØªØ§Ø³ÙØ§Ù†Ù‡ ${partner.name} Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯ Ø§Ø²Ø¯ÙˆØ§Ø¬ Ø´Ù…Ø§ Ø±Ø§ Ø±Ø¯ Ú©Ø±Ø¯.`);
        }
        updateUI();
        saveGame();
    }

    window.tryForBaby = function(personId) {
      const partner = gameState.romanticRelationships.find(r => r.id === personId);
      if (!partner || !partner.isMarried) {
        showMessageModal('Ø´Ù…Ø§ Ø¨Ø§ÛŒØ¯ Ù…ØªØ§Ù‡Ù„ Ø¨Ø§Ø´ÛŒØ¯ ØªØ§ Ø¨Ú†Ù‡â€ŒØ¯Ø§Ø± Ø´ÙˆÛŒØ¯.');
        return;
      }
      if (gameState.age < 20 || gameState.age > 45) { // Realistic age range (Ù…Ø­Ø¯ÙˆØ¯Ù‡ Ø³Ù†ÛŒ ÙˆØ§Ù‚Ø¹â€ŒØ¨ÛŒÙ†Ø§Ù†Ù‡)
        showMessageModal('Ø´Ù…Ø§ Ø¯Ø± Ù…Ø­Ø¯ÙˆØ¯Ù‡ Ø³Ù†ÛŒ Ù…Ù†Ø§Ø³Ø¨ Ø¨Ø±Ø§ÛŒ Ø¨Ú†Ù‡â€ŒØ¯Ø§Ø± Ø´Ø¯Ù† Ù†ÛŒØ³ØªÛŒØ¯. (Û²Û° ØªØ§ Û´Ûµ Ø³Ø§Ù„Ú¯ÛŒ)');
        return;
      }
      
      const successChance = (gameState.health / 100) * (partner.relationship / 100); // Health and relationship affect chance (Ø³Ù„Ø§Ù…Øª Ùˆ Ø±Ø§Ø¨Ø·Ù‡ Ø¨Ø± Ø´Ø§Ù†Ø³ ØªØ£Ø«ÛŒØ± Ù…ÛŒâ€ŒÚ¯Ø°Ø§Ø±Ø¯)
      if (Math.random() < successChance) {
        const babyName = gameState.gender === 'male' ? 'Ø¯Ø®ØªØ±' : 'Ù¾Ø³Ø±'; // Simple naming (Ù†Ø§Ù…Ú¯Ø°Ø§Ø±ÛŒ Ø³Ø§Ø¯Ù‡)
        const newChild = {
          id: crypto.randomUUID(),
          name: `${babyName} Ø´Ù…Ø§`,
          age: 0,
          relationship: 70 + Math.floor(Math.random() * 10) // Initial relationship (Ø±Ø§Ø¨Ø·Ù‡ Ø§ÙˆÙ„ÛŒÙ‡)
        };
        gameState.children.push(newChild);
        gameState.happiness = Math.min(100, gameState.happiness + 30);
        gameState.log.push({ year: gameState.year, event: `ØªØ¨Ø±ÛŒÚ©! Ø´Ù…Ø§ ØµØ§Ø­Ø¨ ÛŒÚ© ${newChild.name} Ø´Ø¯!`, type: 'family' });
        showMessageModal(`ØªØ¨Ø±ÛŒÚ©! Ø´Ù…Ø§ ØµØ§Ø­Ø¨ ÛŒÚ© ${newChild.name} Ø´Ø¯ÛŒØ¯!`);
      } else {
        gameState.log.push({ year: gameState.year, event: 'ØªÙ„Ø§Ø´ Ø¨Ø±Ø§ÛŒ Ø¨Ú†Ù‡â€ŒØ¯Ø§Ø± Ø´Ø¯Ù† Ù…ÙˆÙÙ‚ÛŒØª Ø¢Ù…ÛŒØ² Ù†Ø¨ÙˆØ¯.', type: 'family' });
        showMessageModal('ØªÙ„Ø§Ø´ Ø¨Ø±Ø§ÛŒ Ø¨Ú†Ù‡â€ŒØ¯Ø§Ø± Ø´Ø¯Ù† Ù…ÙˆÙÙ‚ÛŒØªâ€ŒØ¢Ù…ÛŒØ² Ù†Ø¨ÙˆØ¯. Ø¯ÙˆØ¨Ø§Ø±Ù‡ Ø§Ù…ØªØ­Ø§Ù† Ú©Ù†ÛŒØ¯.');
      }
      updateUI();
      saveGame();
    }

    window.breakup = function(personId) {
        window.confirm('Ø¢ÛŒØ§ Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ Ú©Ù‡ Ù…ÛŒâ€ŒØ®ÙˆØ§Ù‡ÛŒØ¯ Ø§ÛŒÙ† Ø±Ø§Ø¨Ø·Ù‡ Ø±Ø§ ØªÙ…Ø§Ù… Ú©Ù†ÛŒØ¯ØŸ').then(confirmed => {
            if (confirmed) {
                gameState.romanticRelationships = gameState.romanticRelationships.filter(r => r.id !== personId);
                gameState.happiness = Math.max(0, gameState.happiness - 25);
                gameState.log.push({ year: gameState.year, event: 'Ø´Ù…Ø§ ÛŒÚ© Ø±Ø§Ø¨Ø·Ù‡ Ø¹Ø§Ø·ÙÛŒ Ø±Ø§ Ø¨Ù‡ Ù¾Ø§ÛŒØ§Ù† Ø±Ø³Ø§Ù†Ø¯ÛŒØ¯.', type: 'family' });
                showMessageModal('Ø±Ø§Ø¨Ø·Ù‡ Ø´Ù…Ø§ Ø¨Ù‡ Ù¾Ø§ÛŒØ§Ù† Ø±Ø³ÛŒØ¯.');
                updateUI();
                saveGame();
            }
        });
    }


    // Health (Ø³Ù„Ø§Ù…Øª)
    const illnessesData = {
        'Ø³Ø±Ù…Ø§Ø®ÙˆØ±Ø¯Ú¯ÛŒ': { severity: 'Ø®ÙÛŒÙ', impact: 10, cost: 50000, specialist: false },
        'Ø¢Ù†ÙÙˆÙ„Ø§Ù†Ø²Ø§': { severity: 'Ù…ØªÙˆØ³Ø·', impact: 20, cost: 150000, specialist: false },
        'Ø¢Ù¾Ø§Ù†Ø¯ÛŒØ³ÛŒØª': { severity: 'Ø¬Ø¯ÛŒ', impact: 40, cost: 1000000, specialist: true },
        'Ø§ÙØ³Ø±Ø¯Ú¯ÛŒ': { severity: 'Ù…Ø²Ù…Ù†', impact: 15, cost: 200000, specialist: true }
    };

    function visitDoctor() {
      const cost = 50000;
      if (gameState.money < cost) {
        showMessageModal(`Ù¾ÙˆÙ„ Ú©Ø§ÙÛŒ Ø¨Ø±Ø§ÛŒ Ù…Ø±Ø§Ø¬Ø¹Ù‡ Ø¨Ù‡ Ù¾Ø²Ø´Ú© Ù†Ø¯Ø§Ø±ÛŒØ¯! (Ù‡Ø²ÛŒÙ†Ù‡: ${cost.toLocaleString('fa-IR')} ØªÙˆÙ…Ø§Ù†)`);
        return;
      }
      gameState.money -= cost;
      gameState.health = Math.min(100, gameState.health + 20);
      gameState.illnesses = gameState.illnesses.filter(ill => illnessesData[ill.name]?.specialist === false); // Only minor illnesses cured (ÙÙ‚Ø· Ø¨ÛŒÙ…Ø§Ø±ÛŒâ€ŒÙ‡Ø§ÛŒ Ø¬Ø²Ø¦ÛŒ Ø¯Ø±Ù…Ø§Ù† Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯)
      gameState.log.push({ year: gameState.year, event: 'Ø´Ù…Ø§ Ø¨Ù‡ Ù¾Ø²Ø´Ú© Ø¹Ù…ÙˆÙ…ÛŒ Ù…Ø±Ø§Ø¬Ø¹Ù‡ Ú©Ø±Ø¯ÛŒØ¯ Ùˆ Ø­Ø§Ù„ØªØ§Ù† Ø¨Ù‡ØªØ± Ø´Ø¯.', type: 'health' });
      updateUI();
      saveGame();
    }

    function visitSpecialist() {
        const cost = 500000;
        if (gameState.money < cost) {
            showMessageModal(`Ù¾ÙˆÙ„ Ú©Ø§ÙÛŒ Ø¨Ø±Ø§ÛŒ Ù…Ø±Ø§Ø¬Ø¹Ù‡ Ø¨Ù‡ Ù…ØªØ®ØµØµ Ù†Ø¯Ø§Ø±ÛŒØ¯! (Ù‡Ø²ÛŒÙ†Ù‡: ${cost.toLocaleString('fa-IR')} ØªÙˆÙ…Ø§Ù†)`);
            return;
        }
        if (gameState.illnesses.length === 0) {
            showMessageModal('Ø´Ù…Ø§ Ù‡ÛŒÚ† Ø¨ÛŒÙ…Ø§Ø±ÛŒ Ø®Ø§ØµÛŒ Ù†Ø¯Ø§Ø±ÛŒØ¯ Ú©Ù‡ Ù†ÛŒØ§Ø² Ø¨Ù‡ Ù…ØªØ®ØµØµ Ø¯Ø§Ø´ØªÙ‡ Ø¨Ø§Ø´Ø¯.');
            return;
        }

        gameState.money -= cost;
        gameState.health = Math.min(100, gameState.health + 40);
        gameState.illnesses = []; // Clear all illnesses (ØªÙ…Ø§Ù… Ø¨ÛŒÙ…Ø§Ø±ÛŒâ€ŒÙ‡Ø§ Ø±Ø§ Ù¾Ø§Ú© Ù…ÛŒâ€ŒÚ©Ù†Ø¯)
        gameState.log.push({ year: gameState.year, event: 'Ø´Ù…Ø§ Ø¨Ù‡ Ù…ØªØ®ØµØµ Ù…Ø±Ø§Ø¬Ø¹Ù‡ Ú©Ø±Ø¯ÛŒØ¯ Ùˆ Ø¨Ù‡Ø¨ÙˆØ¯ Ú©Ø§Ù…Ù„ ÛŒØ§ÙØªÛŒØ¯.', type: 'health' });
        showMessageModal('Ø¨ÛŒÙ…Ø§Ø±ÛŒâ€ŒÙ‡Ø§ÛŒ Ø´Ù…Ø§ ØªÙˆØ³Ø· Ù…ØªØ®ØµØµ Ø¯Ø±Ù…Ø§Ù† Ø´Ø¯.');
        updateUI();
        saveGame();
    }

    function goGym() {
      const cost = 20000;
      if (gameState.money < cost) {
        showMessageModal(`Ù¾ÙˆÙ„ Ú©Ø§ÙÛŒ Ø¨Ø±Ø§ÛŒ Ø±ÙØªÙ† Ø¨Ù‡ Ø¨Ø§Ø´Ú¯Ø§Ù‡ Ù†Ø¯Ø§Ø±ÛŒØ¯! (Ù‡Ø²ÛŒÙ†Ù‡: ${cost.toLocaleString('fa-IR')} ØªÙˆÙ…Ø§Ù†)`);
        return;
      }
      gameState.money -= cost;
      gameState.health = Math.min(100, gameState.health + 10);
      gameState.looks = Math.min(100, gameState.looks + 5);
      gameState.log.push({ year: gameState.year, event: 'Ø´Ù…Ø§ ÙˆØ±Ø²Ø´ Ú©Ø±Ø¯ÛŒØ¯ Ùˆ Ø³Ø§Ù„Ù…â€ŒØªØ± Ø´Ø¯ÛŒØ¯.', type: 'health' });
      updateUI();
      saveGame();
    }

    function meditate() {
      gameState.spirituality = Math.min(100, gameState.spirituality + 10);
      gameState.happiness = Math.min(100, gameState.happiness + 5);
      gameState.log.push({ year: gameState.year, event: 'Ø´Ù…Ø§ Ù…Ø±Ø§Ù‚Ø¨Ù‡ Ú©Ø±Ø¯ÛŒØ¯ Ùˆ Ø¢Ø±Ø§Ù…Ø´ Ø¨ÛŒØ´ØªØ±ÛŒ ÛŒØ§ÙØªÛŒØ¯.', type: 'spirituality' });
      updateUI();
      saveGame();
    }

    // Finance (Ù…Ø§Ù„ÛŒ)
    // Removed old investmentTypes, now they are part of investmentCategories
    function takeLoan() {
      const amountInput = document.getElementById('loan-amount');
      const amount = parseInt(amountInput.value);

      if (isNaN(amount) || amount < 100000) {
        showMessageModal('Ù…Ø¨Ù„Øº ÙˆØ§Ù… Ø¨Ø§ÛŒØ¯ Ø­Ø¯Ø§Ù‚Ù„ Û±Û°Û°,Û°Û°Û° ØªÙˆÙ…Ø§Ù† Ø¨Ø§Ø´Ø¯.');
        return;
      }
      if (gameState.job.title === 'Ø¨ÛŒÚ©Ø§Ø±' && gameState.money < 1000000) { // Can take small emergency loan without job (Ù…ÛŒâ€ŒØªÙˆØ§Ù† ÙˆØ§Ù… Ø§Ø¶Ø·Ø±Ø§Ø±ÛŒ Ú©ÙˆÚ†Ú© Ø¨Ø¯ÙˆÙ† Ø´ØºÙ„ Ú¯Ø±ÙØª)
        showMessageModal('Ø¨Ø±Ø§ÛŒ Ø¯Ø±ÛŒØ§ÙØª ÙˆØ§Ù… (Ø¨Ù‡ Ø¬Ø² ÙˆØ§Ù… Ø§Ø¶Ø·Ø±Ø§Ø±ÛŒ Ú©ÙˆÚ†Ú©) Ø¨Ø§ÛŒØ¯ Ø´ØºÙ„ Ø¯Ø§Ø´ØªÙ‡ Ø¨Ø§Ø´ÛŒØ¯.');
        return;
      }
      if (gameState.loans.length > 2) { // Limit number of loans (Ù…Ø­Ø¯ÙˆØ¯ Ú©Ø±Ø¯Ù† ØªØ¹Ø¯Ø§Ø¯ ÙˆØ§Ù…â€ŒÙ‡Ø§)
          showMessageModal('Ø´Ù…Ø§ Ø¨ÛŒØ´ Ø§Ø² Ø­Ø¯ ÙˆØ§Ù… Ø¯Ø§Ø±ÛŒØ¯. Ø§Ø¨ØªØ¯Ø§ ÙˆØ§Ù…â€ŒÙ‡Ø§ÛŒ Ù‚Ø¨Ù„ÛŒ Ø±Ø§ ØªØ³ÙˆÛŒÙ‡ Ú©Ù†ÛŒØ¯.');
          return;
      }

      gameState.money += amount;
      const interestRate = 0.1 + (Math.random() * 0.05); // 10-15% interest (Û±Û°-Û±ÛµÙª Ø³ÙˆØ¯)
      gameState.loans.push({ id: crypto.randomUUID(), amount: amount, remaining: amount * (1 + interestRate), interestRate: interestRate });
      gameState.log.push({ year: gameState.year, event: `Ø´Ù…Ø§ ÙˆØ§Ù…ÛŒ Ø¨Ù‡ Ù…Ø¨Ù„Øº ${amount.toLocaleString('fa-IR')} ØªÙˆÙ…Ø§Ù† Ø¯Ø±ÛŒØ§ÙØª Ú©Ø±Ø¯ÛŒØ¯.`, type: 'finance' });
      showMessageModal(`Ø´Ù…Ø§ ÙˆØ§Ù…ÛŒ Ø¨Ù‡ Ù…Ø¨Ù„Øº ${amount.toLocaleString('fa-IR')} ØªÙˆÙ…Ø§Ù† Ø¯Ø±ÛŒØ§ÙØª Ú©Ø±Ø¯ÛŒØ¯.`);
      amountInput.value = 100000; // Reset input (Ø¨Ø§Ø²Ù†Ø´Ø§Ù†ÛŒ ÙˆØ±ÙˆØ¯ÛŒ)
      document.getElementById('loan-section').style.display = 'none'; // Hide section (Ù¾Ù†Ù‡Ø§Ù† Ú©Ø±Ø¯Ù† Ø¨Ø®Ø´)
      updateUI();
      saveGame();
    }

    window.payLoan = function(loanId) {
        const loanIndex = gameState.loans.findIndex(l => l.id === loanId);
        if (loanIndex === -1) return;

        const loan = gameState.loans[loanIndex];
        const paymentAmount = Math.min(loan.remaining, gameState.money); // Pay up to remaining or current money (ØªØ§ Ù…Ø¨Ù„Øº Ø¨Ø§Ù‚ÛŒâ€ŒÙ…Ø§Ù†Ø¯Ù‡ ÛŒØ§ Ù¾ÙˆÙ„ ÙØ¹Ù„ÛŒ Ù¾Ø±Ø¯Ø§Ø®Øª Ù…ÛŒâ€ŒÚ©Ù†Ø¯)

        if (paymentAmount <= 0) {
            showMessageModal('Ù¾ÙˆÙ„ Ú©Ø§ÙÛŒ Ø¨Ø±Ø§ÛŒ Ù¾Ø±Ø¯Ø§Ø®Øª ÙˆØ§Ù… Ù†Ø¯Ø§Ø±ÛŒØ¯.');
            return;
        }

        gameState.money -= paymentAmount;
        loan.remaining -= paymentAmount;

        if (loan.remaining <= 0) {
            gameState.loans.splice(loanIndex, 1);
            gameState.log.push({ year: gameState.year, event: `Ø´Ù…Ø§ ÙˆØ§Ù… Ø®ÙˆØ¯ Ø±Ø§ Ø¨Ù‡ Ø·ÙˆØ± Ú©Ø§Ù…Ù„ Ù¾Ø±Ø¯Ø§Ø®Øª Ú©Ø±Ø¯ÛŒØ¯!`, type: 'finance' });
            showMessageModal('ÙˆØ§Ù… Ø´Ù…Ø§ Ø¨Ù‡ Ø·ÙˆØ± Ú©Ø§Ù…Ù„ Ù¾Ø±Ø¯Ø§Ø®Øª Ø´Ø¯.');
        } else {
            gameState.log.push({ year: gameState.year, event: `Ø´Ù…Ø§ ${paymentAmount.toLocaleString('fa-IR')} ØªÙˆÙ…Ø§Ù† Ø§Ø² ÙˆØ§Ù… Ø®ÙˆØ¯ Ø±Ø§ Ù¾Ø±Ø¯Ø§Ø®Øª Ú©Ø±Ø¯ÛŒØ¯.`, type: 'finance' });
            showMessageModal(`Ø´Ù…Ø§ ${paymentAmount.toLocaleString('fa-IR')} ØªÙˆÙ…Ø§Ù† Ø§Ø² ÙˆØ§Ù… Ø®ÙˆØ¯ Ø±Ø§ Ù¾Ø±Ø¯Ø§Ø®Øª Ú©Ø±Ø¯ÛŒØ¯. Ø¨Ø§Ù‚ÛŒâ€ŒÙ…Ø§Ù†Ø¯Ù‡: ${loan.remaining.toLocaleString('fa-IR')} ØªÙˆÙ…Ø§Ù†.`);
        }
        updateUI();
        saveGame();
    }

    // Asset Categories Data (Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Ø¯Ø§Ø±Ø§ÛŒÛŒâ€ŒÙ‡Ø§)
    const assetCategories = {
      'properties': {
        name: 'Ø§Ù…Ù„Ø§Ú©',
        emoji: 'ğŸ ',
        items: [
          { name: 'Ø®Ø§Ù†Ù‡â€ŒÛŒ ÙˆÛŒÙ„Ø§ÛŒÛŒ', basePrice: 250000000 },
          { name: 'Ø¢Ù¾Ø§Ø±ØªÙ…Ø§Ù† Ø´Ù‡Ø±ÛŒ', basePrice: 150000000 },
          { name: 'Ù…Ø²Ø±Ø¹Ù‡', basePrice: 400000000 },
          { name: 'ÙˆÛŒÙ„Ø§ Ø¯Ø± Ø´Ù…Ø§Ù„', basePrice: 700000000 },
          { name: 'Ø¬Ø²ÛŒØ±Ù‡ Ø®ØµÙˆØµÛŒ', basePrice: 5000000000 }
        ]
      },
      'vehicles': {
        name: 'Ø®ÙˆØ¯Ø±ÙˆÙ‡Ø§',
        emoji: 'ğŸš—',
        items: [
          { name: 'Ù¾Ø±Ø§ÛŒØ¯', basePrice: 80000000 },
          { name: 'Ù¾Ú˜Ùˆ Û²Û°Û¶', basePrice: 450000000 },
          { name: 'Ø¨ÛŒâ€ŒØ§Ù…â€ŒÙˆ X6', basePrice: 3000000000 },
          { name: 'Ù„Ø§Ù…Ø¨ÙˆØ±Ú¯ÛŒÙ†ÛŒ Ø§ÙˆÙ†ØªØ§Ø¯ÙˆØ±', basePrice: 15000000000 },
          { name: 'ÙˆØ§Ù†Øª Ù†ÛŒØ³Ø§Ù†', basePrice: 120000000 }
        ]
      },
      'plane_boat': {
        name: 'Ù‡ÙˆØ§Ù¾ÛŒÙ…Ø§/Ù‚Ø§ÛŒÙ‚',
        emoji: 'âœˆï¸/â›µ',
        items: [
          { name: 'Ù‚Ø§ÛŒÙ‚ Ù…ÙˆØªÙˆØ±ÛŒ', basePrice: 600000000 },
          { name: 'Ú©Ø´ØªÛŒ ØªÙØ±ÛŒØ­ÛŒ', basePrice: 8000000000 },
          { name: 'Ù‡ÙˆØ§Ù¾ÛŒÙ…Ø§ÛŒ Ø´Ø®ØµÛŒ', basePrice: 25000000000 },
          { name: 'Ú¯Ù„Ø§ÛŒØ¯Ø±', basePrice: 1000000000 },
          { name: 'Ù‚Ø§ÛŒÙ‚ Ø¨Ø§Ø¯ÛŒ', basePrice: 5000000 }
        ]
      },
      'jewelry': {
        name: 'Ø¬ÙˆØ§Ù‡Ø±Ø§Øª',
        emoji: 'ğŸ’',
        items: [
          { name: 'Ø­Ù„Ù‚Ù‡ Ø·Ù„Ø§', basePrice: 20000000 },
          { name: 'Ú¯Ø±Ø¯Ù†Ø¨Ù†Ø¯ Ø²Ù…Ø±Ø¯', basePrice: 80000000 },
          { name: 'Ø³Ø§Ø¹Øª Ø±ÙˆÙ„Ú©Ø³', basePrice: 150000000 },
          { name: 'Ø¯Ø³ØªØ¨Ù†Ø¯ Ø·Ù„Ø§', basePrice: 30000000 },
          { name: 'Ú¯ÙˆØ´ÙˆØ§Ø±Ù‡ Ø§Ù„Ù…Ø§Ø³', basePrice: 300000000 }
        ]
      },
      'instruments': {
        name: 'Ø³Ø§Ø²Ù‡Ø§',
        emoji: 'ğŸ¸',
        items: [
          { name: 'Ú¯ÛŒØªØ§Ø± Ú©Ù„Ø§Ø³ÛŒÚ©', basePrice: 10000000 },
          { name: 'Ù¾ÛŒØ§Ù†Ùˆ Ø¯ÛŒØ¬ÛŒØªØ§Ù„', basePrice: 80000000 },
          { name: 'ÙˆÛŒÙˆÙ„Ù†', basePrice: 40000000 },
          { name: 'Ø¯Ù Ø§ÛŒØ±Ø§Ù†ÛŒ', basePrice: 5000000 },
          { name: 'Ø³Ù†ØªÙˆØ±', basePrice: 30000000 }
        ]
      },
    };

    // New Investment Categories Data (Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Ø³Ø±Ù…Ø§ÛŒÙ‡â€ŒÚ¯Ø°Ø§Ø±ÛŒ Ø¬Ø¯ÛŒØ¯)
    const investmentCategories = {
      'gold_coins': {
        name: 'Ø·Ù„Ø§ Ùˆ Ø³Ú©Ù‡',
        emoji: 'ğŸ’°',
        items: [
          { name: 'ÛŒÚ© Ú¯Ø±Ù… Ø·Ù„Ø§ÛŒ Û±Û¸ Ø¹ÛŒØ§Ø±', basePrice: 3500000, minGrowth: 0.05, maxGrowth: 0.15 },
          { name: 'Ù†ÛŒÙ… Ø³Ú©Ù‡ Ø¨Ù‡Ø§Ø± Ø¢Ø²Ø§Ø¯ÛŒ', basePrice: 20000000, minGrowth: 0.08, maxGrowth: 0.18 },
          { name: 'ØªÙ…Ø§Ù… Ø³Ú©Ù‡ Ø¨Ù‡Ø§Ø± Ø¢Ø²Ø§Ø¯ÛŒ', basePrice: 40000000, minGrowth: 0.10, maxGrowth: 0.20 }
        ]
      },
      'stocks_bourse': {
        name: 'Ø³Ù‡Ø§Ù… Ø¨ÙˆØ±Ø³',
        emoji: 'ğŸ“ˆ',
        items: [
          { name: 'Ø³Ù‡Ø§Ù… Ø´Ø±Ú©Øª Ø®ÙˆØ¯Ø±Ùˆ Ø³Ø§Ø²ÛŒ', basePrice: 5000000, minGrowth: -0.05, maxGrowth: 0.25 },
          { name: 'Ø³Ù‡Ø§Ù… Ø¨Ø§Ù†Ú©', basePrice: 2000000, minGrowth: 0.02, maxGrowth: 0.10 },
          { name: 'ØµÙ†Ø¯ÙˆÙ‚ Ø³Ø±Ù…Ø§ÛŒÙ‡â€ŒÚ¯Ø°Ø§Ø±ÛŒ (ETF)', basePrice: 1000000, minGrowth: 0.07, maxGrowth: 0.17 }
        ]
      },
      'cryptocurrency': {
        name: 'Ø§Ø±Ø² Ø¯ÛŒØ¬ÛŒØªØ§Ù„',
        emoji: 'â‚¿',
        items: [
          { name: 'Ø¨ÛŒØªâ€ŒÚ©ÙˆÛŒÙ† (0.001 BTC)', basePrice: 50000000, minGrowth: -0.20, maxGrowth: 0.50 },
          { name: 'Ø§ØªØ±ÛŒÙˆÙ… (0.01 ETH)', basePrice: 20000000, minGrowth: -0.15, maxGrowth: 0.40 },
          { name: 'ØªØªØ± (100 USDT)', basePrice: 6000000, minGrowth: 0.001, maxGrowth: 0.005 } // Stablecoin, very low growth
        ]
      },
      'investment_land': {
        name: 'Ø²Ù…ÛŒÙ† Ùˆ Ø§Ù…Ù„Ø§Ú© (Ø³Ø±Ù…Ø§ÛŒÙ‡â€ŒÚ¯Ø°Ø§Ø±ÛŒ)',
        emoji: 'ğŸ¡',
        items: [
          { name: 'Ù‚Ø·Ø¹Ù‡ Ø²Ù…ÛŒÙ† Ú©ÙˆÚ†Ú© Ø´Ù‡Ø±ÛŒ', basePrice: 500000000, minGrowth: 0.10, maxGrowth: 0.20 },
          { name: 'Ø²Ù…ÛŒÙ† Ú©Ø´Ø§ÙˆØ±Ø²ÛŒ', basePrice: 1000000000, minGrowth: 0.07, maxGrowth: 0.15 },
          { name: 'Ù…Ù„Ú© ØªØ¬Ø§Ø±ÛŒ Ú©ÙˆÚ†Ú©', basePrice: 2000000000, minGrowth: 0.12, maxGrowth: 0.25 }
        ]
      },
      'raw_materials': {
        name: 'Ù…ÙˆØ§Ø¯ Ø§ÙˆÙ„ÛŒÙ‡',
        emoji: 'ğŸ“¦',
        items: [
          { name: 'Û±Û°Û° Ú©ÛŒÙ„ÙˆÚ¯Ø±Ù… Ú¯Ù†Ø¯Ù…', basePrice: 500000, minGrowth: -0.08, maxGrowth: 0.10 },
          { name: 'Û± ØªÙ† Ø³ÛŒÙ…Ø§Ù†', basePrice: 1500000, minGrowth: 0.01, maxGrowth: 0.08 },
          { name: 'Û±Û°Û° Ù„ÛŒØªØ± Ù†ÙØª Ø®Ø§Ù…', basePrice: 3000000, minGrowth: -0.10, maxGrowth: 0.15 }
        ]
      }
    };


    // Helper function to calculate fluctuating market price (ØªØ§Ø¨Ø¹ Ú©Ù…Ú©ÛŒ Ø¨Ø±Ø§ÛŒ Ù…Ø­Ø§Ø³Ø¨Ù‡ Ù‚ÛŒÙ…Øª Ù†ÙˆØ³Ø§Ù†ÛŒ Ø¨Ø§Ø²Ø§Ø±)
    function calculateMarketPrice(basePrice) {
        const fluctuation = (Math.random() * 0.2) - 0.1; // -10% to +10% (Û±Û°Ùª- ØªØ§ Û±Û°Ùª+)
        return Math.floor(basePrice * (1 + fluctuation));
    }

    // Function to show a specific asset category page (ØªØ§Ø¨Ø¹ Ø¨Ø±Ø§ÛŒ Ù†Ù…Ø§ÛŒØ´ ØµÙØ­Ù‡ Ù…Ø®ØµÙˆØµ Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Ø¯Ø§Ø±Ø§ÛŒÛŒ)
    window.showAssetCategoryPage = function(type) {
      const category = assetCategories[type];
      if (!category) {
        console.error('Invalid asset category type:', type);
        showMessageModal('Ø®Ø·Ø§: Ø¯Ø³ØªÙ‡ Ø¯Ø§Ø±Ø§ÛŒÛŒ Ù†Ø§Ù…Ø¹ØªØ¨Ø± Ø§Ø³Øª.');
        return;
      }

      // First, show the page. This ensures the H2 element is potentially ready.
      window.showPage(`${type}-page`); // This call will internally call updateUI()

      // Now update the page title (Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø¹Ù†ÙˆØ§Ù† ØµÙØ­Ù‡)
      // This line is now called AFTER the page is set to display: block
      const pageH2 = document.querySelector(`#${type}-page h2`);
      if (pageH2) { // Add a null check for robustness
        pageH2.textContent = `${category.emoji} ${category.name}`;
      } else {
        console.error(`Could not find h2 for page: ${type}-page`);
      }

      // Populate owned items (Ù¾Ø± Ú©Ø±Ø¯Ù† Ø¢ÛŒØªÙ…â€ŒÙ‡Ø§ÛŒ Ù…ÙˆØ¬ÙˆØ¯)
      const ownedListId = `owned-${type}-list`;
      const ownedListElement = document.getElementById(ownedListId);
      const ownedAssets = gameState.assets.filter(a => a.type === type);
      ownedListElement.innerHTML = ownedAssets.map(asset => `
        <div class="glass-card p-3 flex justify-between items-center">
          <span>${asset.name} - ${asset.value.toLocaleString('fa-IR')} ØªÙˆÙ…Ø§Ù†</span>
          <button class="btn-secondary px-3 py-1 rounded-lg text-xs" onclick="window.sellAsset('${asset.id}', '${type}')">ÙØ±ÙˆØ´</button>
        </div>
      `).join('') || '<p class="text-gray-400">Ø´Ù…Ø§ Ù‡ÛŒÚ† Ø¯Ø§Ø±Ø§ÛŒÛŒ Ø¯Ø± Ø§ÛŒÙ† Ø¯Ø³ØªÙ‡ Ù†Ø¯Ø§Ø±ÛŒØ¯.</p>';

      // Populate items for sale (Ù¾Ø± Ú©Ø±Ø¯Ù† Ø¢ÛŒØªÙ…â€ŒÙ‡Ø§ÛŒ Ø¨Ø±Ø§ÛŒ ÙØ±ÙˆØ´)
      const buyListId = `buy-${type}-list`;
      const buyListElement = document.getElementById(buyListId);
      buyListElement.innerHTML = category.items.map(item => {
        const currentPrice = calculateMarketPrice(item.basePrice);
        const priceDifference = ((currentPrice - item.basePrice) / item.basePrice * 100).toFixed(1);
        const priceColorClass = priceDifference >= 0 ? 'text-red-400' : 'text-green-400';
        const priceSign = priceDifference >= 0 ? '+' : ''; // Add plus sign for positive changes (Ø§ÙØ²ÙˆØ¯Ù† Ø¹Ù„Ø§Ù…Øª Ù…Ø«Ø¨Øª Ø¨Ø±Ø§ÛŒ ØªØºÛŒÛŒØ±Ø§Øª Ù…Ø«Ø¨Øª)

        return `
          <div class="glass-card p-4 flex flex-col sm:flex-row justify-between items-center">
            <div>
              <p class="font-semibold">${item.name}</p>
              <p class="text-sm text-gray-400">Ù‚ÛŒÙ…Øª: ${currentPrice.toLocaleString('fa-IR')} ØªÙˆÙ…Ø§Ù†</p>
              <p class="text-xs ${priceColorClass}">(${priceSign}${priceDifference}%)</p>
            </div>
            <button class="btn-primary px-4 py-2 rounded-lg mt-2 sm:mt-0" onclick="window.buyAsset('${type}', '${item.name}', ${currentPrice})">Ø®Ø±ÛŒØ¯</button>
          </div>
        `;
      }).join('');

      // window.showPage(`${type}-page`); // This was moved up (Ø§ÛŒÙ† Ø¨Ù‡ Ø¨Ø§Ù„Ø§ Ù…Ù†ØªÙ‚Ù„ Ø´Ø¯)
    };

    // Buy asset function (ØªØ§Ø¨Ø¹ Ø®Ø±ÛŒØ¯ Ø¯Ø§Ø±Ø§ÛŒÛŒ)
    window.buyAsset = function(assetType, assetName, assetPrice) {
      if (gameState.money < assetPrice) {
        showMessageModal(`Ù¾ÙˆÙ„ Ú©Ø§ÙÛŒ Ø¨Ø±Ø§ÛŒ Ø®Ø±ÛŒØ¯ ${assetName} Ù†Ø¯Ø§Ø±ÛŒØ¯! (Ù†ÛŒØ§Ø² Ø¨Ù‡ ${assetPrice.toLocaleString('fa-IR')} ØªÙˆÙ…Ø§Ù†)`);
        return;
      }

      gameState.money -= assetPrice;
      gameState.assets.push({ id: crypto.randomUUID(), type: assetType, name: assetName, value: assetPrice });
      gameState.log.push({ year: gameState.year, event: `Ø´Ù…Ø§ ${assetName} Ø±Ø§ Ø¨Ù‡ Ù…Ø¨Ù„Øº ${assetPrice.toLocaleString('fa-IR')} ØªÙˆÙ…Ø§Ù† Ø®Ø±ÛŒØ¯ÛŒØ¯.`, type: 'finance' });
      showMessageModal(`Ø´Ù…Ø§ ${assetName} Ø±Ø§ Ø®Ø±ÛŒØ¯ÛŒØ¯.`);
      updateUI();
      window.showAssetCategoryPage(assetType); // Refresh the current asset page to show changes (Ø±ÙØ±Ø´ ØµÙØ­Ù‡ Ø¯Ø§Ø±Ø§ÛŒÛŒ ÙØ¹Ù„ÛŒ Ø¨Ø±Ø§ÛŒ Ù†Ù…Ø§ÛŒØ´ ØªØºÛŒÛŒØ±Ø§Øª)
      saveGame();
    };

    // Sell asset function (ØªØ§Ø¨Ø¹ ÙØ±ÙˆØ´ Ø¯Ø§Ø±Ø§ÛŒÛŒ)
    window.sellAsset = function(assetId, assetType) {
      const assetIndex = gameState.assets.findIndex(a => a.id === assetId);
      if (assetIndex === -1) {
        showMessageModal('Ø¯Ø§Ø±Ø§ÛŒÛŒ ÛŒØ§ÙØª Ù†Ø´Ø¯.');
        return;
      }

      const asset = gameState.assets[assetIndex];
      const sellPrice = Math.floor(asset.value * 0.9); // Sell for 90% of value (ÙØ±ÙˆØ´ Ø¨Ø§ Û¹Û°Ùª Ø§Ø±Ø²Ø´)
      gameState.money += sellPrice;
      gameState.assets.splice(assetIndex, 1); // Remove asset (Ø­Ø°Ù Ø¯Ø§Ø±Ø§ÛŒÛŒ)
      gameState.log.push({ year: gameState.year, event: `Ø´Ù…Ø§ ${asset.name} Ø±Ø§ Ø¨Ù‡ Ù…Ø¨Ù„Øº ${sellPrice.toLocaleString('fa-IR')} ØªÙˆÙ…Ø§Ù† ÙØ±ÙˆØ®ØªÛŒØ¯.`, type: 'finance' });
      showMessageModal(`Ø´Ù…Ø§ ${asset.name} Ø±Ø§ ÙØ±ÙˆØ®ØªÛŒØ¯ Ùˆ ${sellPrice.toLocaleString('fa-IR')} ØªÙˆÙ…Ø§Ù† Ø¯Ø±ÛŒØ§ÙØª Ú©Ø±Ø¯ÛŒØ¯.`);
      updateUI();
      window.showAssetCategoryPage(assetType); // Refresh the current asset page to show changes (Ø±ÙØ±Ø´ ØµÙØ­Ù‡ Ø¯Ø§Ø±Ø§ÛŒÛŒ ÙØ¹Ù„ÛŒ Ø¨Ø±Ø§ÛŒ Ù†Ù…Ø§ÛŒØ´ ØªØºÛŒÛŒØ±Ø§Øª)
      saveGame();
    }

    // --- Investment Specific Functions (ØªÙˆØ§Ø¨Ø¹ Ù…Ø±Ø¨ÙˆØ· Ø¨Ù‡ Ø³Ø±Ù…Ø§ÛŒÙ‡â€ŒÚ¯Ø°Ø§Ø±ÛŒ) ---

    // Function to show a specific investment category page (ØªØ§Ø¨Ø¹ Ø¨Ø±Ø§ÛŒ Ù†Ù…Ø§ÛŒØ´ ØµÙØ­Ù‡ Ù…Ø®ØµÙˆØµ Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Ø³Ø±Ù…Ø§ÛŒÙ‡â€ŒÚ¯Ø°Ø§Ø±ÛŒ)
    window.showInvestmentCategoryPage = function(type) {
      currentInvestmentPageType = type; // Set the current investment page type (Ù†ÙˆØ¹ ØµÙØ­Ù‡ Ø³Ø±Ù…Ø§ÛŒÙ‡â€ŒÚ¯Ø°Ø§Ø±ÛŒ ÙØ¹Ù„ÛŒ Ø±Ø§ ØªÙ†Ø¸ÛŒÙ… Ù…ÛŒâ€ŒÚ©Ù†Ø¯)

      const category = investmentCategories[type];
      if (!category) {
        console.error('Invalid investment category type:', type);
        showMessageModal('Ø®Ø·Ø§: Ø¯Ø³ØªÙ‡ Ø³Ø±Ù…Ø§ÛŒÙ‡â€ŒÚ¯Ø°Ø§Ø±ÛŒ Ù†Ø§Ù…Ø¹ØªØ¨Ø± Ø§Ø³Øª.');
        return;
      }

      // First, show the page.
      window.showPage(`${type}-page`); // This calls updateUI()

      // Now update the page title (Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø¹Ù†ÙˆØ§Ù† ØµÙØ­Ù‡)
      // This line is now called AFTER the page is set to display: block
      const pageH2 = document.querySelector(`#${type}-page h2`);
      if (pageH2) { // Add a null check for robustness
        pageH2.textContent = `${category.emoji} ${category.name}`;
      } else {
        console.error(`Could not find h2 for investment page: ${type}-page`);
      }

      // Populate owned investments (Ù¾Ø± Ú©Ø±Ø¯Ù† Ø³Ø±Ù…Ø§ÛŒØ§ÛŒÙ‡â€ŒÚ¯Ø°Ø§Ø±ÛŒâ€ŒÙ‡Ø§ÛŒ Ù…ÙˆØ¬ÙˆØ¯)
      const ownedListId = `owned-${type}-list`;
      const ownedListElement = document.getElementById(ownedListId);
      const ownedInvestments = gameState.investments.filter(a => a.type === type);
      ownedListElement.innerHTML = ownedInvestments.map(investment => `
        <div class="glass-card p-3 flex justify-between items-center">
          <span>${investment.name} - ${investment.value.toLocaleString('fa-IR')} ØªÙˆÙ…Ø§Ù† (Ø¨Ø§Ø²Ø¯Ù‡: ${(investment.growth * 100).toFixed(1)}%)</span>
          <button class="btn-secondary px-3 py-1 rounded-lg text-xs" onclick="window.sellInvestment('${investment.id}', '${type}')">ÙØ±ÙˆØ´</button>
        </div>
      `).join('') || '<p class="text-gray-400">Ø´Ù…Ø§ Ù‡ÛŒÚ† Ø³Ø±Ù…Ø§ÛŒÙ‡â€ŒÚ¯Ø°Ø§Ø±ÛŒ Ø¯Ø± Ø§ÛŒÙ† Ø¯Ø³ØªÙ‡ Ù†Ø¯Ø§Ø±ÛŒØ¯.</p>';

      // Populate items for sale (Ù¾Ø± Ú©Ø±Ø¯Ù† Ø¢ÛŒØªÙ…â€ŒÙ‡Ø§ÛŒ Ø¨Ø±Ø§ÛŒ ÙØ±ÙˆØ´)
      const buyListId = `buy-${type}-list`;
      const buyListElement = document.getElementById(buyListId);
      buyListElement.innerHTML = category.items.map(item => {
        const currentPrice = calculateMarketPrice(item.basePrice); // Use generic market price calc for initial purchase
        const priceDifference = ((currentPrice - item.basePrice) / item.basePrice * 100).toFixed(1);
        const priceColorClass = priceDifference >= 0 ? 'text-red-400' : 'text-green-400';
        const priceSign = priceDifference >= 0 ? '+' : '';

        return `
          <div class="glass-card p-4 flex flex-col sm:flex-row justify-between items-center">
            <div>
              <p class="font-semibold">${item.name}</p>
              <p class="text-sm text-gray-400">Ù‚ÛŒÙ…Øª: ${currentPrice.toLocaleString('fa-IR')} ØªÙˆÙ…Ø§Ù†</p>
              <p class="text-xs ${priceColorClass}">(${priceSign}${priceDifference}%)</p>
            </div>
            <button class="btn-primary px-4 py-2 rounded-lg mt-2 sm:mt-0" 
                    onclick="window.buyInvestment('${type}', '${item.name}', ${currentPrice}, ${item.minGrowth}, ${item.maxGrowth})">Ø®Ø±ÛŒØ¯</button>
          </div>
        `;
      }).join('');

      // window.showPage(`${type}-page`); // This was moved up (Ø§ÛŒÙ† Ø¨Ù‡ Ø¨Ø§Ù„Ø§ Ù…Ù†ØªÙ‚Ù„ Ø´Ø¯)
    };

    // Buy investment function (ØªØ§Ø¨Ø¹ Ø®Ø±ÛŒØ¯ Ø³Ø±Ù…Ø§ÛŒÙ‡â€ŒÚ¯Ø°Ø§Ø±ÛŒ)
    window.buyInvestment = function(investmentType, investmentName, investmentPrice, minGrowth, maxGrowth) {
      if (gameState.money < investmentPrice) {
        showMessageModal(`Ù¾ÙˆÙ„ Ú©Ø§ÙÛŒ Ø¨Ø±Ø§ÛŒ Ø®Ø±ÛŒØ¯ ${investmentName} Ù†Ø¯Ø§Ø±ÛŒØ¯! (Ù†ÛŒØ§Ø² Ø¨Ù‡ ${investmentPrice.toLocaleString('fa-IR')} ØªÙˆÙ…Ø§Ù†)`);
        return;
      }

      gameState.money -= investmentPrice;
      const growthRate = minGrowth + (Math.random() * (maxGrowth - minGrowth)); // Random growth rate within bounds (Ù†Ø±Ø® Ø±Ø´Ø¯ ØªØµØ§Ø¯ÙÛŒ Ø¯Ø± Ù…Ø­Ø¯ÙˆØ¯Ù‡)
      const categoryEmoji = investmentCategories[investmentType].emoji;

      gameState.investments.push({ id: crypto.randomUUID(), type: investmentType, name: investmentName, value: investmentPrice, growth: growthRate, emoji: categoryEmoji });
      gameState.log.push({ year: gameState.year, event: `Ø´Ù…Ø§ ${investmentName} Ø±Ø§ Ø¨Ù‡ Ù…Ø¨Ù„Øº ${investmentPrice.toLocaleString('fa-IR')} ØªÙˆÙ…Ø§Ù† Ø®Ø±ÛŒØ¯ÛŒØ¯.`, type: 'finance' });
      showMessageModal(`Ø´Ù…Ø§ ${investmentName} Ø±Ø§ Ø®Ø±ÛŒØ¯ÛŒØ¯.`);
      updateUI();
      window.showInvestmentCategoryPage(investmentType); // Refresh the current investment page to show changes (Ø±ÙØ±Ø´ ØµÙØ­Ù‡ Ø³Ø±Ù…Ø§ÛŒÙ‡â€ŒÚ¯Ø°Ø§Ø±ÛŒ ÙØ¹Ù„ÛŒ Ø¨Ø±Ø§ÛŒ Ù†Ù…Ø§ÛŒØ´ ØªØºÛŒÛŒØ±Ø§Øª)
      saveGame();
    };

    // Sell investment function (ØªØ§Ø¨Ø¹ ÙØ±ÙˆØ´ Ø³Ø±Ù…Ø§ÛŒÙ‡â€ŒÚ¯Ø°Ø§Ø±ÛŒ)
    window.sellInvestment = function(investmentId, investmentType) {
      const investmentIndex = gameState.investments.findIndex(a => a.id === investmentId);
      if (investmentIndex === -1) {
        showMessageModal('Ø³Ø±Ù…Ø§ÛŒÙ‡â€ŒÚ¯Ø°Ø§Ø±ÛŒ ÛŒØ§ÙØª Ù†Ø´Ø¯.');
        return;
      }

      const investment = gameState.investments[investmentIndex];
      const sellPrice = Math.floor(investment.value * 0.9); // Sell for 90% of current value (ÙØ±ÙˆØ´ Ø¨Ø§ Û¹Û°Ùª Ø§Ø±Ø²Ø´ ÙØ¹Ù„ÛŒ)
      gameState.money += sellPrice;
      gameState.investments.splice(investmentIndex, 1); // Remove investment (Ø­Ø°Ù Ø³Ø±Ù…Ø§ÛŒÙ‡â€ŒÚ¯Ø°Ø§Ø±ÛŒ)
      gameState.log.push({ year: gameState.year, event: `Ø´Ù…Ø§ ${investment.name} Ø±Ø§ Ø¨Ù‡ Ù…Ø¨Ù„Øº ${sellPrice.toLocaleString('fa-IR')} ØªÙˆÙ…Ø§Ù† ÙØ±ÙˆØ®ØªÛŒØ¯.`, type: 'finance' });
      showMessageModal(`Ø´Ù…Ø§ ${investment.name} Ø±Ø§ ÙØ±ÙˆØ®ØªÛŒØ¯ Ùˆ ${sellPrice.toLocaleString('fa-IR')} ØªÙˆÙ…Ø§Ù† Ø¯Ø±ÛŒØ§ÙØª Ú©Ø±Ø¯ÛŒØ¯.`);
      updateUI();
      window.showInvestmentCategoryPage(investmentType); // Refresh the current investment page to show changes (Ø±ÙØ±Ø´ ØµÙØ­Ù‡ Ø³Ø±Ù…Ø§ÛŒÙ‡â€ŒÚ¯Ø°Ø§Ø±ÛŒ ÙØ¹Ù„ÛŒ Ø¨Ø±Ø§ÛŒ Ù†Ù…Ø§ÛŒØ´ ØªØºÛŒÛŒØ±Ø§Øª)
      saveGame();
    }

    // New function to update investment prices periodically (ØªØ§Ø¨Ø¹ Ø¬Ø¯ÛŒØ¯ Ø¨Ø±Ø§ÛŒ Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø¯ÙˆØ±Ù‡â€ŒØ§ÛŒ Ù‚ÛŒÙ…Øª Ø³Ø±Ù…Ø§ÛŒÙ‡â€ŒÚ¯Ø°Ø§Ø±ÛŒâ€ŒÙ‡Ø§)
    function updateInvestmentPrices() {
      for (const categoryType in investmentCategories) {
        const category = investmentCategories[categoryType];
        category.items.forEach(item => {
          // Generate a random fluctuation between -0.5% and +10% (ØªÙˆÙ„ÛŒØ¯ Ù†ÙˆØ³Ø§Ù† ØªØµØ§Ø¯ÙÛŒ Ø¨ÛŒÙ† Û°.Ûµ-Ùª Ùˆ Û±Û°Ùª+)
          const minFluctuation = -0.005; // -0.5%
          const maxFluctuation = 0.10;   // +10%
          const fluctuation = minFluctuation + (Math.random() * (maxFluctuation - minFluctuation));

          item.basePrice = Math.floor(item.basePrice * (1 + fluctuation));
          // Ensure price doesn't drop too low (Ø§Ø·Ù…ÛŒÙ†Ø§Ù† Ø§Ø² Ø§ÛŒÙ†Ú©Ù‡ Ù‚ÛŒÙ…Øª Ø¨ÛŒØ´ Ø§Ø² Ø­Ø¯ Ú©Ø§Ù‡Ø´ Ù†Ù…ÛŒâ€ŒÛŒØ§Ø¨Ø¯)
          item.basePrice = Math.max(1000, item.basePrice);
        });
      }

      // If an investment detail page is currently open, refresh it (Ø§Ú¯Ø± ÛŒÚ© ØµÙØ­Ù‡ Ø¬Ø²Ø¦ÛŒØ§Øª Ø³Ø±Ù…Ø§ÛŒÙ‡â€ŒÚ¯Ø°Ø§Ø±ÛŒ Ø¯Ø± Ø­Ø§Ù„ Ø­Ø§Ø¶Ø± Ø¨Ø§Ø² Ø§Ø³ØªØŒ Ø¢Ù† Ø±Ø§ Ø±ÙØ±Ø´ Ú©Ù†ÛŒØ¯)
      if (currentInvestmentPageType) {
        window.showInvestmentCategoryPage(currentInvestmentPageType);
      }
    }


    // Finance Chart (Ù†Ù…ÙˆØ¯Ø§Ø± Ù…Ø§Ù„ÛŒ)
    function updateFinanceChart() {
      console.log('Attempting to update finance chart...'); // Debugging line
      const canvas = document.getElementById('finance-chart');
      if (!canvas) {
          console.error('Finance chart canvas element not found!');
          return;
      }
      const ctx = canvas.getContext('2d');
      if (!ctx) {
          console.error('Could not get 2D context for finance chart canvas!');
          return;
      }

      // Explicitly check for Chart.js availability and if it's a constructor function
      if (typeof Chart !== 'function') { // Removed window. prefix for Chart.js v2.9.4 as it's directly global
        console.error('Chart.js is not loaded or Chart is not a constructor function. Current type of Chart:', typeof Chart);
        showMessageModal('Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ù†Ù…ÙˆØ¯Ø§Ø± Ù…Ø§Ù„ÛŒ. Ù„Ø·ÙØ§Ù‹ ØµÙØ­Ù‡ Ø±Ø§ Ø±ÙØ±Ø´ Ú©Ù†ÛŒØ¯.');
        return; // Prevent further errors
      }

      const labels = gameState.financeHistory.map(entry => entry.year);
      const data = gameState.financeHistory.map(entry => entry.money);

      if (financeChartInstance) {
        financeChartInstance.destroy(); // Destroy previous chart instance (Ù†Ù…ÙˆÙ†Ù‡ Ù†Ù…ÙˆØ¯Ø§Ø± Ù‚Ø¨Ù„ÛŒ Ø±Ø§ Ø§Ø² Ø¨ÛŒÙ† Ø¨Ø¨Ø±ÛŒØ¯)
      }

      financeChartInstance = new Chart(ctx, {
        type: 'line',
        data: {
          labels: labels,
          datasets: [{
            label: 'Ù¾ÙˆÙ„ (ØªÙˆÙ…Ø§Ù†)',
            data: data,
            borderColor: '#10b981',
            backgroundColor: 'rgba(16, 185, 129, 0.2)',
            fill: true
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          legend: { // For Chart.js v2.x, legend is directly under options
            labels: {
              fontColor: 'white' // Legend text color (Ø±Ù†Ú¯ Ù…ØªÙ† Ø§ÙØ³Ø§Ù†Ù‡)
            }
          },
          scales: { // For Chart.js v2.x, scales are directly under options
            xAxes: [{
              gridLines: {
                color: 'rgba(255, 255, 255, 0.1)' // X-axis grid color (Ø±Ù†Ú¯ Ø´Ø¨Ú©Ù‡ Ù…Ø­ÙˆØ± X)
              },
              ticks: {
                fontColor: 'white' // X-axis tick color (Ø±Ù†Ú¯ ØªÛŒÚ© Ù…Ø­ÙˆØ± X)
              }
            }],
            yAxes: [{
              ticks: {
                beginAtZero: true,
                fontColor: 'white', // Y-axis tick color (Ø±Ù†Ú¯ ØªÛŒÚ© Ù…Ø­ÙˆØ± Y)
                callback: function(value) {
                  return value.toLocaleString('fa-IR') + ' Øª'; // Format Y-axis labels (Ù‚Ø§Ù„Ø¨â€ŒØ¨Ù†Ø¯ÛŒ Ø¨Ø±Ú†Ø³Ø¨â€ŒÙ‡Ø§ÛŒ Ù…Ø­ÙˆØ± Y)
                }
              },
              gridLines: {
                color: 'rgba(255, 255, 255, 0.1)' // Y-axis grid color (Ø±Ù†Ú¯ Ø´Ø¨Ú©Ù‡ Ù…Ø­ÙˆØ± Y)
              }
            }]
          }
        }
      });
      console.log('Finance chart updated successfully.'); // Debugging line
    }

    // Save Game (Ø°Ø®ÛŒØ±Ù‡ Ø¨Ø§Ø²ÛŒ)
    function saveGame() {
      try {
        localStorage.setItem('iranianLifeSimState', JSON.stringify(gameState));
      } catch (e) {
        console.error('Error saving game to localStorage:', e);
        showMessageModal('Ø®Ø·Ø§ Ø¯Ø± Ø°Ø®ÛŒØ±Ù‡ Ø¨Ø§Ø²ÛŒ! Ù…Ù…Ú©Ù† Ø§Ø³Øª Ø­Ø§ÙØ¸Ù‡ Ù…Ø±ÙˆØ±Ú¯Ø± Ø´Ù…Ø§ Ù¾Ø± Ø¨Ø§Ø´Ø¯.');
      }
    }

    // Load Game (Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø¨Ø§Ø²ÛŒ)
    function loadGame() {
      try {
        const savedState = localStorage.getItem('iranianLifeSimState');
        if (savedState) {
          gameState = JSON.parse(savedState);
          // Ensure financeHistory is an array and has at least one entry (Ø§Ø·Ù…ÛŒÙ†Ø§Ù† Ø§Ø² Ø§ÛŒÙ†Ú©Ù‡ financeHistory ÛŒÚ© Ø¢Ø±Ø§ÛŒÙ‡ Ø§Ø³Øª Ùˆ Ø­Ø¯Ø§Ù‚Ù„ ÛŒÚ© ÙˆØ±ÙˆØ¯ÛŒ Ø¯Ø§Ø±Ø¯)
          if (!gameState.financeHistory || gameState.financeHistory.length === 0) {
              gameState.financeHistory = [{ year: gameState.year, money: gameState.money }];
          }
          updateUI();
          window.showPage('dashboard');
          showMessageModal('Ø¨Ø§Ø²ÛŒ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø´Ø¯!');
        } else {
          console.log('No saved game found in localStorage.');
          // If no saved game, stay on start screen (Ø§Ú¯Ø± Ø¨Ø§Ø²ÛŒ Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯Ù‡â€ŒØ§ÛŒ Ù†ÛŒØ³ØªØŒ Ø¯Ø± ØµÙØ­Ù‡ Ø´Ø±ÙˆØ¹ Ø¨Ù…Ø§Ù†ÛŒØ¯)
        }
      } catch (e) {
        console.error('Error loading game from localStorage:', e);
        showMessageModal('Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø¨Ø§Ø²ÛŒ! ÙØ§ÛŒÙ„ Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯Ù‡ Ù…Ù…Ú©Ù† Ø§Ø³Øª Ø®Ø±Ø§Ø¨ Ø¨Ø§Ø´Ø¯.');
      }
    }

    // Reset Game (Ø±ÛŒØ³Øª Ø¨Ø§Ø²ÛŒ)
    async function resetGame() {
      const confirmed = await window.confirm('Ø¢ÛŒØ§ Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ Ú©Ù‡ Ù…ÛŒâ€ŒØ®ÙˆØ§Ù‡ÛŒØ¯ Ø¨Ø§Ø²ÛŒ Ø±Ø§ Ø±ÛŒØ³Øª Ú©Ù†ÛŒØ¯ØŸ ØªÙ…Ø§Ù… Ù¾ÛŒØ´Ø±ÙØª Ø´Ù…Ø§ Ø§Ø² Ø¨ÛŒÙ† Ø®ÙˆØ§Ù‡Ø¯ Ø±ÙØª.');
      if (confirmed) {
        try {
          localStorage.removeItem('iranianLifeSimState'); // Clear local storage (Ø­Ø°Ù Ø§Ø² Ø­Ø§ÙØ¸Ù‡ Ù…Ø­Ù„ÛŒ)
        } catch (e) {
          console.error('Error clearing game from localStorage:', e);
        }
        gameState = {
          name: '', gender: '', province: '', familyStatus: '', age: 0, year: 2025, money: 0,
          happiness: 50, health: 80, smarts: 50, looks: 50, spirituality: 50,
          education: { level: 'Ù‡ÛŒÚ†', major: '', degreeProgress: 0 }, job: { title: 'Ø¨ÛŒÚ©Ø§Ø±', salary: 0, level: 0, experience: 0 },
          relationships: [
            { id: 'parent1', name: 'Ù¾Ø¯Ø±', role: 'Ù¾Ø¯Ø±', relationship: 80, respect: 70, happiness: 60 },
            { id: 'parent2', name: 'Ù…Ø§Ø¯Ø±', role: 'Ù…Ø§Ø¯Ø±', relationship: 85, respect: 75, happiness: 65 }
          ],
          romanticRelationships: [], children: [], illnesses: [], assets: [], loans: [], investments: [], log: [],
          financeHistory: [{ year: 2025, money: 0 }]
        };
        updateUI();
        window.showPage('start-screen');
        showMessageModal('Ø¨Ø§Ø²ÛŒ Ø±ÛŒØ³Øª Ø´Ø¯!');
      }
    }

    // Filter Log (ÙÛŒÙ„ØªØ± ØªØ§Ø±ÛŒØ®Ú†Ù‡)
    function filterLog(type) {
      const logElement = document.getElementById('life-log-full'); // This is the UL
      const scrollContainer = document.getElementById('full-log-scroll-area'); // This is the new scroll container

      const filteredLogs = type === 'all' ? gameState.log : gameState.log.filter(log => log.type === type);
      
      logElement.innerHTML = filteredLogs.map(log => `
        <li class="glass-card p-4">
          <span class="font-semibold">Ø³Ù† ${log.year - 2025}</span>
          <p>${log.event}</p>
        </li>
      `).join('');

      // Auto-scroll to the bottom of the correct container (Ø§Ø³Ú©Ø±ÙˆÙ„ Ø®ÙˆØ¯Ú©Ø§Ø± Ø¨Ù‡ Ù¾Ø§ÛŒÛŒÙ† Ú©Ø§Ù†ØªÛŒÙ†Ø± ØµØ­ÛŒØ­)
      if (scrollContainer) {
        scrollContainer.scrollTop = scrollContainer.scrollHeight;
      }

      // Update button styles (Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø§Ø³ØªØ§ÛŒÙ„ Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§)
      document.querySelectorAll('#log-page .btn-primary').forEach(btn => {
        btn.classList.remove('btn-primary');
        btn.classList.add('btn-secondary');
      });
      document.getElementById(`log-filter-${type}`).classList.remove('btn-secondary');
      document.getElementById(`log-filter-${type}`).classList.add('btn-primary');
    }

    // Function to update the life log on the dashboard (ØªØ§Ø¨Ø¹ Ø¨Ø±Ø§ÛŒ Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ú¯Ø²Ø§Ø±Ø´ Ø²Ù†Ø¯Ú¯ÛŒ Ø¯Ø± Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯)
    function updateLifeLogOnDashboard() {
      const logElement = document.getElementById('life-log'); // This is the DIV containing log entries
      const logScrollContainer = document.getElementById('life-log-scroll-container'); // This is the actual scrollable glass-card

      if (!logElement || !logScrollContainer) return;

      // Group logs by year (Ú¯Ø±ÙˆÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Ú¯Ø²Ø§Ø±Ø´â€ŒÙ‡Ø§ Ø¨Ø± Ø§Ø³Ø§Ø³ Ø³Ø§Ù„)
      const logsByYear = {};
      // Iterate in reverse to group, so when rendered, years are in descending order (Ù¾ÛŒÙ…Ø§ÛŒØ´ Ø¨Ø±Ø¹Ú©Ø³ Ø¨Ø±Ø§ÛŒ Ú¯Ø±ÙˆÙ‡â€ŒØ¨Ù†Ø¯ÛŒØŒ Ø¨Ù†Ø§Ø¨Ø±Ø§ÛŒÙ† Ù‡Ù†Ú¯Ø§Ù… Ø±Ù†Ø¯Ø± Ø´Ø¯Ù†ØŒ Ø³Ø§Ù„â€ŒÙ‡Ø§ Ø¨Ù‡ ØªØ±ØªÛŒØ¨ Ù†Ø²ÙˆÙ„ÛŒ Ù‚Ø±Ø§Ø± Ù…ÛŒâ€ŒÚ¯ÛŒØ±Ù†Ø¯)
      // This ensures newer years appear at the top of the generated HTML for visual hierarchy, but the scroll then moves to the latest *event* (Ú¯Ø±ÙˆÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Ø¨Ø±Ø¹Ú©Ø³ ØªØ¶Ù…ÛŒÙ† Ù…ÛŒâ€ŒÚ©Ù†Ø¯ Ú©Ù‡ Ø³Ø§Ù„â€ŒÙ‡Ø§ÛŒ Ø¬Ø¯ÛŒØ¯ØªØ± Ø¯Ø± Ø¨Ø§Ù„Ø§ÛŒ HTML ØªÙˆÙ„ÛŒØ¯ Ø´Ø¯Ù‡ Ø¨Ø±Ø§ÛŒ Ø³Ù„Ø³Ù„Ù‡ Ù…Ø±Ø§ØªØ¨ Ø¨ØµØ±ÛŒ Ø¸Ø§Ù‡Ø± Ø´ÙˆÙ†Ø¯ØŒ Ø§Ù…Ø§ Ø§Ø³Ú©Ø±ÙˆÙ„ Ø³Ù¾Ø³ Ø¨Ù‡ Ø¢Ø®Ø±ÛŒÙ† Ø±ÙˆÛŒØ¯Ø§Ø¯ Ù…ÛŒâ€ŒØ±ÙˆØ¯.)
      [...gameState.log].reverse().forEach(log => {
        if (!logsByYear[log.year]) {
          logsByYear[log.year] = [];
        }
        logsByYear[log.year].push(log.event);
      });

      let logHtml = '';
      const initialYear = 2025; // Assuming the game starts in 2025 (ÙØ±Ø¶ Ø¨Ø± Ø§ÛŒÙ† Ø§Ø³Øª Ú©Ù‡ Ø¨Ø§Ø²ÛŒ Ø¯Ø± Ø³Ø§Ù„ Û²Û°Û²Ûµ Ø´Ø±ÙˆØ¹ Ù…ÛŒâ€ŒØ´ÙˆØ¯)

      for (const year in logsByYear) {
        if (logsByYear.hasOwnProperty(year)) {
          const currentAgeAtYearStart = parseInt(year) - initialYear; // Calculate age for the given year (Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø³Ù† Ø¨Ø±Ø§ÛŒ Ø³Ø§Ù„ Ù…Ø´Ø®Øµ)
          logHtml += `
            <div class="glass-card p-4 mb-4">
              <h4 class="text-lg font-semibold mb-2">Ø³Ù† ${currentAgeAtYearStart}</h4>
              <ul class="list-disc list-inside space-y-1 text-sm">
                ${logsByYear[year].map(event => `<li>${event}</li>`).join('')}
              </ul>
            </div>
          `;
        }
      }
      logElement.innerHTML = logHtml || '<p>ØªØ§Ø±ÛŒØ®Ú†Ù‡ Ø²Ù†Ø¯Ú¯ÛŒ Ø´Ù…Ø§ Ø§ÛŒÙ†Ø¬Ø§ Ù†Ù…Ø§ÛŒØ´ Ø¯Ø§Ø¯Ù‡ Ø®ÙˆØ§Ù‡Ø¯ Ø´Ø¯.</p>';

      // Auto-scroll to the bottom of the scroll container (Ø§Ø³Ú©Ø±ÙˆÙ„ Ø®ÙˆØ¯Ú©Ø§Ø± Ø¨Ù‡ Ù¾Ø§ÛŒÛŒÙ† Ú©Ø§Ù†ØªÛŒÙ†Ø± Ø§Ø³Ú©Ø±ÙˆÙ„)
      // Ø§ÛŒÙ† Ø®Ø· Ú©Ø¯ Ù…Ø³Ø¦ÙˆÙ„ Ø§Ø³Ú©Ø±ÙˆÙ„ Ø®ÙˆØ¯Ú©Ø§Ø± Ø¨Ù‡ Ù¾Ø§ÛŒÛŒÙ† Ø¯Ø± Ø¨Ø®Ø´ Ú¯Ø²Ø§Ø±Ø´ Ø²Ù†Ø¯Ú¯ÛŒ Ø¯Ø± Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯ Ø§Ø³Øª.
      // Ø§ÛŒÙ† ØªØ¶Ù…ÛŒÙ† Ù…ÛŒâ€ŒÚ©Ù†Ø¯ Ú©Ù‡ Ø¬Ø¯ÛŒØ¯ØªØ±ÛŒÙ† Ø±ÙˆÛŒØ¯Ø§Ø¯Ù‡Ø§ (Ú©Ù‡ Ø¯Ø± Ù¾Ø§ÛŒÛŒÙ† Ù…Ø­ØªÙˆØ§ Ù‡Ø³ØªÙ†Ø¯) Ù‡Ù…ÛŒØ´Ù‡ Ø¯Ø± Ø¯ÛŒØ¯ Ø¨Ø§Ø´Ù†Ø¯.
      logScrollContainer.scrollTop = logScrollContainer.scrollHeight;
    }

    // Initial setup when the window loads (ØªÙ†Ø¸ÛŒÙ… Ø§ÙˆÙ„ÛŒÙ‡ Ù‡Ù†Ú¯Ø§Ù… Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ù¾Ù†Ø¬ÛŒØ±Ù‡)
    window.onload = initGame;
  </script>
</body>
</html>
